module.exports=function(e){function t(i){if(r[i])return r[i].exports;var o=r[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/js/",t(0)}([function(e,t,r){e.exports=r(8)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={ATOM:"Atom",RESIDUE:"Residue",CHAIN:"Chain"};t["default"]=r},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),n=i(o),a=r(1),s=i(a),l=n["default"].Model.extend({defaults:{atom_labels_shown:!1,background_color:"#73757C",background_opacity:1,height:"500px",model_data:{atoms:[],bonds:[]},orbital:{cube_file:"",iso_val:null,opacity:null},styles:{},selected_atom_indices:[],selection_type:s["default"].ATOM,shapes:[],width:"500px"}});t["default"]=l},function(e,t,r){(function(e){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},n=r(4),a=i(n),s=r(6),l=i(s),c=r(9),u=i(c),h=r(10),f=i(h),d=r(5);window.$=d;var p=r(11),v="stick",m=14,g=16711680,y=255,b=a["default"].View.extend({initialize:function(){e.env.NODE_ENV===l["default"].DEVELOPMENT&&(window.nbmolviz3d||(window.nbmolviz3d=[]),window.nbmolviz3d.push(this)),this.model.on("change",this.render.bind(this))},render:function(e){var t=!e||Object.keys(e.changed).indexOf("model_data")!==-1;this.messages=[],this.mydiv=this.mydiv||window.document.createElement("div"),this.mydiv.classList.add("nbmolviz3d"),this.mydiv.style.width=this.model.get("width"),this.mydiv.style.height=this.model.get("height"),this.mydiv.style.position="relative",this.el.querySelector(".nbmolviz3d")||this.el.appendChild(this.mydiv),this.glviewer=this.renderViewer(t),this.send&&this.send({event:"ready"})},renderViewer:function(e){var t=this,r=this.glviewer||p.createViewer(d(this.mydiv),{defaultcolors:p.rasmolElementColors});r.clear();var i=this.model.get("model_data");"string"==typeof i?r.addModel(i,"pdb",{keepH:!0}):"object"===("undefined"==typeof i?"undefined":o(i))&&(r.addModel(f["default"].modelDataToCDJSON(i),"json",{keepH:!0}),r.getModel().selectedAtoms().forEach(function(e){var t=e;t.atom=i.atoms[e.serial].name,t.chain=i.atoms[e.serial].chain,t.resi=i.atoms[e.serial].residue_index,t.resn=i.atoms[e.serial].residue_name}));var n=this.model.get("styles");i.atoms?i.atoms.forEach(function(e,i){var o=n[i]||{},a={},s=o.visualization_type||v;a[s]={},Object.keys(o).forEach(function(e){a[s][e]=o[e]}),t.model.get("selected_atom_indices").indexOf(e.serial)!==-1&&(a[s].color=2094078),"string"==typeof a[s].color&&(a[s].color=u["default"].colorStringToNumber(a[s].color)),t.model.get("atom_labels_shown")&&r.addLabel(e.name,{fontSize:m,position:{x:e.positions[0],y:e.positions[1],z:e.positions[2]}}),r.setStyle({serial:e.serial},a)}):r.setStyle({},{stick:{}}),this.model.get("shapes").forEach(function(e){e.type&&r["add"+e.type](u["default"].getShapeSpec(e,t.setSelectionTrait))});var a=this.model.get("orbital");if(a.cube_file){var s=new p.VolumeData(a.cube_file,"cube");r.addIsosurface(s,{isoval:a.iso_val,color:g,opacity:a.opacity}),r.addIsosurface(s,{isoval:-a.iso_val,color:y,opacity:a.opacity})}return r.setBackgroundColor(u["default"].colorStringToNumber(this.model.get("background_color")),this.model.get("background_opacity")),r.setClickable({},!0,this.onClick.bind(this)),r.render(),e&&(r.zoomTo(),r.zoom(.8,2e3)),r},onClick:function(e){var t=this.model.get("model_data").atoms,r=t[e.serial],i=this.model.get("selection_type"),o=this.model.get("selected_atom_indices"),n=f["default"].addSelection(t,o,r,i);this.model.set("selected_atom_indices",n),this.model.save()}});t["default"]=b}).call(t,r(13))},function(e,t){e.exports=require("backbone")},function(e,t){e.exports=require("jquery")},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(14),n=i(o),a=(0,n["default"])({DEVELOPMENT:null});t["default"]=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={ARROW:"Arrow",SPHERE:"Sphere",CYLINDER:"Cylinder"};t["default"]=r},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Nbmolviz3dReact=t.MolWidget3DView=t.MolWidget3DModel=void 0;var o=r(5),n=i(o),a=r(2),s=i(a),l=r(3),c=i(l),u=r(12),h=i(u);window&&(window.jquery=n["default"],window.$=n["default"]),t.MolWidget3DModel=s["default"],t.MolWidget3DView=c["default"],t.Nbmolviz3dReact=h["default"]},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(7),n=i(o),a={colorStringToNumber:function(e){if(4!==e.length&&7!==e.length)return e;if("#"!==e[0])return e;var t=parseInt(e.substr(1,e.length-1),16);return isNaN(t)?e:t},getShapeSpec:function(e,t){var r=void 0;e.color&&(r=a.colorStringToNumber(e.color));var i=Object.assign({},{alpha:.8,callback:t,clickable:!1,color:65027,radius:e.radius},e,{color:r});if(e.type===n["default"].ARROW)i.start=e.start,i.end=e.end;else if(e.type===n["default"].SPHERE)i.center=e.center;else{if(e.type!==n["default"].CYLINDER)throw new Error("Invalid shape type.");i.fromCap=!0,i.toCap=!0,i.start=e.start,i.end=e.end}return i}};t["default"]=a},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),n=i(o),a={modelDataToCDJSON:function(e){var t=e.atoms.map(function(e){return{l:e.elem,x:e.positions[0],y:e.positions[1],z:e.positions[2],mass:e.mass_magnitude}}),r=e.bonds.map(function(e){return{b:e.atom1_index,e:e.atom2_index,o:e.bond_order}});return{m:[{a:t,b:r}]}},addSelection:function(e,t,r,i){var o=t.slice(),s=t.indexOf(r.serial),l=s===-1;return i===n["default"].ATOM?(l?o.push(r.serial):o.splice(s,1),o):(l?e.forEach(function(e){a.isSameGroup(r,e,i)&&o.push(e.serial)}):o=o.filter(function(t){var o=e[t];return!a.isSameGroup(r,o,i)}),o)},isSameGroup:function(e,t,r){if(r===n["default"].RESIDUE)return e.residue_index===t.residue_index;if(r===n["default"].CHAIN)return e.chain===t.chain;throw new Error("selectionType must be either residue or chain")}};t["default"]=a},function(e,t,r){var o,s,l,o,s,l,c,c,o,l,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(r,i){"object"===u(t)&&"undefined"!=typeof e?i(t):(s=[t],o=i,l="function"==typeof o?o.apply(t,s):o,!(void 0!==l&&(e.exports=l)))}(void 0,function(e){"use strict";function t(e,t,r){for(var i=(e.byteLength,0),o=r.length;i<o;i++){var n=r.charCodeAt(i);if(n<128)e.setUint8(t++,n>>>0&127|0);else if(n<2048)e.setUint8(t++,n>>>6&31|192),e.setUint8(t++,n>>>0&63|128);else if(n<65536)e.setUint8(t++,n>>>12&15|224),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128);else{if(!(n<1114112))throw new Error("bad codepoint "+n);e.setUint8(t++,n>>>18&7|240),e.setUint8(t++,n>>>12&63|128),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128)}}}function r(e){for(var t=0,r=0,i=e.length;r<i;r++){var o=e.charCodeAt(r);if(o<128)t+=1;else if(o<2048)t+=2;else if(o<65536)t+=3;else{if(!(o<1114112))throw new Error("bad codepoint "+o);t+=4}}return t}function i(e,o,n){var a="undefined"==typeof e?"undefined":u(e);if("string"===a){var s=r(e);if(s<32)return o.setUint8(n,160|s),t(o,n+1,e),1+s;if(s<256)return o.setUint8(n,217),o.setUint8(n+1,s),t(o,n+2,e),2+s;if(s<65536)return o.setUint8(n,218),o.setUint16(n+1,s),t(o,n+3,e),3+s;if(s<4294967296)return o.setUint8(n,219),o.setUint32(n+1,s),t(o,n+5,e),5+s}if(e instanceof Uint8Array){var s=e.byteLength,l=new Uint8Array(o.buffer);if(s<256)return o.setUint8(n,196),o.setUint8(n+1,s),l.set(e,n+2),2+s;if(s<65536)return o.setUint8(n,197),o.setUint16(n+1,s),l.set(e,n+3),3+s;if(s<4294967296)return o.setUint8(n,198),o.setUint32(n+1,s),l.set(e,n+5),5+s}if("number"===a){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return o.setUint8(n,203),o.setFloat64(n+1,e),9;if(e>=0){if(e<128)return o.setUint8(n,e),1;if(e<256)return o.setUint8(n,204),o.setUint8(n+1,e),2;if(e<65536)return o.setUint8(n,205),o.setUint16(n+1,e),3;if(e<4294967296)return o.setUint8(n,206),o.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return o.setInt8(n,e),1;if(e>=-128)return o.setUint8(n,208),o.setInt8(n+1,e),2;if(e>=-32768)return o.setUint8(n,209),o.setInt16(n+1,e),3;if(e>=-2147483648)return o.setUint8(n,210),o.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return o.setUint8(n,192),1;if("boolean"===a)return o.setUint8(n,e?195:194),1;if("object"===a){var s,c=0,h=Array.isArray(e);if(h)s=e.length;else{var f=Object.keys(e);s=f.length}var c;if(s<16?(o.setUint8(n,s|(h?144:128)),c=1):s<65536?(o.setUint8(n,h?220:222),o.setUint16(n+1,s),c=3):s<4294967296&&(o.setUint8(n,h?221:223),o.setUint32(n+1,s),c=5),h)for(var d=0;d<s;d++)c+=i(e[d],o,n+c);else for(var d=0;d<s;d++){var p=f[d];c+=i(p,o,n+c),c+=i(e[p],o,n+c)}return c}throw new Error("Unknown type "+a)}function o(e){var t="undefined"==typeof e?"undefined":u(e);if("string"===t){var i=r(e);if(i<32)return 1+i;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(e instanceof Uint8Array){var i=e.byteLength;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null===e)return 1;if("object"===t){var i,n=0;if(Array.isArray(e)){i=e.length;for(var a=0;a<i;a++)n+=o(e[a])}else{var s=Object.keys(e);i=s.length;for(var a=0;a<i;a++){var l=s[a];n+=o(l)+o(e[l])}}if(i<16)return 1+n;if(i<65536)return 3+n;if(i<4294967296)return 5+n;throw new Error("Array or object too long 0x"+i.toString(16))}throw new Error("Unknown type "+t)}function n(e){var t=new ArrayBuffer(o(e)),r=new DataView(t);return i(e,r,0),new Uint8Array(t)}function a(e,t,r){return t?new e(t.buffer,t.byteOffset,t.byteLength/(r||1)):void 0}function s(e){return a(DataView,e)}function l(e){return a(Uint8Array,e)}function c(e){return a(Int8Array,e)}function h(e){return a(Int32Array,e,4)}function f(e){return a(Float32Array,e,4)}function d(e,t){var r=e.length/2;t||(t=new Int16Array(r));for(var i=0,o=0;i<r;++i,o+=2)t[i]=e[o]<<8^e[o+1]<<0;return t}function p(e,t){var r=e.length;t||(t=new Uint8Array(2*r));for(var i=s(t),o=0;o<r;++o)i.setInt16(2*o,e[o]);return l(t)}function v(e,t){var r=e.length/4;t||(t=new Int32Array(r));for(var i=0,o=0;i<r;++i,o+=4)t[i]=e[o]<<24^e[o+1]<<16^e[o+2]<<8^e[o+3]<<0;return t}function m(e,t){var r=e.length;t||(t=new Uint8Array(4*r));for(var i=s(t),o=0;o<r;++o)i.setInt32(4*o,e[o]);return l(t)}function g(e,t){var r=e.length;t||(t=new Float32Array(r/4));for(var i=s(t),o=s(e),n=0,a=0,l=r/4;n<l;++n,a+=4)i.setFloat32(a,o.getFloat32(a),!0);return t}function y(e,t,r){var i=e.length,o=1/t;r||(r=new Float32Array(i));for(var n=0;n<i;++n)r[n]=e[n]*o;return r}function b(e,t,r){var i=e.length;r||(r=new Int32Array(i));for(var o=0;o<i;++o)r[o]=Math.round(e[o]*t);return r}function x(e,t){var r,i;if(!t){var o=0;for(r=0,i=e.length;r<i;r+=2)o+=e[r+1];t=new e.constructor(o)}var n=0;for(r=0,i=e.length;r<i;r+=2)for(var a=e[r],s=e[r+1],l=0;l<s;++l)t[n]=a,++n;return t}function w(e){if(0===e.length)return new Int32Array(0);var t,r,i=2;for(t=1,r=e.length;t<r;++t)e[t-1]!==e[t]&&(i+=2);var o=new Int32Array(i),n=0,a=1;for(t=1,r=e.length;t<r;++t)e[t-1]!==e[t]?(o[n]=e[t-1],o[n+1]=a,a=1,n+=2):++a;return o[n]=e[e.length-1],o[n+1]=a,o}function C(e,t){var r=e.length;t||(t=new e.constructor(r)),r&&(t[0]=e[0]);for(var i=1;i<r;++i)t[i]=e[i]+t[i-1];return t}function _(e,t){var r=e.length;t||(t=new e.constructor(r)),t[0]=e[0];for(var i=1;i<r;++i)t[i]=e[i]-e[i-1];return t}function A(e,t){var r,i,o=e instanceof Int8Array?127:32767,n=-o-1,a=e.length;if(!t){var s=0;for(r=0;r<a;++r)e[r]<o&&e[r]>n&&++s;t=new Int32Array(s)}for(r=0,i=0;r<a;){for(var l=0;(e[r]===o||e[r]===n)&&(l+=e[r],++r,0!==e[r]););l+=e[r],++r,t[i]=l,++i}return t}function M(e,t){var r,i=t?127:32767,o=-i-1,n=e.length,a=0;for(r=0;r<n;++r){var s=e[r];0===s?++a:a+=s===i||s===o?2:s>0?Math.ceil(s/i):Math.ceil(s/o)}var l=t?new Int8Array(a):new Int16Array(a),c=0;for(r=0;r<n;++r){var s=e[r];if(s>=0)for(;s>=i;)l[c]=i,++c,s-=i;else for(;s<=o;)l[c]=o,++c,s-=o;l[c]=s,++c}return l}function S(e,t){return C(x(e),t)}function z(e){return w(_(e))}function L(e,t,r){return y(x(e,h(r)),t,r)}function T(e,t){return w(b(e,t))}function F(e,t,r){return y(C(e,h(r)),t,r)}function I(e,t,r){return _(b(e,t),r)}function E(e,t,r){return y(A(e,h(r)),t,r)}function O(e,t,r){var i=A(e,h(r));return F(i,t,f(i))}function k(e,t,r){return M(I(e,t),r)}function P(e){var t=s(e),r=t.getInt32(0),i=t.getInt32(4),o=e.subarray(8,12),e=e.subarray(12);return[r,e,i,o]}function V(e,t,r,i){var o=new ArrayBuffer(12+i.byteLength),n=new Uint8Array(o),a=new DataView(o);return a.setInt32(0,e),a.setInt32(4,t),r&&n.set(r,8),n.set(i,12),n}function R(e){var t=e.length,r=l(e);return V(2,t,void 0,r)}function D(e){var t=e.length,r=m(e);return V(4,t,void 0,r)}function N(e,t){var r=e.length/t,i=m([t]),o=l(e);return V(5,r,i,o)}function U(e){var t=e.length,r=m(w(e));return V(6,t,void 0,r)}function B(e){var t=e.length,r=m(z(e));return V(8,t,void 0,r)}function j(e,t){var r=e.length,i=m([t]),o=m(T(e,t));return V(9,r,i,o)}function G(e,t){var r=e.length,i=m([t]),o=p(k(e,t));return V(10,r,i,o)}function H(e){var t={};return te.forEach(function(r){void 0!==e[r]&&(t[r]=e[r])}),e.bondAtomList&&(t.bondAtomList=D(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=R(e.bondOrderList)),t.xCoordList=G(e.xCoordList,1e3),t.yCoordList=G(e.yCoordList,1e3),t.zCoordList=G(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=G(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=B(e.atomIdList)),e.altLocList&&(t.altLocList=U(e.altLocList)),e.occupancyList&&(t.occupancyList=j(e.occupancyList,100)),t.groupIdList=B(e.groupIdList),t.groupTypeList=D(e.groupTypeList),e.secStructList&&(t.secStructList=R(e.secStructList,1)),e.insCodeList&&(t.insCodeList=U(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=B(e.sequenceIndexList)),t.chainIdList=N(e.chainIdList,4),e.chainNameList&&(t.chainNameList=N(e.chainNameList,4)),t}function W(e){function t(e){for(var t={},r=0;r<e;r++){var i=n();t[i]=n()}return t}function r(t){var r=e.subarray(a,a+t);return a+=t,r}function i(t){var r=e.subarray(a,a+t);a+=t;var i=65535;if(t>i){for(var o=[],n=0;n<r.length;n+=i)o.push(String.fromCharCode.apply(null,r.subarray(n,n+i)));return o.join("")}return String.fromCharCode.apply(null,r)}function o(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=n();return t}function n(){var n,l,c=e[a];if(0===(128&c))return a++,c;if(128===(240&c))return l=15&c,a++,t(l);if(144===(240&c))return l=15&c,a++,o(l);if(160===(224&c))return l=31&c,a++,i(l);if(224===(224&c))return n=s.getInt8(a),a++,n;switch(c){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return l=s.getUint8(a+1),a+=2,r(l);case 197:return l=s.getUint16(a+1),a+=3,r(l);case 198:return l=s.getUint32(a+1),a+=5,r(l);case 202:return n=s.getFloat32(a+1),a+=5,n;case 203:return n=s.getFloat64(a+1),a+=9,n;case 204:return n=e[a+1],a+=2,n;case 205:return n=s.getUint16(a+1),a+=3,n;case 206:return n=s.getUint32(a+1),a+=5,n;case 208:return n=s.getInt8(a+1),a+=2,n;case 209:return n=s.getInt16(a+1),a+=3,n;case 210:return n=s.getInt32(a+1),a+=5,n;case 217:return l=s.getUint8(a+1),a+=2,i(l);case 218:return l=s.getUint16(a+1),a+=3,i(l);case 219:return l=s.getUint32(a+1),a+=5,i(l);case 220:return l=s.getUint16(a+1),a+=3,o(l);case 221:return l=s.getUint32(a+1),a+=5,o(l);case 222:return l=s.getUint16(a+1),a+=3,t(l);case 223:return l=s.getUint32(a+1),a+=5,t(l)}throw new Error("Unknown type 0x"+c.toString(16))}var a=0,s=new DataView(e.buffer);return n()}function q(e,t,r,i){switch(e){case 1:return g(t);case 2:return c(t);case 3:return d(t);case 4:return v(t);case 5:return l(t);case 6:return x(v(t),new Uint8Array(r));case 7:return x(v(t));case 8:return S(v(t));case 9:return L(v(t),v(i)[0]);case 10:return O(d(t),v(i)[0]);case 11:return y(d(t),v(i)[0]);case 12:return E(d(t),v(i)[0]);case 13:return E(c(t),v(i)[0]);case 14:return A(d(t));case 15:return A(c(t))}}function Y(e,t){t=t||{};var r=t.ignoreFields,i={};return ie.forEach(function(t){var o=!!r&&r.indexOf(t)!==-1,n=e[t];o||void 0===n||(n instanceof Uint8Array?i[t]=q.apply(null,P(n)):i[t]=n)}),i}function Z(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function $(e,t,r){r=r||{};var i,o,n,a,s,l,c=r.firstModelOnly,u=t.onModel,h=t.onChain,f=t.onGroup,d=t.onAtom,p=t.onBond,v=0,m=0,g=0,y=0,b=0,x=-1,w=e.chainNameList,C=e.secStructList,_=e.insCodeList,A=e.sequenceIndexList,M=e.atomIdList,S=e.bFactorList,z=e.altLocList,L=e.occupancyList,T=e.bondAtomList,F=e.bondOrderList;for(i=0,o=e.chainsPerModel.length;i<o&&!(c&&v>0);++i){var I=e.chainsPerModel[v];for(u&&u({chainCount:I,modelIndex:v}),n=0;n<I;++n){var E=e.groupsPerChain[m];if(h){var O=Z(e.chainIdList.subarray(4*m,4*m+4)),k=null;w&&(k=Z(w.subarray(4*m,4*m+4))),h({groupCount:E,chainIndex:m,modelIndex:v,chainId:O,chainName:k})}for(a=0;a<E;++a){var P=e.groupList[e.groupTypeList[g]],V=P.atomNameList.length;if(f){var R=null;C&&(R=C[g]);var D=null;e.insCodeList&&(D=String.fromCharCode(_[g]));var N=null;A&&(N=A[g]),f({atomCount:V,groupIndex:g,chainIndex:m,modelIndex:v,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:P.groupName,singleLetterCode:P.singleLetterCode,chemCompType:P.chemCompType,secStruct:R,insCode:D,sequenceIndex:N})}for(s=0;s<V;++s){if(d){var U=null;M&&(U=M[y]);var B=null;S&&(B=S[y]);var j=null;z&&(j=String.fromCharCode(z[y]));var G=null;L&&(G=L[y]),d({atomIndex:y,groupIndex:g,chainIndex:m,modelIndex:v,atomId:U,element:P.elementList[s],atomName:P.atomNameList[s],formalCharge:P.formalChargeList[s],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:B,altLoc:j,occupancy:G})}y+=1}if(p){var H=P.bondAtomList;for(s=0,l=P.bondOrderList.length;s<l;++s)p({atomIndex1:y-V+H[2*s],atomIndex2:y-V+H[2*s+1],bondOrder:P.bondOrderList[s]})}g+=1}m+=1}if(b=x+1,x=y-1,p&&T)for(s=0,l=T.length;s<l;s+=2){var W=T[s],q=T[s+1];(W>=b&&W<=x||q>=b&&q<=x)&&p({atomIndex1:W,atomIndex2:q,bondOrder:F?F[s/2]:null})}v+=1}}function X(e){return n(H(e))}function Q(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var r;return r=e instanceof Uint8Array?W(e):e,Y(r,t)}function K(e,t,r,i){function o(){try{var e=Q(n.response);r(e)}catch(t){i(t)}}var n=new XMLHttpRequest;n.addEventListener("load",o,!0),n.addEventListener("error",i,!0),n.responseType="arraybuffer",n.open("GET",t+e.toUpperCase()),n.send()}function J(e,t,r){K(e,ae,t,r)}function ee(e,t,r){K(e,se,t,r)}var te=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],re=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],ie=te.concat(re),oe="v0.3.0",ne="http://mmtf.rcsb.org/v0.2/",ae=ne+"full/",se=ne+"reduced/";e.encode=X,e.decode=Q,e.traverse=$,e.fetch=J,e.fetchReduced=ee,e.version=oe,e.fetchUrl=ae,e.fetchReducedUrl=se,e.encodeMsgpack=n,e.encodeMmtf=H,e.decodeMsgpack=W,e.decodeMmtf=Y}),function(r){if("object"===u(t)&&"undefined"!=typeof e)e.exports=r();else{s=[],o=r,l="function"==typeof o?o.apply(t,s):o,!(void 0!==l&&(e.exports=l))}}(function(){return function e(t,r,i){function o(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof c&&c;if(!s&&l)return c(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var r=t[a][1][e];return o(r?r:e)},h,h.exports,e,t,r,i)}return r[a].exports}for(var n="function"==typeof c&&c,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==("undefined"==typeof r?"undefined":u(r)))throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,r,i,o){if(t.subarray&&e.subarray)return void e.set(t.subarray(r,r+i),o);for(var n=0;n<i;n++)e[o+n]=t[r+n]},flattenChunks:function(e){var t,r,i,o,n,a;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(a=new Uint8Array(i),o=0,t=0,r=e.length;t<r;t++)n=e[t],a.set(n,o),o+=n.length;return a}},n={arraySet:function(e,t,r,i,o){for(var n=0;n<i;n++)e[o+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,n))},r.setTyped(i)},{}],2:[function(e,t,r){"use strict";function i(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,o.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}var o=e("./common"),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(s){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){a=!1}for(var l=new o.Buf8(256),c=0;c<256;c++)l[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;l[254]=l[254]=1,r.string2buf=function(e){var t,r,i,n,a,s=e.length,l=0;for(n=0;n<s;n++)r=e.charCodeAt(n),55296===(64512&r)&&n+1<s&&(i=e.charCodeAt(n+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new o.Buf8(l),a=0,n=0;a<l;n++)r=e.charCodeAt(n),55296===(64512&r)&&n+1<s&&(i=e.charCodeAt(n+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},r.buf2binstring=function(e){return i(e,e.length)},r.binstring2buf=function(e){for(var t=new o.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,o,n,a,s=t||e.length,c=new Array(2*s);for(o=0,r=0;r<s;)if(n=e[r++],n<128)c[o++]=n;else if(a=l[n],a>4)c[o++]=65533,r+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&r<s;)n=n<<6|63&e[r++],a--;a>1?c[o++]=65533:n<65536?c[o++]=n:(n-=65536,c[o++]=55296|n>>10&1023,c[o++]=56320|1023&n)}return i(c,o)},r.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&128===(192&e[r]);)r--;return r<0?t:0===r?t:r+l[e[r]]>t?r:t}},{"./common":1}],3:[function(e,t,r){"use strict";function i(e,t,r,i){for(var o=65535&e|0,n=e>>>16&65535|0,a=0;0!==r;){a=r>2e3?2e3:r,r-=a;do o=o+t[i++]|0,n=n+o|0;while(--a);o%=65521,n%=65521}return o|n<<16|0}t.exports=i},{}],4:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,r){"use strict";function i(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}function o(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return e^-1}var n=i();t.exports=o},{}],6:[function(e,t,r){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],7:[function(e,t,r){"use strict";var i=30,o=12;t.exports=function(e,t){var r,n,a,s,l,c,u,h,f,d,p,v,m,g,y,b,x,w,C,_,A,M,S,z,L;r=e.state,n=e.next_in,z=e.input,a=n+(e.avail_in-5),s=e.next_out,L=e.output,l=s-(t-e.avail_out),c=s+(e.avail_out-257),u=r.dmax,h=r.wsize,f=r.whave,d=r.wnext,p=r.window,v=r.hold,m=r.bits,g=r.lencode,y=r.distcode,b=(1<<r.lenbits)-1,x=(1<<r.distbits)-1;e:do{m<15&&(v+=z[n++]<<m,m+=8,v+=z[n++]<<m,m+=8),w=g[v&b];t:for(;;){if(C=w>>>24,v>>>=C,m-=C,C=w>>>16&255,0===C)L[s++]=65535&w;else{if(!(16&C)){if(0===(64&C)){w=g[(65535&w)+(v&(1<<C)-1)];continue t}if(32&C){r.mode=o;break e}e.msg="invalid literal/length code",r.mode=i;break e}_=65535&w,C&=15,C&&(m<C&&(v+=z[n++]<<m,m+=8),_+=v&(1<<C)-1,v>>>=C,m-=C),m<15&&(v+=z[n++]<<m,m+=8,v+=z[n++]<<m,m+=8),w=y[v&x];r:for(;;){if(C=w>>>24,v>>>=C,m-=C,C=w>>>16&255,!(16&C)){if(0===(64&C)){w=y[(65535&w)+(v&(1<<C)-1)];continue r}e.msg="invalid distance code",r.mode=i;break e}if(A=65535&w,C&=15,m<C&&(v+=z[n++]<<m,m+=8,m<C&&(v+=z[n++]<<m,m+=8)),A+=v&(1<<C)-1,A>u){e.msg="invalid distance too far back",r.mode=i;break e}if(v>>>=C,m-=C,C=s-l,A>C){if(C=A-C,C>f&&r.sane){e.msg="invalid distance too far back",r.mode=i;break e}if(M=0,S=p,0===d){if(M+=h-C,C<_){_-=C;do L[s++]=p[M++];while(--C);M=s-A,S=L}}else if(d<C){if(M+=h+d-C,C-=d,C<_){_-=C;do L[s++]=p[M++];while(--C);if(M=0,d<_){C=d,_-=C;do L[s++]=p[M++];while(--C);M=s-A,S=L}}}else if(M+=d-C,C<_){_-=C;do L[s++]=p[M++];while(--C);M=s-A,S=L}for(;_>2;)L[s++]=S[M++],L[s++]=S[M++],L[s++]=S[M++],_-=3;_&&(L[s++]=S[M++],_>1&&(L[s++]=S[M++]))}else{M=s-A;do L[s++]=L[M++],L[s++]=L[M++],L[s++]=L[M++],_-=3;while(_>2);_&&(L[s++]=L[M++],_>1&&(L[s++]=L[M++]))}break}}break}}while(n<a&&s<c);_=m>>3,n-=_,m-=_<<3,v&=(1<<m)-1,e.next_in=n,e.next_out=s,e.avail_in=n<a?5+(a-n):5-(n-a),e.avail_out=s<c?257+(c-s):257-(s-c),r.hold=v,r.bits=m}},{}],8:[function(e,t,r){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function n(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=V,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new g.Buf32(pe),t.distcode=t.distdyn=new g.Buf32(ve),t.sane=1,t.back=-1,L):I}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,n(e)):I}function s(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?I:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,a(e))):I}function l(e,t){var r,i;return e?(i=new o,e.state=i,i.window=null,r=s(e,t),r!==L&&(e.state=null),r):I}function c(e){return l(e,ge)}function u(e){if(ye){var t;for(v=new g.Buf32(512),m=new g.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(w(_,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;w(A,e.lens,0,32,m,0,e.work,{bits:5}),ye=!1}e.lencode=v,e.lenbits=9,e.distcode=m,e.distbits=5}function h(e,t,r,i){var o,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new g.Buf8(n.wsize)),i>=n.wsize?(g.arraySet(n.window,t,r-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(o=n.wsize-n.wnext,o>i&&(o=i),g.arraySet(n.window,t,r-i,o,n.wnext),i-=o,i?(g.arraySet(n.window,t,r-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=o,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=o))),0}function f(e,t){var r,o,n,a,s,l,c,f,d,p,v,m,pe,ve,me,ge,ye,be,xe,we,Ce,_e,Ae,Me,Se=0,ze=new g.Buf8(4),Le=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return I;r=e.state,r.mode===Y&&(r.mode=Z),s=e.next_out,n=e.output,c=e.avail_out,a=e.next_in,o=e.input,l=e.avail_in,f=r.hold,d=r.bits,p=l,v=c,_e=L;e:for(;;)switch(r.mode){case V:if(0===r.wrap){r.mode=Z;break}for(;d<16;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(2&r.wrap&&35615===f){r.check=0,ze[0]=255&f,ze[1]=f>>>8&255,r.check=b(r.check,ze,2,0),f=0,d=0,r.mode=R;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",r.mode=he;break}if((15&f)!==P){e.msg="unknown compression method",r.mode=he;break}if(f>>>=4,d-=4,Ce=(15&f)+8,0===r.wbits)r.wbits=Ce;else if(Ce>r.wbits){e.msg="invalid window size",r.mode=he;break}r.dmax=1<<Ce,e.adler=r.check=1,r.mode=512&f?W:Y,f=0,d=0;break;case R:for(;d<16;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(r.flags=f,(255&r.flags)!==P){e.msg="unknown compression method",r.mode=he;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=he;break}r.head&&(r.head.text=f>>8&1),512&r.flags&&(ze[0]=255&f,ze[1]=f>>>8&255,r.check=b(r.check,ze,2,0)),f=0,d=0,r.mode=D;case D:for(;d<32;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.head&&(r.head.time=f),512&r.flags&&(ze[0]=255&f,ze[1]=f>>>8&255,ze[2]=f>>>16&255,ze[3]=f>>>24&255,r.check=b(r.check,ze,4,0)),f=0,d=0,r.mode=N;case N:for(;d<16;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&r.flags&&(ze[0]=255&f,ze[1]=f>>>8&255,r.check=b(r.check,ze,2,0)),f=0,d=0,r.mode=U;case U:if(1024&r.flags){for(;d<16;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.length=f,r.head&&(r.head.extra_len=f),512&r.flags&&(ze[0]=255&f,ze[1]=f>>>8&255,r.check=b(r.check,ze,2,0)),f=0,d=0}else r.head&&(r.head.extra=null);r.mode=B;case B:if(1024&r.flags&&(m=r.length,m>l&&(m=l),m&&(r.head&&(Ce=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),g.arraySet(r.head.extra,o,a,m,Ce)),512&r.flags&&(r.check=b(r.check,o,m,a)),l-=m,a+=m,r.length-=m),r.length))break e;r.length=0,r.mode=j;case j:if(2048&r.flags){if(0===l)break e;m=0;do Ce=o[a+m++],r.head&&Ce&&r.length<65536&&(r.head.name+=String.fromCharCode(Ce));while(Ce&&m<l);if(512&r.flags&&(r.check=b(r.check,o,m,a)),l-=m,a+=m,Ce)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=G;case G:if(4096&r.flags){if(0===l)break e;m=0;do Ce=o[a+m++],r.head&&Ce&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ce));while(Ce&&m<l);if(512&r.flags&&(r.check=b(r.check,o,m,a)),l-=m,a+=m,Ce)break e}else r.head&&(r.head.comment=null);r.mode=H;case H:if(512&r.flags){for(;d<16;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(f!==(65535&r.check)){e.msg="header crc mismatch",r.mode=he;break}f=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Y;break;case W:for(;d<32;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}e.adler=r.check=i(f),f=0,d=0,r.mode=q;case q:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=l,r.hold=f,r.bits=d,F;e.adler=r.check=1,r.mode=Y;case Y:if(t===S||t===z)break e;case Z:if(r.last){f>>>=7&d,d-=7&d,r.mode=le;break}for(;d<3;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}switch(r.last=1&f,f>>>=1,d-=1,3&f){case 0:r.mode=$;break;case 1:if(u(r),r.mode=te,t===z){f>>>=2,d-=2;break e}break;case 2:r.mode=K;break;case 3:e.msg="invalid block type",r.mode=he}f>>>=2,d-=2;break;case $:for(f>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if((65535&f)!==(f>>>16^65535)){
e.msg="invalid stored block lengths",r.mode=he;break}if(r.length=65535&f,f=0,d=0,r.mode=X,t===z)break e;case X:r.mode=Q;case Q:if(m=r.length){if(m>l&&(m=l),m>c&&(m=c),0===m)break e;g.arraySet(n,o,a,m,s),l-=m,a+=m,c-=m,s+=m,r.length-=m;break}r.mode=Y;break;case K:for(;d<14;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(r.nlen=(31&f)+257,f>>>=5,d-=5,r.ndist=(31&f)+1,f>>>=5,d-=5,r.ncode=(15&f)+4,f>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=he;break}r.have=0,r.mode=J;case J:for(;r.have<r.ncode;){for(;d<3;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.lens[Le[r.have++]]=7&f,f>>>=3,d-=3}for(;r.have<19;)r.lens[Le[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ae={bits:r.lenbits},_e=w(C,r.lens,0,19,r.lencode,0,r.work,Ae),r.lenbits=Ae.bits,_e){e.msg="invalid code lengths set",r.mode=he;break}r.have=0,r.mode=ee;case ee:for(;r.have<r.nlen+r.ndist;){for(;Se=r.lencode[f&(1<<r.lenbits)-1],me=Se>>>24,ge=Se>>>16&255,ye=65535&Se,!(me<=d);){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(ye<16)f>>>=me,d-=me,r.lens[r.have++]=ye;else{if(16===ye){for(Me=me+2;d<Me;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(f>>>=me,d-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=he;break}Ce=r.lens[r.have-1],m=3+(3&f),f>>>=2,d-=2}else if(17===ye){for(Me=me+3;d<Me;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}f>>>=me,d-=me,Ce=0,m=3+(7&f),f>>>=3,d-=3}else{for(Me=me+7;d<Me;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}f>>>=me,d-=me,Ce=0,m=11+(127&f),f>>>=7,d-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=he;break}for(;m--;)r.lens[r.have++]=Ce}}if(r.mode===he)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=he;break}if(r.lenbits=9,Ae={bits:r.lenbits},_e=w(_,r.lens,0,r.nlen,r.lencode,0,r.work,Ae),r.lenbits=Ae.bits,_e){e.msg="invalid literal/lengths set",r.mode=he;break}if(r.distbits=6,r.distcode=r.distdyn,Ae={bits:r.distbits},_e=w(A,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ae),r.distbits=Ae.bits,_e){e.msg="invalid distances set",r.mode=he;break}if(r.mode=te,t===z)break e;case te:r.mode=re;case re:if(l>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=l,r.hold=f,r.bits=d,x(e,v),s=e.next_out,n=e.output,c=e.avail_out,a=e.next_in,o=e.input,l=e.avail_in,f=r.hold,d=r.bits,r.mode===Y&&(r.back=-1);break}for(r.back=0;Se=r.lencode[f&(1<<r.lenbits)-1],me=Se>>>24,ge=Se>>>16&255,ye=65535&Se,!(me<=d);){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(ge&&0===(240&ge)){for(be=me,xe=ge,we=ye;Se=r.lencode[we+((f&(1<<be+xe)-1)>>be)],me=Se>>>24,ge=Se>>>16&255,ye=65535&Se,!(be+me<=d);){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}f>>>=be,d-=be,r.back+=be}if(f>>>=me,d-=me,r.back+=me,r.length=ye,0===ge){r.mode=se;break}if(32&ge){r.back=-1,r.mode=Y;break}if(64&ge){e.msg="invalid literal/length code",r.mode=he;break}r.extra=15&ge,r.mode=ie;case ie:if(r.extra){for(Me=r.extra;d<Me;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=oe;case oe:for(;Se=r.distcode[f&(1<<r.distbits)-1],me=Se>>>24,ge=Se>>>16&255,ye=65535&Se,!(me<=d);){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(0===(240&ge)){for(be=me,xe=ge,we=ye;Se=r.distcode[we+((f&(1<<be+xe)-1)>>be)],me=Se>>>24,ge=Se>>>16&255,ye=65535&Se,!(be+me<=d);){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}f>>>=be,d-=be,r.back+=be}if(f>>>=me,d-=me,r.back+=me,64&ge){e.msg="invalid distance code",r.mode=he;break}r.offset=ye,r.extra=15&ge,r.mode=ne;case ne:if(r.extra){for(Me=r.extra;d<Me;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=he;break}r.mode=ae;case ae:if(0===c)break e;if(m=v-c,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=he;break}m>r.wnext?(m-=r.wnext,pe=r.wsize-m):pe=r.wnext-m,m>r.length&&(m=r.length),ve=r.window}else ve=n,pe=s-r.offset,m=r.length;m>c&&(m=c),c-=m,r.length-=m;do n[s++]=ve[pe++];while(--m);0===r.length&&(r.mode=re);break;case se:if(0===c)break e;n[s++]=r.length,c--,r.mode=re;break;case le:if(r.wrap){for(;d<32;){if(0===l)break e;l--,f|=o[a++]<<d,d+=8}if(v-=c,e.total_out+=v,r.total+=v,v&&(e.adler=r.check=r.flags?b(r.check,n,v,s-v):y(r.check,n,v,s-v)),v=c,(r.flags?f:i(f))!==r.check){e.msg="incorrect data check",r.mode=he;break}f=0,d=0}r.mode=ce;case ce:if(r.wrap&&r.flags){for(;d<32;){if(0===l)break e;l--,f+=o[a++]<<d,d+=8}if(f!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=he;break}f=0,d=0}r.mode=ue;case ue:_e=T;break e;case he:_e=E;break e;case fe:return O;case de:default:return I}return e.next_out=s,e.avail_out=c,e.next_in=a,e.avail_in=l,r.hold=f,r.bits=d,(r.wsize||v!==e.avail_out&&r.mode<he&&(r.mode<le||t!==M))&&h(e,e.output,e.next_out,v-e.avail_out)?(r.mode=fe,O):(p-=e.avail_in,v-=e.avail_out,e.total_in+=p,e.total_out+=v,r.total+=v,r.wrap&&v&&(e.adler=r.check=r.flags?b(r.check,n,v,e.next_out-v):y(r.check,n,v,e.next_out-v)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Y?128:0)+(r.mode===te||r.mode===X?256:0),(0===p&&0===v||t===M)&&_e===L&&(_e=k),_e)}function d(e){if(!e||!e.state)return I;var t=e.state;return t.window&&(t.window=null),e.state=null,L}function p(e,t){var r;return e&&e.state?(r=e.state,0===(2&r.wrap)?I:(r.head=t,t.done=!1,L)):I}var v,m,g=e("../utils/common"),y=e("./adler32"),b=e("./crc32"),x=e("./inffast"),w=e("./inftrees"),C=0,_=1,A=2,M=4,S=5,z=6,L=0,T=1,F=2,I=-2,E=-3,O=-4,k=-5,P=8,V=1,R=2,D=3,N=4,U=5,B=6,j=7,G=8,H=9,W=10,q=11,Y=12,Z=13,$=14,X=15,Q=16,K=17,J=18,ee=19,te=20,re=21,ie=22,oe=23,ne=24,ae=25,se=26,le=27,ce=28,ue=29,he=30,fe=31,de=32,pe=852,ve=592,me=15,ge=me,ye=!0;r.inflateReset=a,r.inflateReset2=s,r.inflateResetKeep=n,r.inflateInit=c,r.inflateInit2=l,r.inflate=f,r.inflateEnd=d,r.inflateGetHeader=p,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,r){"use strict";var i=e("../utils/common"),o=15,n=852,a=592,s=0,l=1,c=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,p,v,m,g,y){var b,x,w,C,_,A,M,S,z,L=y.bits,T=0,F=0,I=0,E=0,O=0,k=0,P=0,V=0,R=0,D=0,N=null,U=0,B=new i.Buf16(o+1),j=new i.Buf16(o+1),G=null,H=0;for(T=0;T<=o;T++)B[T]=0;for(F=0;F<p;F++)B[t[r+F]]++;for(O=L,E=o;E>=1&&0===B[E];E--);if(O>E&&(O=E),0===E)return v[m++]=20971520,v[m++]=20971520,y.bits=1,0;for(I=1;I<E&&0===B[I];I++);for(O<I&&(O=I),V=1,T=1;T<=o;T++)if(V<<=1,V-=B[T],V<0)return-1;if(V>0&&(e===s||1!==E))return-1;for(j[1]=0,T=1;T<o;T++)j[T+1]=j[T]+B[T];for(F=0;F<p;F++)0!==t[r+F]&&(g[j[t[r+F]]++]=F);if(e===s?(N=G=g,A=19):e===l?(N=u,U-=257,G=h,H-=257,A=256):(N=f,G=d,A=-1),D=0,F=0,T=I,_=m,k=O,P=0,w=-1,R=1<<O,C=R-1,e===l&&R>n||e===c&&R>a)return 1;for(var W=0;;){W++,M=T-P,g[F]<A?(S=0,z=g[F]):g[F]>A?(S=G[H+g[F]],z=N[U+g[F]]):(S=96,z=0),b=1<<T-P,x=1<<k,I=x;do x-=b,v[_+(D>>P)+x]=M<<24|S<<16|z|0;while(0!==x);for(b=1<<T-1;D&b;)b>>=1;if(0!==b?(D&=b-1,D+=b):D=0,F++,0===--B[T]){if(T===E)break;T=t[r+g[F]]}if(T>O&&(D&C)!==w){for(0===P&&(P=O),_+=I,k=T-P,V=1<<k;k+P<E&&(V-=B[k+P],!(V<=0));)k++,V<<=1;if(R+=1<<k,e===l&&R>n||e===c&&R>a)return 1;w=D&C,v[w]=O<<24|k<<16|_-m|0}}return 0!==D&&(v[_+D]=T-P<<24|64<<16|0),y.bits=O,0}},{"../utils/common":1}],10:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,r){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}],"/lib/inflate.js":[function(e,t,r){"use strict";function i(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}function o(e,t){return t=t||{},t.raw=!0,i(e,t)}var n=e("./zlib/inflate.js"),a=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),u=e("./zlib/zstream"),h=e("./zlib/gzheader"),f=Object.prototype.toString,d=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==l.Z_OK)throw new Error(c[r]);this.header=new h,n.inflateGetHeader(this.strm,this.header)};d.prototype.push=function(e,t){var r,i,o,c,u,h=this.strm,d=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?h.input=s.binstring2buf(e):"[object ArrayBuffer]"===f.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),r=n.inflate(h,l.Z_NO_FLUSH),r!==l.Z_STREAM_END&&r!==l.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==l.Z_STREAM_END&&(0!==h.avail_in||i!==l.Z_FINISH&&i!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(o=s.utf8border(h.output,h.next_out),c=h.next_out-o,u=s.buf2string(h.output,o),h.next_out=c,h.avail_out=d-c,c&&a.arraySet(h.output,h.output,o,c,0),this.onData(u)):this.onData(a.shrinkBuf(h.output,h.next_out))))}while(h.avail_in>0&&r!==l.Z_STREAM_END);return r===l.Z_STREAM_END&&(i=l.Z_FINISH),i===l.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l.Z_OK):i!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=d,r.inflate=i,r.inflateRaw=o,r.ungzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),h=function(e){var t=e.$3Dmol||{};return t}(window),"https:"!=document.location.protocol&&$.get("http://3dmol.csb.pitt.edu/track/report.cgi"),String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}),$.ajaxTransport("+binary",function(e,t,r){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,r){var i=new XMLHttpRequest,o=e.url,n=e.type,a=e.async||!0,s=e.responseType||"blob",l=e.data||null,c=e.username||null,u=e.password||null;i.addEventListener("load",function(){var t={};t[e.dataType]=i.response,r(i.status,i.statusText,t,i.getAllResponseHeaders())}),i.open(n,o,a,c,u);for(var h in t)i.setRequestHeader(h,t[h]);i.responseType=s,i.send(l)},abort:function(){r.abort()}}}),h.createViewer=function(e,t){if("string"===$.type(e)&&(e=$("#"+e)),e){t=t||{};try{return new h.GLViewer(e,t)}catch(r){throw"error creating viewer: "+r}return null}},h.viewers={},h.download=function(e,t,r,i){var o="",n="",a=t.addModel();if("mmtf:"===e.substr(0,5)){n=r&&r.pdbUri?r.pdbUri:"http://mmtf.rcsb.org/full/",e=e.substr(5).toUpperCase();var s=n+e+".mmtf";$.ajax({url:s,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done(function(e,r,o){a.addMolData(e,"mmtf"),t.zoomTo(),t.render(),i&&i(a)}).fail(function(e,t){console.log(t)})}else{if("pdb:"===e.substr(0,4)){if(n=r&&r.pdbUri?r.pdbUri:"http://www.rcsb.org/pdb/files/",o=r&&r.format?r.format:"pdb",r&&"undefined"==typeof r.noComputeSecondaryStructure&&(r.noComputeSecondaryStructure=!0),e=e.substr(4).toUpperCase(),!e.match(/^[1-9][A-Za-z0-9]{3}$/))return void alert("Wrong PDB ID");s=r&&r.format?n+e+"."+r.format:n+e+".pdb"}else if("cid:"==e.substr(0,4)){if(o="sdf",e=e.substr(4),!e.match(/^[0-9]+$/))return void alert("Wrong Compound ID");s="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/SDF?record_type=3d"}$.get(s,function(e){a.addMolData(e,o,r),t.zoomTo(),t.render(),i&&i(a)}).fail(function(e){console.log("fetch of "+s+" failed: "+e.statusText)})}return a},h.SurfaceType={VDW:1,MS:2,SAS:3,SES:4},h.mergeGeos=function(e,t){var r=t.geometry;void 0!==r&&e.geometryGroups.push(r.geometryGroups[0])},h.multiLineString=function(e){return e.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},h.syncSurface=!1,(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(h.syncSurface=!0),h.specStringToObject=function(e){if("object"===("undefined"==typeof e?"undefined":u(e)))return e;if("undefined"==typeof e||null==e)return e;e=e.replace(/%7E/,"~");var t=function(e){return $.isNumeric(e)?Math.floor(parseFloat(e))==parseInt(e)?parseFloat(e):e.indexOf(".")>=0?parseFloat(e):parseInt(e):"true"===e||"false"!==e&&e},r={};if("all"===e)return r;for(var i=e.split(";"),o=0;o<i.length;o++){var n=i[o].split(":"),a=n[0],s={},l=n[1];if(l)if(l=l.replace(/~/g,"="),l.indexOf("=")!==-1)for(var c=l.split(","),h=0;h<c.length;h++){var f=c[h].split("=",2);s[f[0]]=t(f[1])}else s=l.indexOf(",")!==-1?l.split(","):t(l);r[a]=s}return r},h.getExtent=function(e,t){var r,i,o,n,a,s,l,c,u,h,f=!t;if(r=i=o=9999,n=a=s=-9999,l=c=u=h=0,0===e.length)return[[0,0,0],[0,0,0],[0,0,0]];for(var d=0;d<e.length;d++){var p=e[d];if("undefined"!=typeof p&&isFinite(p.x)&&isFinite(p.y)&&isFinite(p.z)&&(h++,l+=p.x,c+=p.y,u+=p.z,r=r<p.x?r:p.x,i=i<p.y?i:p.y,o=o<p.z?o:p.z,n=n>p.x?n:p.x,a=a>p.y?a:p.y,s=s>p.z?s:p.z,p.symmetries&&f))for(var v=0;v<p.symmetries.length;v++)h++,l+=p.symmetries[v].x,c+=p.symmetries[v].y,u+=p.symmetries[v].z,r=r<p.symmetries[v].x?r:p.symmetries[v].x,i=i<p.symmetries[v].y?i:p.symmetries[v].y,o=o<p.symmetries[v].z?o:p.symmetries[v].z,n=n>p.symmetries[v].x?n:p.symmetries[v].x,a=a>p.symmetries[v].y?a:p.symmetries[v].y,s=s>p.symmetries[v].z?s:p.symmetries[v].z}return[[r,i,o],[n,a,s],[l/h,c/h,u/h]]},h.getAtomProperty=function(e,t){var r=null;return e.properties&&"undefined"!=typeof e.properties[t]?r=e.properties[t]:"undefined"!=typeof e[t]&&(r=e[t]),r},h.getPropertyRange=function(e,t){for(var r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=0,n=e.length;o<n;o++){var a=e[o],s=h.getAtomProperty(a,t);null!=s&&(s<r&&(r=s),s>i&&(i=s))}return isFinite(r)||isFinite(i)?isFinite(r)?isFinite(i)||(i=r):r=i:r=i=0,[r,i]},o=h,l="function"==typeof o?o.call(t,r,t,e):o,!(void 0!==l&&(e.exports=l));var h=h||{};h.Math={clamp:function(e,t,r){return Math.min(Math.max(e,t),r)},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}()},h.Quaternion=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},h.Quaternion.prototype={constructor:h.Quaternion,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},inverse:function(){return this.conjugate().normalize()},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e.x,i=e.y,o=e.z,n=e.w,a=t.x,s=t.y,l=t.z,c=t.w;this.x=r*c+n*a+i*l-o*s,this.y=i*c+n*s+o*a-r*l,this.z=o*c+n*l+r*s-i*a,this.w=n*c-r*a-i*s-o*l}},h.Vector2=function(e,t){this.x=e||0,this.y=t||0},h.Vector2.prototype={constructor:h.Vector2,set:function(e,t){return this.x=e,this.y=t,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new h.Vector2(this.x,this.y)}},h.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},h.Vector3.prototype={constructor:h.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12],this.y=o[1]*t+o[5]*r+o[9]*i+o[13],this.z=o[2]*t+o[6]*r+o[10]*i+o[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements,n=o[3]*t+o[7]*r+o[11]*i+o[15];return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])/n,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])/n,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])/n,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,o=e.x,n=e.y,a=e.z,s=(e.w,{});s.x=2*(r*a-i*n),s.y=2*(i*o-t*a),s.z=2*(t*n-r*o);var l={};return l.x=s.y*a-s.z*n,l.y=s.z*o-s.x*a,l.z=s.x*n-s.y*o,this.x=t+e.w*s.x+l.x,this.y=r+e.w*s.y+l.y,this.z=i+e.w*s.z+l.z,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},cross:function(e){var t=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-t*e.z,this.z=t*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){var r=e.elements,i=r[0],o=r[4],n=r[8],a=(r[1],r[5]),s=r[9],l=(r[2],r[6]),c=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(h.Math.clamp(n,-1,1)),Math.abs(n)<.99999?(this.x=Math.atan2(-s,c),this.z=Math.atan2(-o,i)):(this.x=Math.atan2(l,a),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+t),this},rotateAboutVector:function(e,t){e.normalize();var r=Math.cos(t),i=Math.sin(t),o=this.clone().multiplyScalar(r),n=e.clone().cross(this).multiplyScalar(i),a=e.clone().multiplyScalar(e.clone().dot(this)).multiplyScalar(1-r),s=o.add(n).add(a);return this.x=s.x,this.y=s.y,this.z=s.z,this},clone:function(){return new h.Vector3(this.x,this.y,this.z)}},h.Matrix3=function(e,t,r,i,o,n,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==o?o:1,n||0,a||0,s||0,void 0!==l?l:1)},h.Matrix3.prototype={constructor:h.Matrix3,set:function(e,t,r,i,o,n,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=i,c[4]=o,c[7]=n,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var o=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===o){var n="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/o),this},getDeterminant:function(){var e=this.elements,t=e[0]*e[4]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]-e[1]*e[3]*e[8]-e[0]*e[5]*e[7];return t},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},clone:function(){var e=this.elements;return new h.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},h.Matrix4=function(e,t,r,i,o,n,a,s,l,c,u,h,f,d,p,v){if("undefined"==typeof t&&"undefined"!=typeof e)this.elements=new Float32Array(e);else{var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=r||0,m[12]=i||0,m[1]=o||0,m[5]=void 0!==n?n:1,m[9]=a||0,m[13]=s||0,m[2]=l||0,m[6]=c||0,m[10]=void 0!==u?u:1,m[14]=h||0,m[3]=f||0,m[7]=d||0,m[11]=p||0,m[15]=void 0!==v?v:1}},h.Matrix4.prototype={constructor:h.Matrix4,set:function(e,t,r,i,o,n,a,s,l,c,u,h,f,d,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=o,m[5]=n,m[9]=a,m[13]=s,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=f,m[7]=d,m[11]=p,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},matrix3FromTopLeft:function(){var e=this.elements;return new h.Matrix3(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])},setRotationFromEuler:function(e,t){var r=this.elements,i=e.x,o=e.y,n=e.z,a=Math.cos(i),s=Math.sin(i),l=Math.cos(o),c=Math.sin(o),u=Math.cos(n),h=Math.sin(n);if(void 0===t||"XYZ"===t){var f=a*u,d=a*h,p=s*u,v=s*h;r[0]=l*u,r[4]=-l*h,r[8]=c,r[1]=d+p*c,r[5]=f-v*c,r[9]=-s*l,r[2]=v-f*c,r[6]=p+d*c,r[10]=a*l}else console.error("Error with matrix4 setRotationFromEuler. Order: "+t);return this},setRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,o=e.z,n=e.w,a=r+r,s=i+i,l=o+o,c=r*a,u=r*s,h=r*l,f=i*s,d=i*l,p=o*l,v=n*a,m=n*s,g=n*l;return t[0]=1-(f+p),t[4]=u-g,t[8]=h+m,t[1]=u+g,t[5]=1-(c+p),t[9]=d-v,t[2]=h-m,t[6]=d+v,t[10]=1-(c+f),this},lookAt:function(){var e=new h.Vector3,t=new h.Vector3,r=new h.Vector3;return function(i,o,n){var a=this.elements;return r.subVectors(i,o).normalize(),0===r.length()&&(r.z=1),e.crossVectors(n,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(n,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,o=this.elements,n=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],f=r[13],d=r[2],p=r[6],v=r[10],m=r[14],g=r[3],y=r[7],b=r[11],x=r[15],w=i[0],C=i[4],_=i[8],A=i[12],M=i[1],S=i[5],z=i[9],L=i[13],T=i[2],F=i[6],I=i[10],E=i[14],O=i[3],k=i[7],P=i[11],V=i[15];return o[0]=n*w+a*M+s*T+l*O,o[4]=n*C+a*S+s*F+l*k,o[8]=n*_+a*z+s*I+l*P,o[12]=n*A+a*L+s*E+l*V,o[1]=c*w+u*M+h*T+f*O,o[5]=c*C+u*S+h*F+f*k,o[9]=c*_+u*z+h*I+f*P,o[13]=c*A+u*L+h*E+f*V,o[2]=d*w+p*M+v*T+m*O,o[6]=d*C+p*S+v*F+m*k,o[10]=d*_+p*z+v*I+m*P,o[14]=d*A+p*L+v*E+m*V,o[3]=g*w+y*M+b*T+x*O,o[7]=g*C+y*S+b*F+x*k,o[11]=g*_+y*z+b*I+x*P,o[15]=g*A+y*L+b*E+x*V,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},getPosition:function(){var e=new h.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,o=i[0],n=i[4],a=i[8],s=i[12],l=i[1],c=i[5],u=i[9],h=i[13],f=i[2],d=i[6],p=i[10],v=i[14],m=i[3],g=i[7],y=i[11],b=i[15];r[0]=u*v*g-h*p*g+h*d*y-c*v*y-u*d*b+c*p*b,r[4]=s*p*g-a*v*g-s*d*y+n*v*y+a*d*b-n*p*b,r[8]=a*h*g-s*u*g+s*c*y-n*h*y-a*c*b+n*u*b,r[12]=s*u*d-a*h*d-s*c*p+n*h*p+a*c*v-n*u*v,r[1]=h*p*m-u*v*m-h*f*y+l*v*y+u*f*b-l*p*b,r[5]=a*v*m-s*p*m+s*f*y-o*v*y-a*f*b+o*p*b,r[9]=s*u*m-a*h*m-s*l*y+o*h*y+a*l*b-o*u*b,r[13]=a*h*f-s*u*f+s*l*p-o*h*p-a*l*v+o*u*v,r[2]=c*v*m-h*d*m+h*f*g-l*v*g-c*f*b+l*d*b,r[6]=s*d*m-n*v*m-s*f*g+o*v*g+n*f*b-o*d*b,r[10]=n*h*m-s*c*m+s*l*g-o*h*g-n*l*b+o*c*b,r[14]=s*c*f-n*h*f-s*l*d+o*h*d+n*l*v-o*c*v,r[3]=u*d*m-c*p*m-u*f*g+l*p*g+c*f*y-l*d*y,r[7]=n*p*m-a*d*m+a*f*g-o*p*g-n*f*y+o*d*y,r[11]=a*c*m-n*u*m-a*l*g+o*u*g+n*l*y-o*c*y,r[15]=n*u*f-a*c*f+a*l*d-o*u*d-n*l*p+o*c*p;var x=i[0]*r[0]+i[1]*r[4]+i[2]*r[8]+i[3]*r[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this},isReflected:function(){return this.matrix3FromTopLeft().getDeterminant()<0},compose:function(){var e=new h.Matrix4,t=new h.Matrix4;return function(r,i,o){var n=this.elements;return e.identity(),e.setRotationFromQuaternion(i),t.makeScale(o.x,o.y,o.z),this.multiplyMatrices(e,t),n[12]=r.x,n[13]=r.y,n[14]=r.z,this}}(),decompose:function(){var e=new h.Vector3,t=new h.Vector3,r=new h.Vector3,i=new h.Matrix4;return function(o,n,a){var s=this.elements;return e.set(s[0],s[1],s[2]),t.set(s[4],s[5],s[6]),r.set(s[8],s[9],s[10]),o=o instanceof h.Vector3?o:new h.Vector3,n=n instanceof h.Quaternion?n:new h.Quaternion,a=a instanceof h.Vector3?a:new h.Vector3,a.x=e.length(),a.y=t.length(),a.z=r.length(),o.x=s[12],o.y=s[13],o.z=s[14],i.copy(this),i.elements[0]/=a.x,i.elements[1]/=a.x,i.elements[2]/=a.x,i.elements[4]/=a.y,i.elements[5]/=a.y,i.elements[6]/=a.y,i.elements[8]/=a.z,i.elements[9]/=a.z,i.elements[10]/=a.z,n.setFromRotationMatrix(i),[o,n,a]}}(),scale:function(e){var t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeFrustum:function(e,t,r,i,o,n){var a=this.elements,s=2*o/(t-e),l=2*o/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(n+o)/(n-o),f=-2*n*o/(n-o);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var o=r*Math.tan(h.Math.degToRad(.5*e)),n=-o,a=n*t,s=o*t;return this.makeFrustum(a,s,n,o,r,i)},makeOrthographic:function(e,t,r,i,o,n){var a=this.elements,s=1/(t-e),l=1/(r-i),c=1/(n-o),u=(t+e)*s,h=(r+i)*l,f=(n+o)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},isEqual:function(e){var t=e.elements,r=this.elements;return r[0]==t[0]&&r[4]==t[4]&&r[8]==t[8]&&r[12]==t[12]&&r[1]==t[1]&&r[5]==t[5]&&r[9]==t[9]&&r[13]==t[13]&&r[2]==t[2]&&r[6]==t[6]&&r[10]==t[10]&&r[14]==t[14]&&r[3]==t[3]&&r[7]==t[7]&&r[11]==t[11]&&r[15]==t[15]},clone:function(){var e=this.elements;return new h.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},isIdentity:function(){var e=this.elements;return 1==e[0]&&0==e[4]&&0==e[8]&&0==e[12]&&0==e[1]&&1==e[5]&&0==e[9]&&0==e[13]&&0==e[2]&&0==e[6]&&1==e[10]&&0==e[14]&&0==e[3]&&0==e[7]&&0==e[11]&&1==e[15]}},h.Ray=function(e,t){this.origin=void 0!==e?e:new h.Vector3,this.direction=void 0!==t?t:new h.Vector3},h.Ray.prototype={constructor:h.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new h.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new h.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new h.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){var t=new h.Vector3;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceTo(e)}}(),isIntersectionCylinder:function(){},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return 0!==t||0===e.distanceToPoint(this.origin)},distanceToPlane:function(e){var t=e.normal.dot(this.direction);{if(0!==t){var r=-(this.origin.dot(e.normal)+e.constant)/t;return r}if(0===e.distanceToPoint(this.origin))return 0}},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(void 0!==r)return this.at(r,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new h.Ray).copy(this)}},h.Sphere=function(e,t){this.center=void 0!==e?e:new h.Vector3,this.radius=void 0!==t?t:0},h.Sphere.prototype={constructor:h.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new h.Sphere).copy(this)}},h.Cylinder=function(e,t,r){this.c1=void 0!==e?e:new h.Vector3,this.c2=void 0!==t?t:new h.Vector3,this.direction=(new h.Vector3).subVectors(this.c2,this.c1).normalize(),this.radius=void 0!==r?r:0},h.Cylinder.prototype={constructor:h.Cylinder,copy:function(e){return this.c1.copy(e.c1),this.c2.copy(e.c2),this.direction.copy(e.direction),this.radius=e.radius,this},lengthSq:function(){var e=new h.Vector3;return function(){return e.subVectors(this.c2,this.c1).lengthSq()}}(),applyMatrix4:function(e){return this.direction.add(this.c1).applyMatrix4(e),this.c1.applyMatrix4(e),this.c2.applyMatrix4(e),this.direction.sub(this.c1).normalize(),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},h.Triangle=function(e,t,r){this.a=void 0!==e?e:new h.Vector3,this.b=void 0!==t?t:new h.Vector3,this.c=void 0!==r?r:new h.Vector3},h.Triangle.prototype={constructor:h.Triangle,copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},applyMatrix4:function(e){return this.a.applyMatrix4(e),this.b.applyMatrix4(e),this.c.applyMatrix4(e),this},getNormal:function(){var e=new h.Vector3;return function(){var t=this.a.clone();return t.sub(this.b),e.subVectors(this.c,this.b),t.cross(e),t.normalize(),t}}()},h.EventDispatcher=function(){var e={};this.addEventListener=function(t,r){void 0===e[t]&&(e[t]=[]),e[t].indexOf(r)===-1&&e[t].push(r)},this.removeEventListener=function(t,r){var i=e[t].indexOf(r);i!==-1&&e[t].splice(i,1)},this.dispatchEvent=function(t){var r=e[t.type];if(void 0!==r){t.target=this;for(var i=0,o=r.length;i<o;i++)r[i].call(this,t)}}},h.Color=function(e){return arguments.length>1?(this.r=arguments[0]||0,
this.g=arguments[1]||0,this.b=arguments[2]||0,this):this.set(e)},h.Color.prototype={constructor:h.Color,r:0,g:0,b:0,set:function(e){return e instanceof h.Color?e.clone():void("number"==typeof e?this.setHex(e):"object"===("undefined"==typeof e?"undefined":u(e))&&"r"in e&&"g"in e&&"b"in e&&(this.r=e.r,this.g=e.g,this.b=e.b))},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},getHex:function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),r=Math.round(255*this.b);return e<<16|t<<8|r},clone:function(){return new h.Color(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},scaled:function(){var e={};return e.r=Math.round(255*this.r),e.g=Math.round(255*this.g),e.b=Math.round(255*this.b),e.a=1,e}},h.Object3D=function(){this.id=h.Object3DIDCount++,this.name="",this.parent=void 0,this.children=[],this.position=new h.Vector3,this.rotation=new h.Vector3,this.matrix=new h.Matrix4,this.matrixWorld=new h.Matrix4,this.quaternion=new h.Quaternion,this.eulerOrder="XYZ",this.up=new h.Vector3(0,1,0),this.scale=new h.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0},h.Object3D.prototype={constructor:h.Object3D,lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?this.quaternion.copy(this.matrix.decompose()[1]):this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))},add:function(e){if(e===this)return void console.error("Can't add $3Dmol.Object3D to itself");e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof h.Scene&&t.__addObject(e)},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0,this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof h.Scene&&r.__removeObject(e)}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var t=0;t<this.children.length;t++)this.children[t].updateMatrixWorld(!0)},clone:function(e){void 0===e&&(e=new h.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.quaternion.copy(this.quaternion),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.useQuaternion=this.useQuaternion,e.visible=this.visible;for(var t=0;t<this.children.length;t++){var r=this.children[t];e.add(r.clone())}return e},setVisible:function(e){this.visible=e;for(var t=0;t<this.children.length;t++){var r=this.children[t];r.setVisible(e)}}},h.Object3DIDCount=0,h.Geometry=function(){var e=65535,t=function(e){this.id=e||0,this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.faceArray=null,this.radiusArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0};t.prototype.getNumVertices=function(){return this.vertices},t.prototype.getVertices=function(){return this.vertexArray},t.prototype.getCentroid=function(){for(var e,t,r,i,o=new h.Vector3,n=0;n<this.vertices;++n)e=3*n,t=this.vertexArray[e],r=this.vertexArray[e+1],i=this.vertexArray[e+2],o.x+=t,o.y+=r,o.z+=i;return o.divideScalar(this.vertices),o},t.prototype.setNormals=function(){var e=this.faceArray,t=this.vertexArray,r=this.normalArray;if(this.vertices&&this.faceidx)for(var i,o,n,a,s,l,c,u=0;u<e.length/3;++u)i=3*e[3*u],o=3*e[3*u+1],n=3*e[3*u+2],a=new h.Vector3(t[i],t[i+1],t[i+2]),s=new h.Vector3(t[o],t[o+1],t[o+2]),l=new h.Vector3(t[n],t[n+1],t[n+2]),a.subVectors(a,s),l.subVectors(l,s),l.cross(a),c=l,c.normalize(),r[i]+=c.x,r[o]+=c.x,r[n]+=c.x,r[i+1]+=c.y,r[o+1]+=c.y,r[n+1]+=c.y,r[i+2]+=c.z,r[o+2]+=c.z,r[n+2]+=c.z},t.prototype.setLineIndices=function(){if(this.faceidx){var e=this.faceArray,t=this.lineArray=new Uint16Array(2*this.faceidx);this.lineidx=2*this.faceidx;for(var r,i=0;i<this.faceidx/3;++i){r=3*i;var o=2*r,n=e[r],a=e[r+1],s=e[r+2];t[o]=n,t[o+1]=a,t[o+2]=n,t[o+3]=s,t[o+4]=a,t[o+5]=s}}},t.prototype.truncateArrayBuffers=function(e,t){e=e===!0;var r=this.vertexArray,i=this.colorArray,o=this.normalArray,n=this.faceArray,a=this.lineArray,s=this.radiusArray;this.vertexArray=r.subarray(0,3*this.vertices),this.colorArray=i.subarray(0,3*this.vertices),e?(this.normalArray=o.subarray(0,3*this.vertices),this.faceArray=n.subarray(0,this.faceidx),this.lineidx>0?this.lineArray=a.subarray(0,this.lineidx):this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),s&&(this.radiusArray=s.subarray(0,this.vertices)),t&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0};var r=function(r){var i=new t(r.geometryGroups.length);return r.geometryGroups.push(i),r.groups=r.geometryGroups.length,i.vertexArray=new Float32Array(3*e),i.colorArray=new Float32Array(3*e),r.mesh&&(i.normalArray=new Float32Array(3*e),i.faceArray=new Uint16Array(6*e),i.lineArray=new Uint16Array(6*e)),r.radii&&(i.radiusArray=new Float32Array(e)),i.useOffset=r.offset,i},i=function(e,t,r){h.EventDispatcher.call(this),this.id=h.GeometryIDCount++,this.name="",this.hasTangents=!1,this.dynamic=!0,this.mesh=e===!0,this.radii=t||!1,this.offset=r||!1,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.geometryGroups=[],this.groups=0};return i.prototype={constructor:i,updateGeoGroup:function(e){e=e||0;var t=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!t||t.vertices+e>t.vertexArray.length/3)&&(t=r(this)),t},addGeoGroup:function(){return r(this)},setUpNormals:function(e){e=e||!1;for(var t=0;t<this.groups;t++){var r=this.geometryGroups[t];r.setNormals(e)}},setUpWireframe:function(){for(var e=0;e<this.groups;e++){var t=this.geometryGroups[e];t.setLineIndices()}},initTypedArrays:function(){for(var e=0;e<this.groups;e++){var t=this.geometryGroups[e];t.__inittedArrays!==!0&&t.truncateArrayBuffers(this.mesh,!1)}},dispose:function(){this.dispatchEvent({type:"dispose"})}},i}(),Object.defineProperty(h.Geometry.prototype,"vertices",{get:function(){for(var e=0,t=0;t<this.groups;t++)e+=this.geometryGroups[t].vertices;return e}}),h.GeometryIDCount=0,h.Raycaster=function(){var e=function(e,t,r,i){this.ray=new h.Ray(e,t),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=r||1/0},t=new h.Sphere,r=new h.Cylinder,i=new h.Triangle,o=new h.Vector3,n=new h.Vector3,a=new h.Vector3,s=new h.Vector3,l=(new h.Ray,new h.Vector3,new h.Vector3),c=(new h.Matrix4,function(e,t){return e.distance-t.distance}),u=function(e){return Math.min(Math.max(e,-1),1)},f=function(e,c,f,d){if(l.getPositionFromMatrix(e.matrixWorld),void 0===c.intersectionShape)return d;var p=c.intersectionShape,v=f.linePrecision;v*=e.matrixWorld.getMaxScaleOnAxis();var m=v*v;if(void 0!==c.boundingSphere&&c.boundingSphere instanceof h.Sphere&&(t.copy(c.boundingSphere),t.applyMatrix4(e.matrixWorld),!f.ray.isIntersectionSphere(t)))return d;var g,y,b,x,w,C,_,A,M,S,z,L,T,F;for(g=0,y=p.triangle.length;g<y;g++)if(p.triangle[g]instanceof h.Triangle){if(i.copy(p.triangle[g]),i.applyMatrix4(e.matrixWorld),b=i.getNormal(),x=f.ray.direction.dot(b),x>=0)continue;if(o.subVectors(i.a,f.ray.origin),_=b.dot(o)/x,_<0)continue;n.copy(f.ray.direction).multiplyScalar(_).add(f.ray.origin),n.sub(i.a),a.copy(i.b).sub(i.a),s.copy(i.c).sub(i.a);var I=a.dot(s),E=a.lengthSq(),O=s.lengthSq();if(L=(E*n.dot(s)-I*n.dot(a))/(E*O-I*I),L<0||L>1)continue;if(z=(n.dot(a)-L*I)/E,z<0||z>1||z+L>1)continue;d.push({clickable:c,distance:_})}for(g=0,y=p.cylinder.length;g<y;g++)if(p.cylinder[g]instanceof h.Cylinder){if(r.copy(p.cylinder[g]),r.applyMatrix4(e.matrixWorld),o.subVectors(r.c1,f.ray.origin),w=o.dot(r.direction),C=o.dot(f.ray.direction),x=u(f.ray.direction.dot(r.direction)),M=1-x*x,0===M)continue;T=(x*C-w)/M,F=(C-x*w)/M,n.copy(r.direction).multiplyScalar(T).add(r.c1),a.copy(f.ray.direction).multiplyScalar(F).add(f.ray.origin),A=s.subVectors(n,a).lengthSq();var k=r.radius*r.radius;if(A<=k){if(S=(x*w-C)*(x*w-C)-M*(o.lengthSq()-w*w-k),L=_=S<=0?Math.sqrt(A):(C-x*w-Math.sqrt(S))/M,z=x*L-w,z<0||z*z>r.lengthSq()||L<0)continue;d.push({clickable:c,distance:_})}}for(g=0,y=p.line.length;g<y;g+=2){n.copy(p.line[g]),n.applyMatrix4(e.matrixWorld),a.copy(p.line[g+1]),a.applyMatrix4(e.matrixWorld),s.subVectors(a,n);var P=s.lengthSq();s.normalize(),o.subVectors(n,f.ray.origin);var V=o.dot(s);C=o.dot(f.ray.direction),x=u(f.ray.direction.dot(s)),M=1-x*x,0!==M&&(T=(x*C-V)/M,F=(C-x*V)/M,n.add(s.multiplyScalar(T)),a.copy(f.ray.direction).multiplyScalar(F).add(f.ray.origin),A=s.subVectors(a,n).lengthSq(),A<m&&T*T<P&&d.push({clickable:c,distance:F}))}for(g=0,y=p.sphere.length;g<y;g++)if(p.sphere[g]instanceof h.Sphere&&(t.copy(p.sphere[g]),t.applyMatrix4(e.matrixWorld),f.ray.isIntersectionSphere(t))){n.subVectors(t.center,f.ray.origin);var R=n.dot(f.ray.direction);return S=R*R-(n.lengthSq()-t.radius*t.radius),R<0?d:(_=S<=0?R:R-Math.sqrt(S),d.push({clickable:c,distance:_}),d)}};return e.prototype.precision=1e-4,e.prototype.linePrecision=.2,e.prototype.set=function(e,t){this.ray.set(e,t)},e.prototype.intersectObjects=function(e,t){for(var r=[],i=0,o=t.length;i<o;i++)f(e,t[i],this,r);return r.sort(c),r},e}(),h.Projector=function(){var e=(new h.Matrix4,new h.Matrix4);this.projectVector=function(t,r){return r.matrixWorldInverse.getInverse(r.matrixWorld),e.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),t.applyProjection(e)},this.unprojectVector=function(t,r){return r.projectionMatrixInverse.getInverse(r.projectionMatrix),e.multiplyMatrices(r.matrixWorld,r.projectionMatrixInverse),t.applyProjection(e)}},h.Camera=function(e,t,r,i,o){h.Object3D.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.projectionMatrix=new h.Matrix4,this.projectionMatrixInverse=new h.Matrix4,this.matrixWorldInverse=new h.Matrix4;var n=this.position.z;this.right=n*Math.tan(Math.PI/180*e),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!o,this.updateProjectionMatrix()},h.Camera.prototype=Object.create(h.Object3D.prototype),h.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},h.Camera.prototype.updateProjectionMatrix=function(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},h.SpritePlugin=function(){function e(e,t){var i=r.createProgram(),o=r.createShader(r.FRAGMENT_SHADER),n=r.createShader(r.VERTEX_SHADER),a="precision "+t+" float;\n";return r.shaderSource(o,a+e.fragmentShader),r.shaderSource(n,a+e.vertexShader),r.compileShader(o),r.compileShader(n),r.getShaderParameter(o,r.COMPILE_STATUS)&&r.getShaderParameter(n,r.COMPILE_STATUS)?(r.attachShader(i,o),r.attachShader(i,n),r.linkProgram(i),r.getProgramParameter(i,r.LINK_STATUS)||console.error("Could not initialize shader"),i):(console.error(r.getShaderInfoLog(o)),console.error("could not initialize shader"),null)}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var r,i,o,n={};this.init=function(t){r=t.context,i=t,o=t.getPrecision(),n.vertices=new Float32Array(16),n.faces=new Uint16Array(6);var a=0;n.vertices[a++]=-1,n.vertices[a++]=-1,n.vertices[a++]=0,n.vertices[a++]=0,n.vertices[a++]=1,n.vertices[a++]=-1,n.vertices[a++]=1,n.vertices[a++]=0,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=-1,n.vertices[a++]=1,n.vertices[a++]=0,n.vertices[a++]=1,a=0,n.faces[a++]=0,n.faces[a++]=1,n.faces[a++]=2,n.faces[a++]=0,n.faces[a++]=2,n.faces[a++]=3,n.vertexBuffer=r.createBuffer(),n.elementBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,n.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,n.vertices,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.elementBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n.faces,r.STATIC_DRAW),n.program=e(h.ShaderLib.sprite,o),n.attributes={},n.uniforms={},n.attributes.position=r.getAttribLocation(n.program,"position"),n.attributes.uv=r.getAttribLocation(n.program,"uv"),n.uniforms.uvOffset=r.getUniformLocation(n.program,"uvOffset"),n.uniforms.uvScale=r.getUniformLocation(n.program,"uvScale"),n.uniforms.rotation=r.getUniformLocation(n.program,"rotation"),n.uniforms.scale=r.getUniformLocation(n.program,"scale"),n.uniforms.alignment=r.getUniformLocation(n.program,"alignment"),n.uniforms.color=r.getUniformLocation(n.program,"color"),n.uniforms.map=r.getUniformLocation(n.program,"map"),n.uniforms.opacity=r.getUniformLocation(n.program,"opacity"),n.uniforms.useScreenCoordinates=r.getUniformLocation(n.program,"useScreenCoordinates"),n.uniforms.screenPosition=r.getUniformLocation(n.program,"screenPosition"),n.uniforms.modelViewMatrix=r.getUniformLocation(n.program,"modelViewMatrix"),n.uniforms.projectionMatrix=r.getUniformLocation(n.program,"projectionMatrix"),n.uniforms.fogType=r.getUniformLocation(n.program,"fogType"),n.uniforms.fogDensity=r.getUniformLocation(n.program,"fogDensity"),n.uniforms.fogNear=r.getUniformLocation(n.program,"fogNear"),n.uniforms.fogFar=r.getUniformLocation(n.program,"fogFar"),n.uniforms.fogColor=r.getUniformLocation(n.program,"fogColor"),n.uniforms.alphaTest=r.getUniformLocation(n.program,"alphaTest")},this.render=function(e,o,a,s){var l=e.__webglSprites,c=l.length;if(c){var u=n.attributes,h=n.uniforms,f=.5*a,d=.5*s;r.useProgram(n.program),r.enableVertexAttribArray(u.position),r.enableVertexAttribArray(u.uv),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,n.vertexBuffer),r.vertexAttribPointer(u.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(u.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.elementBuffer),r.uniformMatrix4fv(h.projectionMatrix,!1,o.projectionMatrix.elements),r.activeTexture(r.TEXTURE0),r.uniform1i(h.map,0);var p=0,v=0,m=e.fog;m?(r.uniform3f(h.fogColor,m.color.r,m.color.g,m.color.b),r.uniform1f(h.fogNear,m.near),r.uniform1f(h.fogFar,m.far),r.uniform1i(h.fogType,1),p=1,v=1):(r.uniform1i(h.fogType,0),p=0,v=0);var g,y,b,x,w,C=[];for(g=0;g<c;g++)y=l[g],b=y.material,y.visible&&0!==b.opacity&&(b.useScreenCoordinates?y.z=-y.position.z:(y._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,y.matrixWorld),y.z=-y._modelViewMatrix.elements[14]));for(l.sort(t),g=0;g<c;g++)if(y=l[g],b=y.material,y.visible&&0!==b.opacity&&b.map&&b.map.image&&b.map.image.width){r.uniform1f(h.alphaTest,b.alphaTest);var _=b.map.image.width,A=b.map.image.height;C[0]=_*i.devicePixelRatio/a,C[1]=A*i.devicePixelRatio/s,b.useScreenCoordinates===!0?(r.uniform1i(h.useScreenCoordinates,1),r.uniform3f(h.screenPosition,(y.position.x*i.devicePixelRatio-f)/f,(d-y.position.y*i.devicePixelRatio)/d,Math.max(0,Math.min(1,y.position.z)))):(r.uniform1i(h.useScreenCoordinates,0),r.uniformMatrix4fv(h.modelViewMatrix,!1,y._modelViewMatrix.elements)),w=e.fog&&b.fog?v:0,p!==w&&(r.uniform1i(h.fogType,w),p=w),x=1/(b.scaleByViewport?s:1),C[0]*=x*y.scale.x,C[1]*=x*y.scale.y,r.uniform2f(h.uvScale,b.uvScale.x,b.uvScale.y),r.uniform2f(h.uvOffset,b.uvOffset.x,b.uvOffset.y),r.uniform2f(h.alignment,b.alignment.x,b.alignment.y),r.uniform1f(h.opacity,b.opacity),r.uniform3f(h.color,b.color.r,b.color.g,b.color.b),r.uniform1f(h.rotation,y.rotation),r.uniform2fv(h.scale,C),i.setDepthTest(b.depthTest),i.setDepthWrite(b.depthWrite),i.setTexture(b.map,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}r.enable(r.CULL_FACE)}}},h.Light=function(e,t){h.Object3D.call(this),this.color=new h.Color(e),this.position=new h.Vector3(0,1,0),this.target=new h.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1},h.Light.prototype=Object.create(h.Object3D.prototype),h.Material=function(){h.EventDispatcher.call(this),this.id=h.MaterialIdCount++,this.name="",this.side=h.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0},h.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof h.Color&&r instanceof h.Color?i.copy(r):i instanceof h.Color?i.set(r):i instanceof h.Vector3&&r instanceof h.Vector3?i.copy(r):this[t]=r}}else console.warn("$3Dmol.Material: '"+t+"' parameter is undefined.")}},h.Material.prototype.clone=function(e){return void 0===e&&(e=new h.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.stencilTest=this.stencilTest,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},h.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},h.MaterialIdCount=0,h.LineBasicMaterial=function(e){h.Material.call(this),this.color=new h.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(e)},h.LineBasicMaterial.prototype=Object.create(h.Material.prototype),h.LineBasicMaterial.prototype.clone=function(){var e=new h.LineBasicMaterial;return h.Material.prototype.clone.call(this,e),e.color.copy(this.color),e},h.MeshLambertMaterial=function(e){h.Material.call(this),this.color=new h.Color(16777215),this.ambient=new h.Color(1048575),this.emissive=new h.Color(0),this.wrapAround=!1,this.wrapRGB=new h.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=h.SmoothShading,this.shaderID="lambert",this.vertexColors=h.NoColors,this.skinning=!1,this.setValues(e)},h.MeshLambertMaterial.prototype=Object.create(h.Material.prototype),h.MeshLambertMaterial.prototype.clone=function(e){return"undefined"==typeof e&&(e=new h.MeshLambertMaterial),h.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},h.MeshDoubleLambertMaterial=function(e){h.MeshLambertMaterial.call(this,e),this.shaderID="lambertdouble",this.side=h.DoubleSide},h.MeshDoubleLambertMaterial.prototype=Object.create(h.MeshLambertMaterial.prototype),h.MeshDoubleLambertMaterial.prototype.clone=function(){var e=new h.MeshDoubleLambertMaterial;return h.MeshLambertMaterial.prototype.clone.call(this,e),e},h.MeshOutlineMaterial=function(e){h.Material.call(this),e=e||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=e.color||new h.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1},h.MeshOutlineMaterial.prototype=Object.create(h.Material.prototype),h.MeshOutlineMaterial.prototype.clone=function(e){return"undefined"==typeof e&&(e=new h.MeshOutlineMaterial),h.Material.prototype.clone.call(this,e),e.fog=this.fog,e.shaderID=this.shaderID,e.wireframe=this.wireframe,e},h.ImposterMaterial=function(e){h.Material.call(this),this.color=new h.Color(16777215),this.ambient=new h.Color(1048575),this.emissive=new h.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new h.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=h.SmoothShading,this.shaderID=null,this.vertexColors=h.NoColors,this.skinning=!1,this.setValues(e)},h.ImposterMaterial.prototype=Object.create(h.Material.prototype),h.ImposterMaterial.prototype.clone=function(){var e=new h.ImposterMaterial;return h.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},h.SphereImposterMaterial=function(e){h.ImposterMaterial.call(this),this.shaderID="sphereimposter",this.setValues(e)},h.SphereImposterMaterial.prototype=Object.create(h.ImposterMaterial.prototype),h.SphereImposterMaterial.prototype.clone=function(){var e=new h.SphereImposterMaterial;return h.ImposterMaterial.prototype.clone.call(this,e),e},h.SphereImposterOutlineMaterial=function(e){h.ImposterMaterial.call(this),e=e||{},this.shaderID="sphereimposteroutline",this.outlineColor=e.color||new h.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.setValues(e)},h.SphereImposterOutlineMaterial.prototype=Object.create(h.ImposterMaterial.prototype),h.SphereImposterOutlineMaterial.prototype.clone=function(){var e=new h.SphereImposterOutlineMaterial;return h.ImposterMaterial.prototype.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e},h.StickImposterMaterial=function(e){h.ImposterMaterial.call(this),this.shaderID="stickimposter",this.setValues(e)},h.StickImposterMaterial.prototype=Object.create(h.ImposterMaterial.prototype),h.StickImposterMaterial.prototype.clone=function(){var e=new h.StickImposterOutlineMaterial;return h.ImposterMaterial.prototype.clone.call(this,e),e},h.StickImposterOutlineMaterial=function(e){h.ImposterMaterial.call(this),e=e||{},this.shaderID="stickimposteroutline",this.outlineColor=e.color||new h.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.setValues(e)},h.StickImposterOutlineMaterial.prototype=Object.create(h.ImposterMaterial.prototype),h.StickImposterOutlineMaterial.prototype.clone=function(){var e=new h.StickImposterOutlineMaterial;return h.ImposterMaterial.prototype.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e},h.InstancedMaterial=function(e){h.Material.call(this),this.color=new h.Color(16777215),this.ambient=new h.Color(1048575),this.emissive=new h.Color(0),this.wrapAround=!1,this.wrapRGB=new h.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=h.SmoothShading,this.shaderID="instanced",this.vertexColors=h.NoColors,this.skinning=!1,this.sphere=null,this.setValues(e)},h.InstancedMaterial.prototype=Object.create(h.Material.prototype),h.InstancedMaterial.prototype.clone=function(){var e=new h.InstancedMaterial;return h.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.sphere=this.sphere,e},h.SpriteMaterial=function(e){h.Material.call(this),this.color=new h.Color(16777215),this.map=new h.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=h.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new h.Vector2(0,0),this.uvScale=new h.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewPort&&(this.scaleByViewPort=!this.sizeAttenuation)},h.SpriteMaterial.prototype=Object.create(h.Material.prototype),h.SpriteMaterial.prototype.clone=function(){var e=new h.SpriteMaterial;return h.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewPort,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e},h.SpriteAlignment={},h.SpriteAlignment.topLeft=new h.Vector2(1,(-1)),h.SpriteAlignment.topCenter=new h.Vector2(0,(-1)),h.SpriteAlignment.topRight=new h.Vector2((-1),(-1)),h.SpriteAlignment.centerLeft=new h.Vector2(1,0),h.SpriteAlignment.center=new h.Vector2(0,0),h.SpriteAlignment.centerRight=new h.Vector2((-1),0),h.SpriteAlignment.bottomLeft=new h.Vector2(1,1),h.SpriteAlignment.bottomCenter=new h.Vector2(0,1),h.SpriteAlignment.bottomRight=new h.Vector2((-1),1),h.Texture=function(e){h.EventDispatcher.call(this),this.id=h.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=new h.UVMapping,this.wrapS=h.ClampToEdgeWrapping,this.wrapT=h.ClampToEdgeWrapping,this.magFilter=h.LinearFilter,this.minFilter=h.LinearMipMapLinearFilter,this.anisotropy=1,this.format=h.RGBAFormat,this.type=h.UnsignedByteType,this.offset=new h.Vector2(0,0),this.repeat=new h.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},h.Texture.prototype={constructor:h.Texture,clone:function(e){return void 0===e&&(e=new h.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},h.TextureIdCount=0,h.FrontSide=0,h.BackSide=1,h.DoubleSide=2,h.NoShading=0,h.FlatShading=1,h.SmoothShading=2,h.NoColors=0,h.FaceColors=1,h.VertexColors=2,h.MultiplyOperation=0,h.MixOperation=1,h.AddOperation=2,h.UVMapping=function(){},h.ClampToEdgeWrapping=1001,h.LinearFilter=1006,h.LinearMipMapLinearFilter=1008,h.UnsignedByteType=1009,h.RGBAFormat=1021,h.Line=function(e,t,r){h.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new h.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:h.LineStrip},h.LineStrip=0,h.LinePieces=1,h.Line.prototype=Object.create(h.Object3D.prototype),h.Line.prototype.clone=function(e){return void 0===e&&(e=new h.Line(this.geometry,this.material,this.type)),h.Object3D.prototype.clone.call(this,e),e},h.Mesh=function(e,t){h.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new h.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},h.Mesh.prototype=Object.create(h.Object3D.prototype),h.Mesh.prototype.clone=function(e){return void 0===e&&(e=new h.Mesh(this.geometry,this.material)),h.Object3D.prototype.clone.call(this,e),e},h.Sprite=function(e){h.Object3D.call(this),this.material=void 0!==e?e:new h.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},h.Sprite.prototype=Object.create(h.Object3D.prototype),h.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},h.Sprite.prototype.clone=function(e){return void 0===e&&(e=new h.Sprite(this.material)),h.Object3D.prototype.clone.call(this,e),e},h.Renderer=function(e){function t(e){ce[e]||(G.enableVertexAttribArray(e),ce[e]=!0)}function r(){for(var e in ce)ce[e]&&(G.disableVertexAttribArray(e),ce[e]=!1)}function i(e,t,r){ie!==e&&(e?G.enable(G.POLYGON_OFFSET_FILL):G.disable(G.POLYGON_OFFSET_FILL))}function o(e){e!==oe&&(G.lineWidth(e),oe=e)}function n(e,t){var r;return"fragment"===e?r=G.createShader(G.FRAGMENT_SHADER):"vertex"===e&&(r=G.createShader(G.VERTEX_SHADER)),G.shaderSource(r,t),G.compileShader(r),G.getShaderParameter(r,G.COMPILE_STATUS)?r:(console.error(G.getShaderInfoLog(r)),console.error("could not initialize shader"),null)}function a(e,t,r,i){var o,a,s,l,c=[];c.push(e),c.push(t);for(o in i)c.push(o),c.push(i[o]);for(l=c.join(),o=0,a=W.length;o<a;o++){var u=W[o];if(u.code===l)return u.usedTimes++,u.program}s=G.createProgram();var h=I,f="precision "+h+" float;",d=[f].join("\n"),p=[i.fragdepth?"#extension GL_EXT_frag_depth: enable":"",i.wireframe?"#define WIREFRAME 1":"",f].join("\n"),v=n("fragment",p+e),m=n("vertex",d+t);G.attachShader(s,m),G.attachShader(s,v),G.linkProgram(s),G.getProgramParameter(s,G.LINK_STATUS)||console.error("Could not initialize shader"),s.uniforms={},s.attributes={};var g,y,b;g=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(y in r)g.push(y);for(b=0;b<g.length;b++){var x=g[b];s.uniforms[x]=G.getUniformLocation(s,x)}for(g=["position","normal","color","lineDistance","offset","radius"],b=0;b<g.length;b++){var w=g[b];s.attributes[w]=G.getAttribLocation(s,w)}return s.id=q++,W.push({program:s,code:l,usedTimes:1}),H.info.memory.programs=W.length,s}function s(e,t,r,i,o){i.needsUpdate&&(i.program&&we(i),H.initMaterial(i,t,r,o),i.needsUpdate=!1);var n=!1,a=i.program,s=a.uniforms,c=i.uniforms;return a!=Y&&(G.useProgram(a),Y=a,n=!0),i.id!=Z&&(Z=i.id,n=!0),e!=X&&(X=e,n=!0),G.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),G.uniformMatrix4fv(s.modelViewMatrix,!1,o._modelViewMatrix.elements),G.uniformMatrix3fv(s.normalMatrix,!1,o._normalMatrix.elements),n&&(c.fogColor.value=r.color,c.fogNear.value=r.near,c.fogFar.value=r.far,i.shaderID.startsWith("lambert")||"instanced"===i.shaderID||i.shaderID.endsWith("imposter")?(G.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements),de&&(z(a,t),de=!1),c.directionalLightColor.value=pe.directional.colors,
c.directionalLightDirection.value=pe.directional.positions):i.shaderID.endsWith("outline")?(c.outlineColor.value=i.outlineColor,c.outlineWidth.value=i.outlineWidth,c.outlinePushback.value=i.outlinePushback):"sphereimposter"===i.shaderID&&(G.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements),G.uniformMatrix3fv(s.normalMatrix,!1,o._normalMatrix.elements),c.directionalLightColor.value=pe.directional.colors,c.directionalLightDirection.value=pe.directional.positions),c.opacity.value=i.opacity,l(s,c)),a}function l(e,t){var r,i,o,n;for(r in t)e[r]&&(i=t[r].type,o=t[r].value,n=e[r],"f"===i?G.uniform1f(n,o):"fv"===i?G.uniform3fv(n,o):"c"===i?G.uniform3f(n,o.r,o.g,o.b):"f4"===i&&G.uniform4f(n,o[0],o[1],o[2],o[3]))}function c(e,t,r,o,n,a,s,l){var c,u,h,f,d,p,v;t?(d=e.length-1,p=-1,v=-1):(d=0,p=e.length,v=1);for(var m=d;m!==p;m+=v)if(c=e[m],c.render){if(u=c.object,h=c.buffer,f=c[r],!f)continue;s&&H.setBlending(!0),H.setDepthTest(f.depthTest),H.setDepthWrite(f.depthWrite),i(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits);var g=u._modelViewMatrix.isReflected();H.setMaterialFaces(f,g),H.renderBuffer(o,n,a,f,h,u),(j||f.outline)&&("sphereimposter"==f.shaderID?H.renderBuffer(o,n,a,U,h,u):"stickimposter"==f.shaderID?H.renderBuffer(o,n,a,B,h,u):f.wireframe||"basic"===f.shaderID||0===f.opacity||H.renderBuffer(o,n,a,N,h,u))}}function u(e,t,r){if($=-1,Y=null,X=null,ee=-1,re=-1,te=-1,K=-1,Z=-1,J=-1,e.length)for(var i=0,o=e.length;i<o;i++)de=!0,e[i].render(t,r,se,le),$=-1,Y=null,X=null,ee=-1,re=-1,te=-1,K=-1,Z=-1,J=-1}function f(e,t){var r,i,o,n,a;if(!e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new h.Matrix4,e._normalMatrix=new h.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",ge)),e instanceof h.Mesh||e instanceof h.Line))for(o=e.geometry,n=e.material,r=0,i=o.geometryGroups.length;r<i;r++)a=o.geometryGroups[r],a.id=Q++,a.__webglVertexBuffer||(e instanceof h.Mesh?(b(a),o.elementsNeedUpdate=!0,o.normalsNeedUpdate=!0):e instanceof h.Line&&x(a),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0);if(!e.__webglActive){if(e instanceof h.Mesh||e instanceof h.Line)for(o=e.geometry,r=0,i=o.geometryGroups.length;r<i;r++)a=o.geometryGroups[r],w(t.__webglObjects,a,e);else e instanceof h.Sprite&&t.__webglSprites.push(e);e.__webglActive=!0}}function d(e){var t,r=e.geometry;e.material;if(e instanceof h.Mesh||e instanceof h.Line){for(var i=0,o=r.geometryGroups.length;i<o;i++)t=r.geometryGroups[i],(r.verticesNeedUpdate||r.elementsNeedUpdate||r.colorsNeedUpdate||r.normalsNeedUpdate)&&y(t,G.STATIC_DRAW);r.verticesNeedUpdate=!1,r.elementsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.buffersNeedUpdate=!1}}function p(e,t){e instanceof h.Mesh||e instanceof h.Line?v(t.__webglObjects,e):e instanceof h.Sprite&&m(t.__webglSprites,e),e.__webglActive=!1}function v(e,t){for(var r=e.length-1;r>=0;--r)e[r].object===t&&e.splice(r,1)}function m(e,t){for(var r=e.length-1;r>=0;--r)e[r]===t&&e.splice(r,1)}function g(e){var t=e.object,r=t.material;if(r.transparent){if(e.opaque=null,e.transparent=r,!r.wireframe){var i=r.clone();i.opacity=0,e.blank=i}}else e.opaque=r,e.transparent=null}function y(e,t,r){var i=e.vertexArray,o=e.colorArray;if(void 0!==e.__webglOffsetBuffer?(G.bindBuffer(G.ARRAY_BUFFER,e.__webglOffsetBuffer),G.bufferData(G.ARRAY_BUFFER,i,t)):(G.bindBuffer(G.ARRAY_BUFFER,e.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,i,t)),G.bindBuffer(G.ARRAY_BUFFER,e.__webglColorBuffer),G.bufferData(G.ARRAY_BUFFER,o,t),e.normalArray&&void 0!==e.__webglNormalBuffer){var n=e.normalArray;G.bindBuffer(G.ARRAY_BUFFER,e.__webglNormalBuffer),G.bufferData(G.ARRAY_BUFFER,n,t)}if(e.radiusArray&&void 0!==e.__webglRadiusBuffer&&(G.bindBuffer(G.ARRAY_BUFFER,e.__webglRadiusBuffer),G.bufferData(G.ARRAY_BUFFER,e.radiusArray,t)),e.faceArray&&void 0!==e.__webglFaceBuffer){var a=e.faceArray;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,a,t)}if(e.lineArray&&void 0!==e.__webglLineBuffer){var s=e.lineArray;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,s,t)}}function b(e){e.radiusArray&&(e.__webglRadiusBuffer=G.createBuffer()),e.useOffset&&(e.__webglOffsetBuffer=G.createBuffer()),e.__webglVertexBuffer=G.createBuffer(),e.__webglNormalBuffer=G.createBuffer(),e.__webglColorBuffer=G.createBuffer(),e.__webglFaceBuffer=G.createBuffer(),e.__webglLineBuffer=G.createBuffer(),H.info.memory.geometries++}function x(e){e.__webglVertexBuffer=G.createBuffer(),e.__webglColorBuffer=G.createBuffer(),H.info.memory.geometries++}function w(e,t,r){e.push({buffer:t,object:r,opaque:null,transparent:null})}function C(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function _(e){return 0===(e&e-1)}function A(e){return G.LINEAR}function M(e,t,r){r?(G.texParameteri(e,G.TEXTURE_WRAP_S,S(t.wrapS)),G.texParameteri(e,G.TEXTURE_WRAP_T,S(t.wrapT)),G.texParameteri(e,G.TEXTURE_MAG_FILTER,S(t.magFilter)),G.texParameteri(e,G.TEXTURE_MIN_FILTER,S(t.minFilter))):(G.texParameteri(e,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(e,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(e,G.TEXTURE_MAG_FILTER,A(t.magFilter)),G.texParameteri(e,G.TEXTURE_MIN_FILTER,A(t.minFilter)))}function S(e){return e===h.UnsignedByteType?G.UNSIGNED_BYTE:e===h.RGBAFormat?G.RGBA:0}function z(e,t){var r,i,o,n,a,s,l=0,c=0,u=0,f=pe,d=f.directional.colors,p=f.directional.positions,v=0,m=0,g=0;for(r=0,i=t.length;r<i;r++)if(o=t[r],n=o.color,a=o.intensity,s=o.distance,o instanceof h.Light){if(v++,fe.getPositionFromMatrix(o.matrixWorld),he.getPositionFromMatrix(o.target.matrixWorld),fe.sub(he),fe.normalize(),0===fe.x&&0===fe.y&&0===fe.z)continue;p[g]=fe.x,p[g+1]=fe.y,p[g+2]=fe.z,d[g]=n.r*a,d[g+1]=n.g*a,d[g+2]=n.b*a,g+=3,m++}f.ambient[0]=l,f.ambient[1]=c,f.ambient[2]=u,f.directional.length=m}function L(){try{if(!(G=F.getContext("experimental-webgl",{alpha:E,premultipliedAlpha:O,antialias:k,stencil:P,preserveDrawingBuffer:V}))&&!(G=F.getContext("webgl",{alpha:E,premultipliedAlpha:O,antialias:k,stencil:P,preserveDrawingBuffer:V})))throw"Error creating WebGL context."}catch(e){console.error(e)}}function T(){G.clearColor(0,0,0,1),G.clearDepth(1),G.clearStencil(0),G.enable(G.DEPTH_TEST),G.depthFunc(G.LEQUAL),G.frontFace(G.CCW),G.cullFace(G.BACK),G.enable(G.CULL_FACE),G.enable(G.BLEND),G.blendEquation(G.FUNC_ADD),G.blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),G.clearColor(R.r,R.g,R.b,D)}e=e||{};var F=void 0!==e.canvas?e.canvas:document.createElement("canvas"),I=void 0!==e.precision?e.precision:"highp",E=void 0===e.alpha||e.alpha,O=void 0===e.premultipliedAlpha||e.premultipliedAlpha,k=void 0!==e.antialias&&e.antialias,P=void 0===e.stencil||e.stencil,V=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,R=void 0!==e.clearColor?new h.Color(e.clearColor):new h.Color(0),D=void 0!==e.clearAlpha?e.clearAlpha:0,N=new h.MeshOutlineMaterial(e.outline),U=new h.SphereImposterOutlineMaterial(e.outline),B=new h.StickImposterOutlineMaterial(e.outline),j=!!e.outline;this.domElement=F,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var G,H=this,W=[],q=0,Y=null,Z=-1,$=null,X=null,Q=0,K=-1,J=-1,ee=-1,te=-1,re=-1,ie=null,oe=null,ne=0,ae=0,se=0,le=0,ce={},ue=new h.Matrix4,he=new h.Vector3,fe=new h.Vector3,de=!0,pe={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};L(),T(),this.context=G;var ve=G.getExtension("ANGLE_instanced_arrays"),me=G.getExtension("EXT_frag_depth");this.supportedExtensions=function(){return{supportsAIA:Boolean(ve),supportsImposters:Boolean(me)}},this.getContext=function(){return G},this.getPrecision=function(){return I},this.setClearColorHex=function(e,t){R.setHex(e),D=t,G.clearColor(R.r,R.g,R.b,D)},this.enableOutline=function(e){N=new h.MeshOutlineMaterial(e),U=new h.SphereImposterOutlineMaterial(e),B=new h.StickImposterOutlineMaterial(e),j=!0},this.disableOutline=function(){j=!1},this.setSize=function(e,t){ne=F.width=e*this.devicePixelRatio,ae=F.height=t*this.devicePixelRatio,F.style.width=e+"px",F.style.height=t+"px",G.viewport(0,0,G.drawingBufferWidth,G.drawingBufferHeight)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=G.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=G.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=G.STENCIL_BUFFER_BIT),G.clear(i)},this.clearTarget=function(e,t,r){this.clear(e,t,r)},this.setMaterialFaces=function(e,t){var r=e.side===h.DoubleSide,i=e.side===h.BackSide;i=t?!i:i,K!==r&&(r?G.disable(G.CULL_FACE):G.enable(G.CULL_FACE),K=r),J!==i&&(i?G.frontFace(G.CW):G.frontFace(G.CCW),J=i)},this.setDepthTest=function(e){te!==e&&(e?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST),te=e)},this.setDepthWrite=function(e){re!==e&&(G.depthMask(e),re=e)},this.setBlending=function(e){e?(G.enable(G.BLEND),G.blendEquationSeparate(G.FUNC_ADD,G.FUNC_ADD),G.blendFuncSeparate(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA)):G.disable(G.BLEND),ee=e},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)};var ge=function _e(e){var t=e.target;t.removeEventListener("dispose",_e),xe(t),H.info.memory.geometries--},ye=function Ae(e){var t=e.target;t.removeEventListener("dispose",Ae),Ce(t),H.info.memory.textures--},be=function Me(e){var t=e.target;t.removeEventListener("dispose",Me),we(t)},xe=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&G.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglColorBuffer&&G.deleteBuffer(e.__webglColorBuffer),void 0!==e.geometryGroups)for(var t=0,r=e.groups;t<r;t++){var i=e.geometryGroups[t];void 0!==i.__webglVertexBuffer&&G.deleteBuffer(i.__webglVertexBuffer),void 0!==i.__webglColorBuffer&&G.deleteBuffer(i.__webglColorBuffer),void 0!==i.__webglNormalBuffer&&G.deleteBuffer(i.__webglNormalBuffer),void 0!==i.__webglFaceBuffer&&G.deleteBuffer(i.__webglFaceBuffer),void 0!==i.__webglLineBuffer&&G.deleteBuffer(i.__webglLineBuffer)}},we=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var r,i,o,n=!1;for(r=0,i=W.length;r<i;r++)if(o=W[r],o.program===t){o.usedTimes--,0===o.usedTimes&&(n=!0);break}if(n===!0){var a=[];for(r=0,i=W.length;r<i;r++)o=W[r],o.program!==t&&a.push(o);W=a,G.deleteProgram(t),H.info.memory.programs--}}},Ce=function(e){if(e.image&&e.image.__webglTextureCube)G.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,G.deleteTexture(e.__webglTexture)}};this.initMaterial=function(e,t,r,i){e.addEventListener("dispose",be);var o,n;if(n=e.shaderID){var s=h.ShaderLib[n];e.vertexShader=s.vertexShader,e.fragmentShader=s.fragmentShader,e.uniforms=h.ShaderUtils.clone(s.uniforms)}o={wireframe:e.wireframe,fragdepth:e.imposter},e.program=a(e.fragmentShader,e.vertexShader,e.uniforms,o)},this.renderBuffer=function(e,i,n,a,l,c){if(a.visible){var u,f;u=s(e,i,n,a,c),f=u.attributes;var d=!1,p=a.wireframe?1:0,v=16777215*l.id+2*u.id+p;v!==$&&($=v,d=!0),d&&(r(),f.position>=0&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglVertexBuffer),t(f.position),G.vertexAttribPointer(f.position,3,G.FLOAT,!1,0,0)),f.color>=0&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglColorBuffer),t(f.color),G.vertexAttribPointer(f.color,3,G.FLOAT,!1,0,0)),f.normal>=0&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglNormalBuffer),t(f.normal),G.vertexAttribPointer(f.normal,3,G.FLOAT,!1,0,0)),f.offset>=0&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglOffsetBuffer),t(f.offset),G.vertexAttribPointer(f.offset,3,G.FLOAT,!1,0,0)),f.radius>=0&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglRadiusBuffer),t(f.radius),G.vertexAttribPointer(f.radius,1,G.FLOAT,!1,0,0)));var m,g;if(c instanceof h.Mesh){if("instanced"===a.shaderID){var y=a.sphere.geometryGroups[0];d&&(G.bindBuffer(G.ARRAY_BUFFER,l.__webglVertexBuffer),G.bufferData(G.ARRAY_BUFFER,y.vertexArray,G.STATIC_DRAW),G.bindBuffer(G.ARRAY_BUFFER,l.__webglNormalBuffer),G.bufferData(G.ARRAY_BUFFER,y.normalArray,G.STATIC_DRAW),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,l.__webglFaceBuffer),G.bufferData(G.ELEMENT_ARRAY_BUFFER,y.faceArray,G.STATIC_DRAW)),m=y.faceidx,ve.vertexAttribDivisorANGLE(f.offset,1),ve.vertexAttribDivisorANGLE(f.radius,1),ve.vertexAttribDivisorANGLE(f.color,1),ve.drawElementsInstancedANGLE(G.TRIANGLES,m,G.UNSIGNED_SHORT,0,l.radiusArray.length),ve.vertexAttribDivisorANGLE(f.offset,0),ve.vertexAttribDivisorANGLE(f.radius,0),ve.vertexAttribDivisorANGLE(f.color,0)}else a.wireframe?(g=l.lineidx,o(a.wireframeLinewidth),d&&G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,l.__webglLineBuffer),G.drawElements(G.LINES,g,G.UNSIGNED_SHORT,0)):(m=l.faceidx,d&&G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,l.__webglFaceBuffer),G.drawElements(G.TRIANGLES,m,G.UNSIGNED_SHORT,0));H.info.render.calls++,H.info.render.vertices+=m,H.info.render.faces+=m/3}else c instanceof h.Line&&(g=l.vertices,o(a.linewidth),G.drawArrays(G.LINES,0,g),H.info.render.calls++)}},this.render=function(e,t,r){if(t instanceof h.Camera==!1)return void console.error("$3Dmol.Renderer.render: camera is not an instance of $3Dmol.Camera.");var i,o,n,a,s,l=e.__lights,f=e.fog;for(Z=-1,de=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),ue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(e),H.info.render.calls=0,H.info.render.vertices=0,H.info.render.faces=0,H.info.render.points=0,se=ne,le=ae,(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s=e.__webglObjects,i=0,o=s.length;i<o;i++)n=s[i],a=n.object,n.render=!1,a.visible&&(C(a,t),g(n),n.render=!0);var d=null;this.setBlending(!1),c(e.__webglObjects,!0,"opaque",t,l,f,!1,d),c(e.__webglObjects,!0,"blank",t,l,f,!0,d),c(e.__webglObjects,!1,"transparent",t,l,f,!0,d),u(this.renderPluginsPost,e,t),this.setDepthTest(!0),this.setDepthWrite(!0)},this.initWebGLObjects=function(e){if(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]),e.__objectsAdded.length){for(;e.__objectsAdded.length;)f(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);$=-1}for(;e.__objectsRemoved.length;)p(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;t<r;t++)d(e.__webglObjects[t].object)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",ye),e.__webglTexture=G.createTexture(),H.info.memory.textures++),G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_2D,e.__webglTexture),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,e.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=_(r.width)&&_(r.height),o=S(e.format),n=S(e.type);M(G.TEXTURE_2D,e,i);var a,s=e.mipmaps;if(s.length>0&&i){for(var l=0,c=s.length;l<c;l++)a=s[l],G.texImage2D(G.TEXTURE_2D,l,o,o,n,a);e.generateMipmaps=!1}else G.texImage2D(G.TEXTURE_2D,0,o,o,n,e.image);e.generateMipmaps&&i&&G.generateMipmap(G.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else G.activeTexture(G.TEXTURE0+t),G.bindTexture(G.TEXTURE_2D,e.__webglTexture)},this.addPostPlugin(new h.SpritePlugin)},h.Scene=function(){h.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},h.Scene.prototype=Object.create(h.Object3D.prototype),h.Scene.prototype.__addObject=function(e){if(e instanceof h.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(this.__objects.indexOf(e)===-1){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(r,1)}for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},h.Scene.prototype.__removeObject=function(e){var t;if(e instanceof h.Light)t=this.__lights.indexOf(e),t!==-1&&this.__lights.splice(t,1);else if(t=this.__objects.indexOf(e),t!==-1){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var r=this.__objectsAdded.indexOf(e);r!==-1&&this.__objectsAdded.splice(t,1)}for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},h.Fog=function(e,t,r){this.name="",this.color=new h.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},h.Fog.prototype.clone=function(){return new h.Fog(this.color.getHex(),this.near,this.far)},h.ShaderUtils={clone:function(e){var t,r={};for(t in e){r[t]={},r[t].type=e[t].type;var i=e[t].value;i instanceof h.Color?r[t].value=i.clone():"number"==typeof i?r[t].value=i:i instanceof Array?r[t].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return r},stickimposterFragmentShader:["uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLight;","varying vec3 vColor;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vec3 color = abs(vColor);","    vec3 pos = cposition;","    vec3 p = pos;","    vec3 v = normalize(pos);","    vec3 pa = p1;","    vec3 va = normalize(p2-p1);","    vec3 tmp1 = v-(dot(v,va)*va);","    vec3 deltap = p-pa;","    float A = dot(tmp1,tmp1);","    if(A == 0.0) discard;","    vec3 tmp2 = deltap-(dot(deltap,va)*va);","    float B = 2.0*dot(tmp1, tmp2);","    float C = dot(tmp2,tmp2)-r*r;","    float det = (B*B) - (4.0*A*C);","    if(det < 0.0) discard;","    float sqrtDet = sqrt(det);","    float posT = (-B+sqrtDet)/(2.0*A);","    float negT = (-B-sqrtDet)/(2.0*A);","    float intersectionT = min(posT,negT);","    vec3 qi = p+v*intersectionT;","    float dotp1 = dot(va,qi-p1);","    float dotp2 = dot(va,qi-p2);","    vec3 norm;","    if( dotp1 < 0.0 || dotp2 > 0.0) {","       vec3 cp;","       if( dotp1 < 0.0) {        cp = p1;","       } else {","          cp = p2;","       }","       vec3 diff = p-cp;","       A = dot(v,v);","       B = dot(diff,v)*2.0;","       C = dot(diff,diff)-r*r;","       det = (B*B) - (4.0*C);","       if(det < 0.0) discard;","       sqrtDet = sqrt(det);","       posT = (-B+sqrtDet)/(2.0);","       negT = (-B-sqrtDet)/(2.0);","       float t = min(posT,negT);","       qi = p+v*t;","       norm = normalize(qi-cp);","    } else {","       norm = normalize(qi-(dotp1*va + p1));","    }","    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragDepthEXT = depth;"].join("\n")},h.ShaderLib={basic:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},sphereimposter:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform float uDepth;","uniform vec3 directionalLightColor[ 1 ];","varying vec3 vColor;","varying vec2 mapping;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));","    float dotProduct = dot( norm, vLight );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_FragColor = vec4(vLight*vColor, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying vec3 vColor;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz );","    mapping = normal.xy;","    rval = abs(normal.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},lambert:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},instanced:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 offset;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},outline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","void main() {","    gl_FragColor = vec4( outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","void main() {","    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    mvPosition.xy += norm.xy*outlineWidth;","    gl_Position = projectionMatrix * mvPosition;","    mvPosition.z -= outlinePushback;","    vec4 pushpos = projectionMatrix*mvPosition;","    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new h.Color(0,0,0)},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},sphereimposteroutline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform mat4 projectionMatrix;","varying vec2 mapping;","varying float rval;","varying vec3 center;","uniform float outlinePushback;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragColor = vec4(outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying float rval;","varying vec3 center;","void main() {","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);","    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;","    mapping = norm.xy;","    rval = abs(norm.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new h.Color(0,0,0)},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},stickimposter:{fragmentShader:[h.ShaderUtils.stickimposterFragmentShader,"    float dotProduct = dot( norm, vLight );","    vec3 light = vec3( max( dotProduct, 0.0 ) );","    gl_FragColor = vec4(light*color, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = color; vColor.z = abs(vColor.z);","    r = abs(radius);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz )*directionalLightColor[0];","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},stickimposteroutline:{fragmentShader:h.ShaderUtils.stickimposterFragmentShader+"gl_FragColor = vec4(color,1.0);}",vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","uniform vec3 outlineColor;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = outlineColor;","    float rad = radius+sign(radius)*outlineWidth;","    r = abs(rad);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    to.xyz += normalize(to.xyz)*outlinePushback;","    pt.xyz += normalize(pt.xyz)*outlinePushback;","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vLight = vec3(1.0,1.0,1.0);","}"].join("\n"),
uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new h.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},lambertdouble:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vLightBack;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    if ( gl_FrontFacing )","       gl_FragColor.xyz *= vLightFront;","    else","       gl_FragColor.xyz *= vLightBack;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","varying vec3 vLightBack;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    vLightBack = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new h.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},sprite:{fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","    vec4 texture = texture2D(map, vUV);","    if (texture.a < alphaTest) discard;","    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);","    if (fogType > 0) {","        float depth = gl_FragCoord.z / gl_FragCoord.w;","        float fogFactor = 0.0;","        if (fogType == 1) {","            fogFactor = smoothstep(fogNear, fogFar, depth);","        }","        else {","            const float LOG2 = 1.442695;","            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);","            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);","        }","        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);","    }","}"].join("\n"),vertexShader:["uniform int useScreenCoordinates;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","    vUV = uvOffset + uv * uvScale;","    vec2 alignedPosition = position + alignment;","    vec2 rotatedPosition;","    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;","    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;","    vec4 finalPosition;","    if(useScreenCoordinates != 0) {","        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);","    }","    else {","        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;","        finalPosition.xy += rotatedPosition; ","    }","    gl_Position = finalPosition;","}"].join("\n"),uniforms:{}}},"undefined"==typeof console&&(console={log:function(){}}),h.ProteinSurface=function(){var e,t,r,o=1,n=2,a=4,s=0,l=0,c=0,u=1.4,f=2,d=f,p=0,v=0,m=0,g=0,y=null,b=null,x=null,w=0,C=0,_=0,A=0,M=0,S=0,z={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},L=function(e){return e.elem&&"undefined"!=typeof z[e.elem]?e.elem:"X"},T={},F={},I=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(r){var i,o,n={};for(i=0,o=r.length;i<o;i++)n[r[i]]=!0;var a=t;for(i=0,o=a.length;i<o;i++)a[i].x=a[i].x/d-s,a[i].y=a[i].y/d-l,a[i].z=a[i].z/d-c;var u=[];for(i=0,o=e.length;i<o;i+=3){var h=e[i],f=e[i+1],p=e[i+2],v=a[h].atomid,m=a[f].atomid,g=a[p].atomid,w=v;if(m<w&&(w=m),g<w&&(w=g),n[w]){a[e[i]],a[e[i+1]],a[e[i+2]];h!==f&&f!==p&&h!==p&&(u.push(h),u.push(f),u.push(p))}}return y=null,b=null,x=null,{vertices:a,faces:u}},this.initparm=function(e,t,i){i>1e6&&(d=f/2);var o=1/d*5.5;r=e,w=e[0][0],A=e[1][0],C=e[0][1],M=e[1][1],_=e[0][2],S=e[1][2],t?(w-=u+o,C-=u+o,_-=u+o,A+=u+o,M+=u+o,S+=u+o):(w-=o,C-=o,_-=o,A+=o,M+=o,S+=o),w=Math.floor(w*d)/d,C=Math.floor(C*d)/d,_=Math.floor(_*d)/d,A=Math.ceil(A*d)/d,M=Math.ceil(M*d)/d,S=Math.ceil(S*d)/d,s=-w,l=-C,c=-_,m=Math.ceil(d*(A-w))+1,v=Math.ceil(d*(M-C))+1,p=Math.ceil(d*(S-_))+1,this.boundingatom(t),g=u*d,y=new Uint8Array(m*v*p),b=new Float64Array(m*v*p),x=new Int32Array(m*v*p)},this.boundingatom=function(e){var t,r,i,o=[];flagradius=e;for(var n in z)if(z.hasOwnProperty(n)){var a=z[n];for(e?o[n]=(a+u)*d+.5:o[n]=a*d+.5,i=o[n]*o[n],F[n]=Math.floor(o[n])+1,T[n]=new Int32Array(F[n]*F[n]),indx=0,j=0;j<F[n];j++)for(k=0;k<F[n];k++)t=j*j+k*k,t>i?T[n][indx]=-1:(r=Math.sqrt(i-t),T[n][indx]=Math.floor(r)),indx++}},this.fillvoxels=function(e,t){var r,i;for(r=0,i=y.length;r<i;r++)y[r]=0,b[r]=-1,x[r]=-1;for(r in t){var a=e[t[r]];void 0!==a&&this.fillAtom(a,e)}for(r=0,i=y.length;r<i;r++)y[r]&o&&(y[r]|=n)},this.fillAtom=function(e,t){var r,i,n,a,u,h,f,g,b,w,C,_,A,M,S,z,I,E,O;r=Math.floor(.5+d*(e.x+s)),i=Math.floor(.5+d*(e.y+l)),n=Math.floor(.5+d*(e.z+c));var k=L(e),P=0,V=v*p;for(w=0,O=F[k];w<O;w++)for(C=0;C<O;C++){if(T[k][P]!=-1)for(z=-1;z<2;z++)for(I=-1;I<2;I++)for(E=-1;E<2;E++)if(0!==z&&0!==I&&0!==E)for(f=z*w,b=E*C,_=0;_<=T[k][P];_++)if(g=_*I,A=r+f,M=i+g,S=n+b,!(A<0||M<0||S<0||A>=m||M>=v||S>=p)){var R=A*V+M*p+S;if(y[R]&o){var D=t[x[R]];D.serial!=e.serial&&(a=r+f-Math.floor(.5+d*(D.x+s)),u=i+g-Math.floor(.5+d*(D.y+l)),h=n+b-Math.floor(.5+d*(D.z+c)),f*f+g*g+b*b<a*a+u*u+h*h&&(x[R]=e.serial))}else y[R]|=o,x[R]=e.serial}P++}},this.fillvoxelswaals=function(e,t){var r,i;for(r=0,i=y.length;r<i;r++)y[r]&=-3;for(r in t){var o=e[t[r]];void 0!==o&&this.fillAtomWaals(o,e)}},this.fillAtomWaals=function(e,t){var r,i,o,a,u,h,f,g,b,w,C,_,A,M,S,z,I,E,O,k=0;r=Math.floor(.5+d*(e.x+s)),i=Math.floor(.5+d*(e.y+l)),o=Math.floor(.5+d*(e.z+c));var P=L(e),V=v*p;for(A=0,O=F[P];A<O;A++)for(M=0;M<O;M++){if(T[P][k]!=-1)for(z=-1;z<2;z++)for(I=-1;I<2;I++)for(E=-1;E<2;E++)if(0!==z&&0!==I&&0!==E)for(f=z*A,b=E*M,S=0;S<=T[P][k];S++)if(g=S*I,w=r+f,C=i+g,_=o+b,!(w<0||C<0||_<0||w>=m||C>=v||_>=p)){var R=w*V+C*p+_;if(y[R]&n){var D=t[x[R]];D.serial!=e.serial&&(a=r+f-Math.floor(.5+d*(D.x+s)),u=i+g-Math.floor(.5+d*(D.y+l)),h=o+b-Math.floor(.5+d*(D.z+c)),f*f+g*g+b*b<a*a+u*u+h*h&&(x[R]=e.serial))}else y[R]|=n,x[R]=e.serial}k++}},this.buildboundary=function(){var e=v*p;for(i=0;i<m;i++)for(j=0;j<p;j++)for(k=0;k<v;k++){var t=i*e+k*p+j;if(y[t]&o)for(var r=0;r<26;){var n=i+I[r][0],s=j+I[r][2],l=k+I[r][1];if(n>-1&&n<m&&l>-1&&l<v&&s>-1&&s<p&&!(y[n*e+l*p+s]&o)){y[t]|=a;break}r++}}};var E=function(e,t,r){var i=new Int32Array(e*t*r*3);this.set=function(e,o,n,a){var s=3*((e*t+o)*r+n);i[s]=a.ix,i[s+1]=a.iy,i[s+2]=a.iz},this.get=function(e,o,n){var a=3*((e*t+o)*r+n);return{ix:i[a],iy:i[a+1],iz:i[a+2]}}};this.fastdistancemap=function(){var e,t,r,i,s,l=new E(m,v,p),c=v*p,u=g*g,h=[],f=[];for(e=0;e<m;e++)for(t=0;t<v;t++)for(r=0;r<p;r++)if(s=e*c+t*p+r,y[s]&=-3,y[s]&o&&y[s]&a){var x={ix:e,iy:t,iz:r};l.set(e,t,r,x),h.push(x),b[s]=0,y[s]|=n,y[s]&=-5}do for(f=this.fastoneshell(h,l),h=[],e=0,i=f.length;e<i;e++)s=c*f[e].ix+p*f[e].iy+f[e].iz,y[s]&=-5,b[s]<=1.0404*u&&h.push({ix:f[e].ix,iy:f[e].iy,iz:f[e].iz});while(0!==h.length);h=[],f=[],l=null;var w=d-.5;w<0&&(w=0);var C=u-.5/(.1+w);for(e=0;e<m;e++)for(t=0;t<v;t++)for(r=0;r<p;r++)s=e*c+t*p+r,y[s]&=-5,y[s]&o&&(y[s]&n&&!(y[s]&n&&b[s]>=C)||(y[s]|=a))},this.fastoneshell=function(e,t){var r,i,s,l,c,u,h,f,d,g,x,w,C=[];if(0===e.length)return C;tnv={ix:-1,iy:-1,iz:-1};var _=v*p;for(h=0,d=e.length;h<d;h++)for(r=e[h].ix,i=e[h].iy,s=e[h].iz,x=t.get(r,i,s),f=0;f<6;f++)tnv.ix=r+I[f][0],tnv.iy=i+I[f][1],tnv.iz=s+I[f][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(w=tnv.ix*_+p*tnv.iy+tnv.iz,y[w]&o&&!(y[w]&n)?(t.set(tnv.ix,tnv.iy,s+I[f][2],x),l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,b[w]=g,y[w]|=n,y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):y[w]&o&&y[w]&n&&(l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,g<b[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,x),b[w]=g,y[w]&a||(y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(h=0,d=e.length;h<d;h++)for(r=e[h].ix,i=e[h].iy,s=e[h].iz,x=t.get(r,i,s),f=6;f<18;f++)tnv.ix=r+I[f][0],tnv.iy=i+I[f][1],tnv.iz=s+I[f][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(w=tnv.ix*_+p*tnv.iy+tnv.iz,y[w]&o&&!(y[w]&n)?(t.set(tnv.ix,tnv.iy,s+I[f][2],x),l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,b[w]=g,y[w]|=n,y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):y[w]&o&&y[w]&n&&(l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,g<b[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,x),b[w]=g,y[w]&a||(y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(h=0,d=e.length;h<d;h++)for(r=e[h].ix,i=e[h].iy,s=e[h].iz,x=t.get(r,i,s),f=18;f<26;f++)tnv.ix=r+I[f][0],tnv.iy=i+I[f][1],tnv.iz=s+I[f][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(w=tnv.ix*_+p*tnv.iy+tnv.iz,y[w]&o&&!(y[w]&n)?(t.set(tnv.ix,tnv.iy,s+I[f][2],x),l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,b[w]=g,y[w]|=n,y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):y[w]&o&&y[w]&n&&(l=tnv.ix-x.ix,c=tnv.iy-x.iy,u=tnv.iz-x.iz,g=l*l+c*c+u*u,g<b[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,x),b[w]=g,y[w]&a||(y[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));return C},this.marchingcubeinit=function(e){for(var t=0,r=y.length;t<r;t++)1==e?y[t]&=-5:4==e?(y[t]&=-3,y[t]&a&&(y[t]|=n),y[t]&=-5):2==e?y[t]&a&&y[t]&n?y[t]&=-5:y[t]&a&&!(y[t]&n)&&(y[t]|=n):3==e&&(y[t]&=-5)};this.marchingcube=function(r){this.marchingcubeinit(r),t=[],e=[],h.MarchingCube.march(y,t,e,{smooth:1,nX:m,nY:v,nZ:p});for(var i=v*p,o=0,n=t.length;o<n;o++)t[o].atomid=x[t[o].x*i+p*t[o].y+t[o].z];h.MarchingCube.laplacianSmooth(1,t,e)}},$(document).ready(function(){if(void 0!==$(".viewer_3Dmoljs")[0]&&(h.autoinit=!0),h.autoinit){h.viewers={};var e=0;$(".viewer_3Dmoljs").each(function(){var t=$(this),r=null;"static"==t.css("position")&&t.css("position","relative");var i="function"==typeof window[t.data("callback")]?window[t.data("callback")]:null,o=null;t.data("pdb")?(r="http://www.rcsb.org/pdb/files/"+t.data("pdb")+".pdb",o="pdb"):t.data("cid")?(o="sdf",r="http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t.data("cid")+"/SDF?record_type=3d"):t.data("href")&&(r=t.data("href"));var n=h.CC.color(t.data("backgroundcolor")),a={line:{}};t.data("style")&&(a=h.specStringToObject(t.data("style")));var s={};t.data("select")&&(s=h.specStringToObject(t.data("select")));var l=[],c=[],u=[],f=t.data(),d=/style(.+)/,p=/surface(.*)/,v=/labelres(.*)/,m=[];for(var g in f)f.hasOwnProperty(g)&&m.push(g);m.sort();for(var y=0;y<m.length;y++){var g=m[y],b=d.exec(g);if(b){var x="select"+b[1],w=h.specStringToObject(f[x]),C=h.specStringToObject(f[g]);l.push([w,C])}if(b=p.exec(g)){var x="select"+b[1],w=h.specStringToObject(f[x]),C=h.specStringToObject(f[g]);c.push([w,C])}if(b=v.exec(g)){var x="select"+b[1],w=h.specStringToObject(f[x]),C=h.specStringToObject(f[g]);u.push([w,C])}}var _=function(e){e.setStyle(s,a);for(var t=0;t<l.length;t++){var r=l[t][0]||{},i=l[t][1]||{line:{}};e.setStyle(r,i)}for(var t=0;t<c.length;t++){var r=c[t][0]||{},i=c[t][1]||{};e.addSurface(h.SurfaceType.VDW,i,r,r)}for(var t=0;t<u.length;t++){var r=u[t][0]||{},i=u[t][1]||{};e.addResLabels(r,i)}e.zoomTo(),e.render()},A=null;try{A=h.viewers[this.id||e++]=h.createViewer(t,{defaultcolors:h.rasmolElementColors}),A.setBackgroundColor(n)}catch(M){window.location="http://get.webgl.org"}if(r)o=t.data("type")||t.data("datatype")||o,o||(o=r.substr(r.lastIndexOf(".")+1)),$.get(r,function(e){A.addModel(e,o),_(A),i&&i(A)},"text");else{if(t.data("element")){var S=$("#"+t.data("element")).val()||"",o=t.data("type")||t.data("datatype");o||(console.log("Warning: No type specified for embedded viewer with moldata from "+t.data("element")+"\n assuming type 'pdb'"),o="pdb"),A.addModel(S,o)}_(A),i&&i(A)}})}}),h.CC={cache:{0:new h.Color(0)},color:function f(e){if(!e)return this.cache[0];if("undefined"!=typeof this.cache[e])return this.cache[e];if(e&&e.constructor===Array)return e.map(f,this);if(e=this.getHex(e),"number"==typeof e){var t=new h.Color(e);return this.cache[e]=t,t}return e},colorTab:{white:16777215,silver:12632256,gray:8421504,grey:8421504,black:0,red:16711680,maroon:8388608,yellow:16776960,orange:16737792,olive:8421376,lime:65280,green:32768,aqua:65535,cyan:65535,teal:32896,blue:255,navy:128,fuchsia:16711935,magenta:16711935,purple:8388736},getHex:function(e){return isNaN(parseInt(e))?"string"==typeof e?this.colorTab[e.trim().toLowerCase()]||0:e:parseInt(e)}},h.CC=h.CC,h.CC.color=h.CC.color,h.getColorFromStyle=function(e,t){var r=e.color;if("undefined"!=typeof t.color&&"spectrum"!=t.color&&(r=t.color),"undefined"!=typeof t.colorscheme){if("undefined"!=typeof h.elementColors[t.colorscheme]){var i=h.elementColors[t.colorscheme];"undefined"!=typeof i[e.elem]&&(r=i[e.elem])}else if("undefined"!=typeof t.colorscheme[e.elem])r=t.colorscheme[e.elem];else if("undefined"!=typeof t.colorscheme.prop&&"undefined"!=typeof t.colorscheme.gradient){var o=t.colorscheme.prop,i=t.colorscheme.gradient,n=i.range()||[-1,1],a=h.getAtomProperty(e,o);null!=a&&(r=i.valueToHex(a,n))}else if("undefined"!=typeof t.colorscheme.prop&&"undefined"!=typeof t.colorscheme.map){var o=t.colorscheme.prop,a=h.getAtomProperty(e,o);"undefined"!=typeof t.colorscheme.map[a]&&(r=t.colorscheme.map[a])}}else"undefined"!=typeof t.colorfunc&&(r=t.colorfunc(e));var s=h.CC.color(r);return s},h.ssColors=h.ssColors||{},h.ssColors.pyMOL={h:16711680,s:16776960,c:65280},h.ssColors.Jmol={h:16711808,s:16762880,c:16777215},h.elementColors=h.elementColors||{},h.elementColors.defaultColor=16716947,h.elementColors.Jmol={H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ca:4062976,CA:4062976,Ti:12567239,TI:12567239,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Br:10889513,BR:10889513,Ag:12632256,AG:12632256,I:9699476,Ba:51456,BA:51456,Au:16765219,AU:16765219},h.elementColors.rasmol={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},h.elementColors.defaultColors=h.elementColors.rasmol,h.elementColors.greenCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.greenCarbon.C=65280,h.elementColors.cyanCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.cyanCarbon.C=65535,h.elementColors.magentaCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.magentaCarbon.C=16711935,h.elementColors.yellowCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.yellowCarbon.C=16776960,h.elementColors.whiteCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.whiteCarbon.C=16777215,h.elementColors.orangeCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.orangeCarbon.C=16737792,h.elementColors.purpleCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.purpleCarbon.C=8388736,h.elementColors.blueCarbon=$.extend({},h.elementColors.defaultColors),h.elementColors.blueCarbon.C=255;var h=h||{};h.drawCartoon=function(){var e=5,t=5,r=.5,i=1.3,o=.8,n=.4,a=function(e,t){var r=[],i=e;i=[],i.push(e[0]);var o,n,a,s,l,c,u,f,d;for(o=1,n=e.length-1;o<n;o++)l=e[o],c=e[o+1],l.smoothen?i.push(new h.Vector3((l.x+c.x)/2,(l.y+c.y)/2,(l.z+c.z)/2)):i.push(l);for(i.push(e[e.length-1]),o=-1,a=i.length;o<=a-3;o++)if(s=i[o===-1?0:o],l=i[o+1],c=i[o+2],u=i[o===a-3?a-1:o+3],f=(new h.Vector3).subVectors(c,s).multiplyScalar(.5),d=(new h.Vector3).subVectors(u,l).multiplyScalar(.5),!c.skip)for(var p=0;p<t;p++){var v=1/t*p,m=l.x+v*f.x+v*v*(-3*l.x+3*c.x-2*f.x-d.x)+v*v*v*(2*l.x-2*c.x+f.x+d.x),g=l.y+v*f.y+v*v*(-3*l.y+3*c.y-2*f.y-d.y)+v*v*v*(2*l.y-2*c.y+f.y+d.y),y=l.z+v*f.z+v*v*(-3*l.z+3*c.z-2*f.z-d.z)+v*v*v*(2*l.z-2*c.z+f.z+d.z),b=new h.Vector3(m,g,y),x=Math.floor((r.length+2)/t);void 0!==e[x]&&void 0!==e[x].atom&&(b.atom=e[x].atom),r.push(b)}return r.push(i[i.length-1]),r},s=function(e,t,r,i,o,n){for(var a,s,l,c,u=0,f=t.length;u<f;u++){c=Math.round(u*(i.length-1)/f),l=h.CC.color(i[c]),geoGroup=e.updateGeoGroup(2);var d=geoGroup.vertexArray,p=geoGroup.colorArray,v=geoGroup.faceArray;a=geoGroup.vertices,s=3*a,d[s]=t[u].x,d[s+1]=t[u].y,d[s+2]=t[u].z,d[s+3]=r[u].x,d[s+4]=r[u].y,d[s+5]=r[u].z;for(var m=0;m<6;++m)p[s+3*m]=l.r,p[s+1+3*m]=l.g,p[s+2+3*m]=l.b;if(u>0){var g=[a,a+1,a-1,a-2],y=geoGroup.faceidx;v[y]=g[0],v[y+1]=g[1],v[y+2]=g[3],v[y+3]=g[1],v[y+4]=g[2],v[y+5]=g[3],geoGroup.faceidx+=6}geoGroup.vertices+=2}},l=function(e,t,r,i,o,n,l){var c,u,f,d;if(f=t.length,!(f<2||t[0].length<2)){for(i=i||axisDIV,c=0;c<f;c++)t[c]=a(t[c],i);if(d=t[0].length,!o)return s(e,t[0],t[f-1],r,i,n);var p,v,m,g,y,b,x=[],w=[],C=[];for(u=0;u<f;u++)x.push(.25+1.5*Math.sqrt((f-1)*u-Math.pow(u,2))/(f-1)),w.push(.5),C.push(2*(Math.pow(u/f,2)-u/f)+.6);var _=[];for(u=0;u<2*f-1;u++)_[u]=[u,u+1,u+1-2*f,u-2*f];_[2*f-1]=[u,u+1-2*f,u+1-4*f,u-2*f];var A,M,S,z,L,T,F,I=e.updateGeoGroup(2*f*d);for(c=0;c<d;c++){F=Math.round(c*(r.length-1)/d),T=h.CC.color(r[F]),y=m,b=g,m=[],g=[],p=[],void 0!==t[0][c].atom&&(z=t[0][c].atom,"oval"===l?v=x:"rectangle"===l?v=w:"parabola"===l&&(v=C)),v||(v=w);var E,O;for(u=0;u<f;u++)E=c<d-1?t[u][c+1].clone().sub(t[u][c]):t[u][c-1].clone().sub(t[u][c]).negate(),O=u<f-1?t[u+1][c].clone().sub(t[u][c]):t[u-1][c].clone().sub(t[u][c]).negate(),p[u]=O.cross(E).normalize().multiplyScalar(o*v[u]);for(u=0;u<f;u++)m[u]=t[u][c].clone().add(p[u].clone().negate());for(u=0;u<f;u++)g[u]=t[u][c].clone().add(p[u]);var k=I.vertexArray,P=I.colorArray,V=I.faceArray;for(A=I.vertices,M=3*A,u=0;u<f;u++)k[M+3*u+0]=m[u].x,k[M+3*u+1]=m[u].y,k[M+3*u+2]=m[u].z;for(u=0;u<f;u++)k[M+3*u+0+3*f]=g[f-1-u].x,k[M+3*u+1+3*f]=g[f-1-u].y,k[M+3*u+2+3*f]=g[f-1-u].z;for(u=0;u<2*f;++u)P[M+3*u+0]=T.r,P[M+3*u+1]=T.g,P[M+3*u+2]=T.b;if(c>0){for(u=0;u<2*f;u++){var R=[A+_[u][0],A+_[u][1],A+_[u][2],A+_[u][3]];S=I.faceidx,V[S]=R[0],V[S+1]=R[1],V[S+2]=R[3],V[S+3]=R[1],V[S+4]=R[2],V[S+5]=R[3],I.faceidx+=6}if(z.clickable){var D=[];D.push(new h.Triangle(y[0],m[0],m[f-1])),D.push(new h.Triangle(y[0],m[f-1],y[f-1])),D.push(new h.Triangle(y[f-1],m[f-1],g[f-1])),D.push(new h.Triangle(y[f-1],g[f-1],b[f-1])),D.push(new h.Triangle(g[0],b[0],b[f-1])),D.push(new h.Triangle(g[f-1],g[0],b[f-1])),D.push(new h.Triangle(m[0],y[0],b[0])),D.push(new h.Triangle(g[0],m[0],b[0]));for(u in D)z.intersectionShape.triangle.push(D[u])}}I.vertices+=2*f,L=z}var k=I.vertexArray,P=I.colorArray,V=I.faceArray;for(A=I.vertices,M=3*A,S=I.faceidx,c=0;c<f-1;c++){var R=[c,c+1,2*f-2-c,2*f-1-c];S=I.faceidx,V[S]=R[0],V[S+1]=R[1],V[S+2]=R[3],V[S+3]=R[1],V[S+4]=R[2],V[S+5]=R[3],I.faceidx+=6}for(c=0;c<f-1;c++){var R=[A-1-c,A-2-c,A-2*f+c+1,A-2*f+c];S=I.faceidx,V[S]=R[0],V[S+1]=R[1],V[S+2]=R[3],V[S+3]=R[1],V[S+4]=R[2],V[S+5]=R[3],I.faceidx+=6}}},c=function(e,t,r,i,o,n){if(!(t.length<2)){var l,c;if(l=t[0],c=t[t.length-1],i=i||axisDIV,l=a(l,i),c=a(c,i),!o)return s(e,l,c,r,i,n);var u,f,d,p,v,m,g,y,b,x,w,C,_,A,M,S,z,L,T,F=[],I=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]];for(_=0,A=l.length;_<A;_++){if(x=Math.round(_*(r.length-1)/A),b=h.CC.color(r[x]),F.push(f=l[_]),F.push(f),F.push(d=c[_]),F.push(d),_<A-1){var E=l[_+1].clone().sub(l[_]),O=c[_].clone().sub(l[_]);u=O.cross(E).normalize().multiplyScalar(o)}F.push(p=l[_].clone().add(u)),F.push(p),F.push(v=c[_].clone().add(u)),F.push(v),void 0!==f.atom&&(w=f.atom),T=e.updateGeoGroup(8);var k=T.vertexArray,P=T.colorArray,V=T.faceArray;for(m=T.vertices,g=3*m,k[g]=f.x,k[g+1]=f.y,k[g+2]=f.z,k[g+3]=f.x,k[g+4]=f.y,k[g+5]=f.z,k[g+6]=d.x,k[g+7]=d.y,k[g+8]=d.z,k[g+9]=d.x,k[g+10]=d.y,k[g+11]=d.z,k[g+12]=p.x,k[g+13]=p.y,k[g+14]=p.z,k[g+15]=p.x,k[g+16]=p.y,k[g+17]=p.z,k[g+18]=v.x,k[g+19]=v.y,k[g+20]=v.z,k[g+21]=v.x,k[g+22]=v.y,k[g+23]=v.z,M=0;M<8;++M)P[g+3*M]=b.r,P[g+1+3*M]=b.g,P[g+2+3*M]=b.b;if(_>0){var R=void 0!==C&&void 0!==w&&C.serial!==w.serial;for(M=0;M<4;M++){var D=[m+I[M][0],m+I[M][1],m+I[M][2],m+I[M][3]];if(y=T.faceidx,V[y]=D[0],V[y+1]=D[1],V[y+2]=D[3],V[y+3]=D[1],V[y+4]=D[2],V[y+5]=D[3],T.faceidx+=6,w.clickable||C.clickable){var N=F[D[3]].clone(),U=F[D[0]].clone(),B=F[D[2]].clone(),j=F[D[1]].clone();if(N.atom=F[D[3]].atom||null,B.atom=F[D[2]].atom||null,U.atom=F[D[0]].atom||null,j.atom=F[D[1]].atom||null,R){var G=N.clone().add(U).multiplyScalar(.5),H=B.clone().add(j).multiplyScalar(.5),W=N.clone().add(j).multiplyScalar(.5);M%2===0?(C.clickable&&(S=new h.Triangle(G,W,N),z=new h.Triangle(H,B,W),L=new h.Triangle(W,B,N),C.intersectionShape.triangle.push(S),C.intersectionShape.triangle.push(z),C.intersectionShape.triangle.push(L)),w.clickable&&(S=new h.Triangle(U,j,W),z=new h.Triangle(j,H,W),L=new h.Triangle(U,W,G),w.intersectionShape.triangle.push(S),w.intersectionShape.triangle.push(z),w.intersectionShape.triangle.push(L))):(w.clickable&&(S=new h.Triangle(G,W,N),z=new h.Triangle(H,B,W),L=new h.Triangle(W,B,N),w.intersectionShape.triangle.push(S),w.intersectionShape.triangle.push(z),w.intersectionShape.triangle.push(L)),C.clickable&&(S=new h.Triangle(U,j,W),z=new h.Triangle(j,H,W),L=new h.Triangle(U,W,G),C.intersectionShape.triangle.push(S),C.intersectionShape.triangle.push(z),C.intersectionShape.triangle.push(L)))}else w.clickable&&(S=new h.Triangle(U,j,N),z=new h.Triangle(j,B,N),w.intersectionShape.triangle.push(S),w.intersectionShape.triangle.push(z))}}}T.vertices+=8,C=w}var q=F.length-8;T=e.updateGeoGroup(8);var k=T.vertexArray,P=T.colorArray,V=T.faceArray;for(m=T.vertices,g=3*m,y=T.faceidx,_=0;_<4;_++){F.push(F[2*_]),F.push(F[q+2*_]);var Y=F[2*_],Z=F[q+2*_];k[g+6*_]=Y.x,k[g+1+6*_]=Y.y,k[g+2+6*_]=Y.z,k[g+3+6*_]=Z.x,k[g+4+6*_]=Z.y,k[g+5+6*_]=Z.z,P[g+6*_]=b.r,P[g+1+6*_]=b.g,P[g+2+6*_]=b.b,P[g+3+6*_]=b.r,P[g+4+6*_]=b.g,P[g+5+6*_]=b.b}q+=8,S=[m,m+2,m+6,m+4],z=[m+1,m+5,m+7,m+3],V[y]=S[0],V[y+1]=S[1],V[y+2]=S[3],V[y+3]=S[1],V[y+4]=S[2],V[y+5]=S[3],V[y+6]=z[0],V[y+7]=z[1],V[y+8]=z[3],V[y+9]=z[1],V[y+10]=z[2],V[y+11]=z[3],T.faceidx+=12,T.vertices+=8}},u=function(e,t,r,i,o){if(0!==t.length){o=void 0===o?5:o;var n=new h.Geometry,s=(a(t,o),new h.LineBasicMaterial({linewidth:r}));s.vertexColors=!0;var l=new h.Line(n,s);l.type=h.LineStrip,e.add(l)}},f=function(e,t,r,i,o,n,a){a&&"default"!==a||(a="rectangle"),"edged"===a?c(e,t,r,i,o,n):"rectangle"!==a&&"oval"!==a&&"parabola"!==a||l(e,t,r,i,o,n,a)},d=function(e){return e&&"C"===e.elem&&"CA"===e.atom},p=function(e,t){if(e&&t&&e.chain===t.chain){if(e.reschain===t.reschain&&(e.resi===t.resi||e.resi===t.resi-1))return!0;if(e.resi<t.resi){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,n=r*r+i*i+o*o;if(n<16)return!0}}return!1},v=function(e,t,r,i,o){if(null!=t&&0!=t.vertices){o&&(t.initTypedArrays(),t.setUpNormals());var n=new h.MeshDoubleLambertMaterial;n.vertexColors=h.FaceColors,"number"==typeof r&&r>=0&&r<1&&(n.transparent=!0,n.opacity=r),n.outline=i;var a=new h.Mesh(t,n);e.add(a)}},m={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},g={DA:!0,DG:!0,A:!0,G:!0},y={DT:!0,DC:!0,U:!0,C:!0,T:!0},b={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0},x=function(r,i,o,a,s,l,c){l=l||e,c=c||t;for(var x,C,_,A,M,S,z,L,T,F,I,E,O,k,P,V,R,D,N,U=new h.Geometry((!0)),B=new h.Geometry((!0)),j=[],G=[],H=1,W=!1,L=0;L<l;L++)G[L]=[];var q=!1,Y=!1;L=0;var Z=[];for(L in i){if(A=i[L],"C"===A.elem&&"CA"===A.atom){var X=p(_,A);X&&"s"===A.ss?q=!0:q&&(_&&C&&_.style.cartoon.arrows&&C.style.cartoon.arrows&&(_.ss="arrow end",C.ss="arrow start"),q=!1),X&&"h"===_.ss?(!Y&&A.style.cartoon.tubes&&(A.ss="tube start"),Y=!0):Y&&"tube start"!==_.ss&&(C&&C.style.cartoon.tubes&&(C.ss="tube end"),Y=!1),C=_,_=A}A&&A.atom in m&&Z.push(A)}var Q=function(){for(var e=0;!z&&e<l;e++)u(r,G[e],1,j,c,H);for(a&&G[0].length>0&&f(B,G,j,c,z,H,G.style),G=[],e=0;e<l;e++)G[e]=[];j=[],v(r,B,H,W,!0),v(r,U,H,W,!1),B=new h.Geometry((!0)),U=new h.Geometry((!0))};_=void 0;for(var K=0;K<Z.length;K++){A=Z[K];var J=A.resn.trim(),ee=J in b;if(H=1,x=A.style.cartoon,_&&_.style.cartoon&&(H=_.style.cartoon.opacity),_&&_.style.cartoon&&_.style.cartoon.outline&&(W=_.style.cartoon.outline),!_||!_.style.cartoon||A.style.cartoon&&_.style.cartoon.opacity==A.style.cartoon.opacity||Q(),"trace"===x.style){if("C"===A.elem&&"CA"===A.atom||ee&&"P"===A.atom){if(S=o&&"spectrum"===x.color?o.valueToHex(A.resi,o.range()):h.getColorFromStyle(A,x).getHex(),z=$.isNumeric(x.thickness)?x.thickness:n,p(_,A))if(S==M){var te=h.CC.color(S);h.GLDraw.drawCylinder(U,_,A,z,te,2,2)}else{var re=(new h.Vector3).addVectors(_,A).multiplyScalar(.5),ie=h.CC.color(M),oe=h.CC.color(S);h.GLDraw.drawCylinder(U,_,re,z,ie,2,0),h.GLDraw.drawCylinder(U,re,A,z,oe,0,2)}_=A,M=S}}else{if(d(A)||ee&&("P"===A.atom||0==A.atom.indexOf("O5"))){if(N){if("tube end"!==A.ss)continue;N=!1,D=new h.Vector3(A.x,A.y,A.z),h.GLDraw.drawCylinder(U,R,D,2,h.CC.color(M),1,1),A.ss="h"}if(_&&(!p(_,A)||"tube start"===_.ss)){for("tube start"===_.ss&&(N=!0,R=new h.Vector3(_.x,_.y,_.z),_.ss="h"),V&&(P=O?(new h.Vector3).addVectors(_,O).multiplyScalar(.5):new h.Vector3(_.x,_.y,_.z),h.GLDraw.drawCylinder(U,P,V,.4,h.CC.color(V.color),0,2),T=w(G,l,!s,O,k,E,_,Z,K),j.push(S),T&&j.push(S),P=null,V=null),L=0;!z&&L<l;L++)u(r,G[L],1,j,c,H);for(a&&G[0].length>0&&f(B,G,j,c,z,H,G.style),G=[],L=0;L<l;L++)G[L]=[];j=[]}if(void 0===_||_.rescode!=A.rescode||_.resi!=A.resi){if(V){P=(new h.Vector3).addVectors(_,A).multiplyScalar(.5);var ne=P.clone().sub(V).multiplyScalar(.02);P.add(ne),h.GLDraw.drawCylinder(U,P,V,.4,h.CC.color(V.color),0,2),P=null,V=null}S=o&&"spectrum"===x.color?o.valueToHex(A.resi,o.range()):h.getColorFromStyle(A,x).getHex(),j.push(S),z=$.isNumeric(x.thickness)?x.thickness:n,_=A,F=new h.Vector3(_.x,_.y,_.z),F.resi=_.resi,M=S}A.clickable!==!0||void 0!==A.intersectionShape&&void 0!==A.intersectionShape.triangle||(A.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else d(_)&&"O"===A.atom||ee&&"P"===_.atom&&("OP2"===A.atom||"O2P"===A.atom)||ee&&0==_.atom.indexOf("O5")&&0==A.atom.indexOf("C5")?(I=new h.Vector3(A.x,A.y,A.z),I.resi=A.resi,"OP2"!==A.atom&&"O2P"!==A.atom||(k=new h.Vector3(A.x,A.y,A.z))):ee&&0==A.atom.indexOf("O3")?O=new h.Vector3(A.x,A.y,A.z):("N1"===A.atom&&J in g||"N3"===A.atom&&J in y)&&(V=new h.Vector3(A.x,A.y,A.z),V.color=h.getColorFromStyle(A,x).getHex());I&&F&&I.resi===F.resi&&(T=w(G,l,!s,F,I,E,_,Z,K),E=I,F=null,I=null,j.push(S),T&&j.push(S))}}V&&(P=O?(new h.Vector3).addVectors(_,O).multiplyScalar(.5):new h.Vector3(_.x,_.y,_.z),h.GLDraw.drawCylinder(U,P,V,.4,h.CC.color(V.color),0,2),T=w(G,l,!s,O,k,E,_,Z,K),j.push(S),T&&j.push(S)),Q()},w=function(e,t,a,s,l,c,u,f,d){var p,v,m,g,y,b;if(s&&l&&u){var x=l.sub(s);x.normalize();for(var w=f[d],v=d+1;v<f.length&&(w=f[v],w.atom!=u.atom);v++);if(w=w?new h.Vector3(w.x,w.y,w.z):new h.Vector3(0,0,0),w.sub(s),"arrow start"===u.ss){var C=w.clone().multiplyScalar(.3).cross(l);s.add(C);var _=w.clone().cross(x).normalize();x.rotateAboutVector(_,.43)}for(u.style.cartoon.ribbon?p=u.style.cartoon.thickness||n:u.style.cartoon.width?p=u.style.cartoon.width:"c"===u.ss?p="P"===u.atom?o:r:"arrow start"===u.ss?(p=i,y=!0):p="arrow end"===u.ss?r:"h"===u.ss&&u.style.cartoon.tubes||"tube start"===u.ss?r:i,null!=c&&x.dot(c)<0&&x.negate(),x.multiplyScalar(p),v=0;v<t;v++)m=-1+2*v/(t-1),g=new h.Vector3(s.x+m*x.x,s.y+m*x.y,s.z+m*x.z),g.atom=u,a&&"s"===u.ss&&(g.smoothen=!0),e[v].push(g);if(y)for(x.multiplyScalar(2),v=0;v<t;v++)m=-1+2*v/(t-1),g=new h.Vector3(s.x+m*x.x,s.y+m*x.y,s.z+m*x.z),g.atom=u,g.smoothen=!1,g.skip=!0,e[v].push(g);return b=u.style.cartoon.style||"default",e.style?e.style!=b&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),e.style="default"):e.style=b,"arrow start"!==u.ss&&"arrow end"!==u.ss||(u.ss="s"),y}},C=function(e,t,r,i){i=parseInt(5*parseFloat(i))||5,x(e,t,r,!0,!1,i,i)};return C}();var h=h||{};h.GLDraw=function(){var e={},t=function(){var e=new h.Vector3;return function(t){e.set(t[0],t[1],t[2]);var r,i,o,n,a,s=e.x,l=e.y,c=e.z,u=Math.sqrt(s*s+l*l);u<1e-4?(i=0,o=1):(i=-s/u,o=l/u),l=-i*s+o*l,r=Math.sqrt(l*l+c*c),r<1e-4?(n=0,a=1):(n=c/r,a=l/r);var h=new Float32Array(9);return h[0]=o,h[1]=i,h[2]=0,h[3]=-i*a,h[4]=o*a,h[5]=n,h[6]=i*n,h[7]=-o*n,h[8]=a,h}}(),r=function(){var e,t=[],r=4,i=Math.pow(2,r),o=2,n=Math.pow(2,o),a=i/n;for(t[0]=new h.Vector3((-1),0,0),t[a]=new h.Vector3(0,0,1),t[2*a]=new h.Vector3(1,0,0),t[3*a]=new h.Vector3(0,0,(-1)),o=3;o<=r;o++){for(n=Math.pow(2,o-1),a=i/n,e=0;e<n-1;e++)t[a/2+e*a]=t[e*a].clone().add(t[(e+1)*a]).normalize();e=n-1,t[a/2+e*a]=t[e*a].clone().add(t[0]).normalize()}return t}(),i={cache:{"false":{},"true":{}},getVerticesForRadius:function(e,t){if(void 0!==this.cache[t][e])return this.cache[t][e];for(var i,o=(new h.Vector3(0,1,0),r.length),n=[],a=[],s=0;s<o;s++)n.push(r[s].clone().multiplyScalar(e)),n.push(r[s].clone().multiplyScalar(e)),i=r[s].clone().normalize(),a.push(i),a.push(i);var l=[],c=10,u=o;if(c%2!==0||!c)return console.error("heightSegments must be even"),null;var f,d,p=0,v=2*Math.PI,m=0,g=Math.PI,y=!1,b=!1;for(d=0;d<=c;d++){y=0===d||d===c,b=d===c/2;var x=[],w=[];for(f=0;f<=u;f++)if(b){var C=f<u?2*f:0;w.push(C+1),x.push(C)}else{var _=f/u,A=d/c;if(y&&0!==f)y&&x.push(n.length-1);else if(f<u){var M=new h.Vector3;M.x=-e*Math.cos(p+_*v)*Math.sin(m+A*g),M.y=t?0:e*Math.cos(m+A*g),M.z=e*Math.sin(p+_*v)*Math.sin(m+A*g),Math.abs(M.x)<1e-5&&(M.x=0),Math.abs(M.y)<1e-5&&(M.y=0),Math.abs(M.z)<1e-5&&(M.z=0),
t?(i=new h.Vector3(0,Math.cos(m+A*g),0),i.normalize()):(i=new h.Vector3(M.x,M.y,M.z),i.normalize()),n.push(M),a.push(i),x.push(n.length-1)}else x.push(n.length-u)}b&&l.push(w),l.push(x)}var S={vertices:n,normals:a,verticesRows:l,w:u,h:c};return this.cache[t][e]=S,S}},o=0;e.drawCylinder=function(e,r,n,a,s,l,c){if(r&&n){o++;var u=l||c,h=!1;1==l&&1==c&&(h=!0),s=s||{r:0,g:0,b:0};var f=[n.x,n.y,n.z];f[0]-=r.x,f[1]-=r.y,f[2]-=r.z;var d,p,v,m,g,y,b=t(f),x=i.getVerticesForRadius(a,h),w=x.w,C=x.h,_=u?C*w+2:2*w,A=e.updateGeoGroup(_),M=x.vertices,S=x.normals,z=x.verticesRows,L=z[C/2],T=z[C/2+1],F=A.vertices,I=A.vertexArray,E=A.normalArray,O=A.colorArray,k=A.faceArray;for(v=0;v<w;++v){var P=2*v;m=b[0]*M[P].x+b[3]*M[P].y+b[6]*M[P].z,g=b[1]*M[P].x+b[4]*M[P].y+b[7]*M[P].z,y=b[5]*M[P].y+b[8]*M[P].z,d=3*(F+P),p=A.faceidx,I[d]=m+r.x,I[d+1]=g+r.y,I[d+2]=y+r.z,I[d+3]=m+n.x,I[d+4]=g+n.y,I[d+5]=y+n.z,E[d]=m,E[d+3]=m,E[d+1]=g,E[d+4]=g,E[d+2]=y,E[d+5]=y,O[d]=s.r,O[d+3]=s.r,O[d+1]=s.g,O[d+4]=s.g,O[d+2]=s.b,O[d+5]=s.b,k[p]=T[v]+F,k[p+1]=T[v+1]+F,k[p+2]=L[v]+F,k[p+3]=L[v]+F,k[p+4]=T[v+1]+F,k[p+5]=L[v+1]+F,A.faceidx+=6}if(u){var V,R,D,N,U,B,j,G,H,W,q,Y,Z,$,X,Q,K,J,ee,te,re,ie,oe,ne,ae,se,le,ce,ue,he,fe,de,pe=c?0:C/2,ve=l?C+1:C/2+1;for(g=pe;g<ve;g++)if(g!==C/2){var me=g<=C/2?n:r;for(m=0;m<w;m++)p=A.faceidx,V=z[g][m+1],ue=3*(V+F),R=z[g][m],he=3*(R+F),D=z[g+1][m],fe=3*(D+F),N=z[g+1][m+1],de=3*(N+F),U=b[0]*M[V].x+b[3]*M[V].y+b[6]*M[V].z,B=b[0]*M[R].x+b[3]*M[R].y+b[6]*M[R].z,j=b[0]*M[D].x+b[3]*M[D].y+b[6]*M[D].z,G=b[0]*M[N].x+b[3]*M[N].y+b[6]*M[N].z,H=b[1]*M[V].x+b[4]*M[V].y+b[7]*M[V].z,W=b[1]*M[R].x+b[4]*M[R].y+b[7]*M[R].z,q=b[1]*M[D].x+b[4]*M[D].y+b[7]*M[D].z,Y=b[1]*M[N].x+b[4]*M[N].y+b[7]*M[N].z,Z=b[5]*M[V].y+b[8]*M[V].z,$=b[5]*M[R].y+b[8]*M[R].z,X=b[5]*M[D].y+b[8]*M[D].z,Q=b[5]*M[N].y+b[8]*M[N].z,I[ue]=U+me.x,I[he]=B+me.x,I[fe]=j+me.x,I[de]=G+me.x,I[ue+1]=H+me.y,I[he+1]=W+me.y,I[fe+1]=q+me.y,I[de+1]=Y+me.y,I[ue+2]=Z+me.z,I[he+2]=$+me.z,I[fe+2]=X+me.z,I[de+2]=Q+me.z,O[ue]=s.r,O[he]=s.r,O[fe]=s.r,O[de]=s.r,O[ue+1]=s.g,O[he+1]=s.g,O[fe+1]=s.g,O[de+1]=s.g,O[ue+2]=s.b,O[he+2]=s.b,O[fe+2]=s.b,O[de+2]=s.b,K=b[0]*S[V].x+b[3]*S[V].y+b[6]*S[V].z,J=b[0]*S[R].x+b[3]*S[R].y+b[6]*S[R].z,ee=b[0]*S[D].x+b[3]*S[D].y+b[6]*S[D].z,te=b[0]*S[N].x+b[3]*S[N].y+b[6]*S[N].z,re=b[1]*S[V].x+b[4]*S[V].y+b[7]*S[V].z,ie=b[1]*S[R].x+b[4]*S[R].y+b[7]*S[R].z,oe=b[1]*S[D].x+b[4]*S[D].y+b[7]*S[D].z,ne=b[1]*S[N].x+b[4]*S[N].y+b[7]*S[N].z,ae=b[5]*S[V].y+b[8]*S[V].z,se=b[5]*S[R].y+b[8]*S[R].z,le=b[5]*S[D].y+b[8]*S[D].z,ce=b[5]*S[N].y+b[8]*S[N].z,0===g?(E[ue]=K,E[fe]=ee,E[de]=te,E[ue+1]=re,E[fe+1]=oe,E[de+1]=ne,E[ue+2]=ae,E[fe+2]=le,E[de+2]=ce,k[p]=V+F,k[p+1]=D+F,k[p+2]=N+F,A.faceidx+=3):g===ve-1?(E[ue]=K,E[he]=J,E[fe]=ee,E[ue+1]=re,E[he+1]=ie,E[fe+1]=oe,E[ue+2]=ae,E[he+2]=se,E[fe+2]=le,k[p]=V+F,k[p+1]=R+F,k[p+2]=D+F,A.faceidx+=3):(E[ue]=K,E[he]=J,E[de]=te,E[ue+1]=re,E[he+1]=ie,E[de+1]=ne,E[ue+2]=ae,E[he+2]=se,E[de+2]=ce,E[he]=J,E[fe]=ee,E[de]=te,E[he+1]=ie,E[fe+1]=oe,E[de+1]=ne,E[he+2]=se,E[fe+2]=le,E[de+2]=ce,k[p]=V+F,k[p+1]=R+F,k[p+2]=N+F,k[p+3]=R+F,k[p+4]=D+F,k[p+5]=N+F,A.faceidx+=6)}}A.vertices+=_}},e.drawCone=function(e,i,o,n,a){if(i&&o){a=a||{r:0,g:0,b:0};var s=[o.x,o.y,o.z];s.x-=i.x,s.y-=i.y,s.z-=i.z;var l,c,u,f,d,p,v=t(s),m=r.length,g=r,y=m+2,b=e.updateGeoGroup(y),x=b.vertices,w=b.vertexArray,C=b.normalArray,_=b.colorArray,A=b.faceArray,l=3*x,M=new h.Vector3(s[0],s[1],s[2]).normalize();for(w[l]=i.x,w[l+1]=i.y,w[l+2]=i.z,C[l]=-M.x,C[l+1]=-M.y,C[l+2]=-M.z,_[l]=a.r,_[l+1]=a.g,_[l+2]=a.b,w[l+3]=o.x,w[l+4]=o.y,w[l+5]=o.z,C[l+3]=M.x,C[l+4]=M.y,C[l+5]=M.z,_[l+3]=a.r,_[l+4]=a.g,_[l+5]=a.b,l+=6,u=0;u<m;++u){var S=g[u].clone();S.multiplyScalar(n),f=v[0]*S.x+v[3]*S.y+v[6]*S.z,d=v[1]*S.x+v[4]*S.y+v[7]*S.z,p=v[5]*S.y+v[8]*S.z,w[l]=f+i.x,w[l+1]=d+i.y,w[l+2]=p+i.z,C[l]=f,C[l+1]=d,C[l+2]=p,_[l]=a.r,_[l+1]=a.g,_[l+2]=a.b,l+=3}b.vertices+=m+2;var c=b.faceidx;for(u=0;u<m;u++){var z=x+2+u,L=x+2+(u+1)%m;A[c]=z,A[c+1]=L,A[c+2]=x,c+=3,A[c]=z,A[c+1]=L,A[c+2]=x+1,c+=3}b.faceidx+=6*m}};var n={cache:{},getVerticesForRadius:function(e){if("undefined"!=typeof this.cache[e])return this.cache[e];var t={vertices:[],verticesRows:[],normals:[]},r=1,i=16*r,o=10*r;e<1&&(i=10*r,o=8*r);var n,a,s=0,l=2*Math.PI,c=0,u=Math.PI;for(a=0;a<=o;a++){var f=[];for(n=0;n<=i;n++){var d=n/i,p=a/o,v={};v.x=-e*Math.cos(s+d*l)*Math.sin(c+p*u),v.y=e*Math.cos(c+p*u),v.z=e*Math.sin(s+d*l)*Math.sin(c+p*u);var m=new h.Vector3(v.x,v.y,v.z);m.normalize(),t.vertices.push(v),t.normals.push(m),f.push(t.vertices.length-1)}t.verticesRows.push(f)}return this.cache[e]=t,t}};return e.drawSphere=function(e,t,r,i){for(var o,a,s=(new h.Vector3(t.x,t.y,t.z),n.getVerticesForRadius(r)),l=s.vertices,c=s.normals,u=e.updateGeoGroup(l.length),f=u.vertices,d=u.vertexArray,p=u.colorArray,v=u.faceArray,m=u.lineArray,g=u.normalArray,y=0,b=l.length;y<b;++y){var x=3*(f+y),w=l[y];d[x]=w.x+t.x,d[x+1]=w.y+t.y,d[x+2]=w.z+t.z,p[x]=i.r,p[x+1]=i.g,p[x+2]=i.b}u.vertices+=l.length;var C=s.verticesRows,_=C.length-1;for(a=0;a<_;a++){var A=C[a].length-1;for(o=0;o<A;o++){var M=u.faceidx,S=u.lineidx,z=C[a][o+1]+f,L=3*z,T=C[a][o]+f,F=3*T,I=C[a+1][o]+f,E=3*I,O=C[a+1][o+1]+f,k=3*O,P=c[z-f],V=c[T-f],R=c[I-f],D=c[O-f];Math.abs(l[z-f].y)===r?(g[L]=P.x,g[E]=R.x,g[k]=D.x,g[L+1]=P.y,g[E+1]=R.y,g[k+1]=D.y,g[L+2]=P.z,g[E+2]=R.z,g[k+2]=D.z,v[M]=z,v[M+1]=I,v[M+2]=O,m[S]=z,m[S+1]=I,m[S+2]=z,m[S+3]=O,m[S+4]=I,m[S+5]=O,u.faceidx+=3,u.lineidx+=6):Math.abs(l[I-f].y)===r?(g[L]=P.x,g[F]=V.x,g[E]=R.x,g[L+1]=P.y,g[F+1]=V.y,g[E+1]=R.y,g[L+2]=P.z,g[F+2]=V.z,g[E+2]=R.z,v[M]=z,v[M+1]=T,v[M+2]=I,m[S]=z,m[S+1]=T,m[S+2]=z,m[S+3]=I,m[S+4]=T,m[S+5]=I,u.faceidx+=3,u.lineidx+=6):(g[L]=P.x,g[F]=V.x,g[k]=D.x,g[L+1]=P.y,g[F+1]=V.y,g[k+1]=D.y,g[L+2]=P.z,g[F+2]=V.z,g[k+2]=D.z,g[F]=V.x,g[E]=R.x,g[k]=D.x,g[F+1]=V.y,g[E+1]=R.y,g[k+1]=D.y,g[F+2]=V.z,g[E+2]=R.z,g[k+2]=D.z,v[M]=z,v[M+1]=T,v[M+2]=O,v[M+3]=T,v[M+4]=I,v[M+5]=O,m[S]=z,m[S+1]=T,m[S+2]=z,m[S+3]=O,m[S+4]=T,m[S+5]=I,m[S+6]=I,m[S+7]=O,u.faceidx+=6,u.lineidx+=8)}}},e}();var h=h||{};h.GLModel=function(){function e(n,u){var f,d=[],p=[],v=n,m=!1,g=null,y=null,b=null,x={},w=new h.Matrix4,C=h.elementColors.defaultColor,_=u?u:h.elementColors.defaultColors,A=1.5,M=function(e,t){var r=A;return"undefined"!=typeof t.radius?r=t.radius:o[e.elem]&&(r=o[e.elem]),"undefined"!=typeof t.scale&&(r*=t.scale),r},S=function(e,t){if(e.style.cross){var i=e.style.cross;if(!i.hidden){var o=i.linewidth||r;t[o]||(t[o]=new h.Geometry);var n=t[o].updateGeoGroup(6),a=M(e,i),s=[[a,0,0],[-a,0,0],[0,a,0],[0,-a,0],[0,0,a],[0,0,-a]],l=e.clickable||e.hoverable;l&&void 0===e.intersectionShape&&(e.intersectionShape={sphere:[],cylinder:[],line:[]});for(var c=h.getColorFromStyle(e,i),u=n.vertexArray,f=n.colorArray,d=0;d<6;d++){var p=3*n.vertices;if(n.vertices++,u[p]=e.x+s[d][0],u[p+1]=e.y+s[d][1],u[p+2]=e.z+s[d][2],f[p]=c.r,f[p+1]=c.g,f[p+2]=c.b,l){var v=new h.Vector3(s[d][0],s[d][1],s[d][2]);v.multiplyScalar(.1),v.set(v.x+e.x,v.y+e.y,v.z+e.z),e.intersectionShape.line.push(v)}}}}},z=function(e,t,r){var i=new h.Vector3(e.x,e.y,e.z),o=new h.Vector3(t.x,t.y,t.z),n=o.clone(),a=null;n.sub(i);var s,l,c,u,f;return 1===e.bonds.length?1===t.bonds.length?(a=n.clone(),Math.abs(a.x)>1e-4?a.y+=1:a.x+=1):(s=(r+1)%t.bonds.length,l=t.bonds[s],c=d[l],u=new h.Vector3(c.x,c.y,c.z),f=u.clone(),f.sub(i),a=f.clone(),a.cross(n)):(s=(r+1)%e.bonds.length,l=e.bonds[s],c=d[l],u=new h.Vector3(c.x,c.y,c.z),f=u.clone(),f.sub(i),a=f.clone(),a.cross(n)),a.lengthSq()<.01&&(a=n.clone(),Math.abs(a.x)>1e-4?a.y+=1:a.x+=1),a.cross(n),a.normalize(),a},L=function(e,t,r,i,o,n){e[r]=i.x,e[r+1]=i.y,e[r+2]=i.z,t[r]=n.r,t[r+1]=n.g,t[r+2]=n.b,e[r+3]=o.x,e[r+4]=o.y,e[r+5]=o.z,t[r+3]=n.r,t[r+4]=n.g,t[r+5]=n.b},T=function(e,t,i){if(e.style.line){var o=e.style.line;if(!o.hidden){var n=o.linewidth||r;i[n]||(i[n]=new h.Geometry);for(var a=i[n].updateGeoGroup(6*e.bonds.length),s=a.vertexArray,l=a.colorArray,c=0;c<e.bonds.length;c++){var u=e.bonds[c],f=t[u];if(f.style.line&&!(e.serial>=f.serial)){var d=new h.Vector3(e.x,e.y,e.z),p=new h.Vector3(f.x,f.y,f.z),v=d.clone().add(p).multiplyScalar(.5),m=!1;(e.clickable||e.hoverable)&&(void 0===e.intersectionShape&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(d),e.intersectionShape.line.push(p));var g=h.getColorFromStyle(e,e.style.line),y=h.getColorFromStyle(f,f.style.line);if(e.bondStyles&&e.bondStyles[c]){var b=e.bondStyles[c];if(!b.iswire)continue;b.radius&&(bondR=b.radius),b.singleBond&&(m=!0),"undefined"!=typeof b.color1&&(g=h.CC.color(b.color1)),"undefined"!=typeof b.color2&&(y=h.CC.color(b.color2))}var x=3*a.vertices;if(e.bondOrder[c]>1&&e.bondOrder[c]<4&&!m){var w=z(e,f,c),C=p.clone();if(C.sub(d),2==e.bondOrder[c])if(w.multiplyScalar(.1),p1a=d.clone(),p1a.add(w),p1b=d.clone(),p1b.sub(w),p2a=p1a.clone(),p2a.add(C),p2b=p1b.clone(),p2b.add(C),g==y)a.vertices+=4,L(s,l,x,p1a,p2a,g),L(s,l,x+6,p1b,p2b,g);else{a.vertices+=8,C.multiplyScalar(.5);var _=p1a.clone();_.add(C);var A=p1b.clone();A.add(C),L(s,l,x,p1a,_,g),L(s,l,x+6,_,p2a,y),L(s,l,x+12,p1b,A,g),L(s,l,x+18,A,p2b,y)}else if(3==e.bondOrder[c])if(w.multiplyScalar(.1),p1a=d.clone(),p1a.add(w),p1b=d.clone(),p1b.sub(w),p2a=p1a.clone(),p2a.add(C),p2b=p1b.clone(),p2b.add(C),g==y)a.vertices+=6,L(s,l,x,d,p,g),L(s,l,x+6,p1a,p2a,g),L(s,l,x+12,p1b,p2b,g);else{a.vertices+=12,C.multiplyScalar(.5);var _=p1a.clone();_.add(C);var A=p1b.clone();A.add(C),L(s,l,x,d,v,g),L(s,l,x+6,v,p,y),L(s,l,x+12,p1a,_,g),L(s,l,x+18,_,p2a,y),L(s,l,x+24,p1b,A,g),L(s,l,x+30,A,p2b,y)}}else g==y?(a.vertices+=2,L(s,l,x,d,p,g)):(a.vertices+=4,L(s,l,x,d,v,g),L(s,l,x+6,v,p,y))}}}}},F=.25,I=function(e,t){if(e.style.sphere){var r=e.style.sphere;if(!r.hidden){var i=h.getColorFromStyle(e,r),o=M(e,r);if((e.clickable===!0||e.hoverable)&&void 0!==e.intersectionShape){var n=new h.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new h.Sphere(n,o))}h.GLDraw.drawSphere(t,e,o,i)}}},E=function(e,t){if(e.style.sphere){var r=e.style.sphere;if(!r.hidden){var i=M(e,r),o=h.getColorFromStyle(e,r),n=t.updateGeoGroup(1),a=n.vertices,s=3*a,l=n.vertexArray,c=n.colorArray,u=n.radiusArray;l[s]=e.x,l[s+1]=e.y,l[s+2]=e.z;var c=(n.normalArray,n.colorArray);if(c[s]=o.r,c[s+1]=o.g,c[s+2]=o.b,u[a]=i,(e.clickable===!0||e.hoverable)&&void 0!==e.intersectionShape){var f=new h.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new h.Sphere(f,i))}n.vertices+=1}}},O=function(e,t,r,i){for(var o=e.updateGeoGroup(4),n=o.vertices,a=3*n,s=o.vertexArray,l=o.colorArray,c=0;c<4;c++)s[a+3*c]=t.x,s[a+3*c+1]=t.y,s[a+3*c+2]=t.z;for(var u=o.normalArray,l=o.colorArray,c=0;c<4;c++)l[a+3*c]=i.r,l[a+3*c+1]=i.g,l[a+3*c+2]=i.b;u[a+0]=-r,u[a+1]=r,u[a+2]=0,u[a+3]=-r,u[a+4]=-r,u[a+5]=0,u[a+6]=r,u[a+7]=-r,u[a+8]=0,u[a+9]=r,u[a+10]=r,u[a+11]=0,o.vertices+=4;var h=o.faceArray,f=o.faceidx;h[f+0]=n,h[f+1]=n+1,h[f+2]=n+2,h[f+3]=n+2,h[f+4]=n+3,h[f+5]=n,o.faceidx+=6},k=function(e,t){if(e.style.sphere){var r=e.style.sphere;if(!r.hidden){var i=M(e,r),o=h.getColorFromStyle(e,r);if((e.clickable===!0||e.hoverable)&&void 0!==e.intersectionShape){var n=new h.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new h.Sphere(n,i))}O(t,e,i,o)}}},P=function(e,t,r,i,o,n,a){for(var s=e.updateGeoGroup(4),l=s.vertices,c=3*l,u=s.vertexArray,h=s.colorArray,f=s.radiusArray,d=s.normalArray,p=o.r,v=o.g,m=o.b,g=function(e){var t=-e;return 0==t&&(t=-1e-4),t},y=c,b=0;b<4;b++)u[y]=t.x,d[y]=r.x,h[y]=p,y++,u[y]=t.y,d[y]=r.y,h[y]=v,y++,u[y]=t.z,d[y]=r.z,b<2?h[y]=m:h[y]=g(m),y++;s.vertices+=4,f[l]=-i,f[l+1]=i,f[l+2]=-i,f[l+3]=i;var x=s.faceArray,w=s.faceidx;x[w+0]=l,x[w+1]=l+1,x[w+2]=l+2,x[w+3]=l+2,x[w+4]=l+3,x[w+5]=l,s.faceidx+=6},V=function(e,t,r){if(e.style.stick){var i=e.style.stick;if(!i.hidden){var o,n,a=i.radius||F,s=a,l=i.singleBonds||!1,c=0,u=0,f=h.getColorFromStyle(e,i);!e.capDrawn&&e.bonds.length<4&&(c=2);var d=h.GLDraw.drawCylinder;r.imposter&&(d=P);for(var p=0;p<e.bonds.length;p++){var v=e.bonds[p],m=t[v];if(e.serial<m.serial){var g=m.style;if(!g.stick)continue;var y=h.getColorFromStyle(m,g.stick);s=a;var b=l;if(e.bondStyles&&e.bondStyles[p]){var x=e.bondStyles[p];if(x.iswire)continue;x.radius&&(s=x.radius),x.singleBond&&(b=!0),"undefined"!=typeof x.color1&&(f=h.CC.color(x.color1)),"undefined"!=typeof x.color2&&(y=h.CC.color(x.color2))}var w=new h.Vector3(e.x,e.y,e.z),C=new h.Vector3(m.x,m.y,m.z);if(1===e.bondOrder[p]||b){if(!m.capDrawn&&m.bonds.length<4&&(u=2),f!=y?(o=(new h.Vector3).addVectors(w,C).multiplyScalar(.5),d(r,w,o,s,f,c,0),d(r,o,C,s,y,0,u)):d(r,w,C,s,f,c,u),e.clickable||m.clickable){if(o=(new h.Vector3).addVectors(w,C).multiplyScalar(.5),e.clickable||e.hoverable){var _=new h.Cylinder(w,o,s),A=new h.Sphere(w,s);e.intersectionShape.cylinder.push(_),e.intersectionShape.sphere.push(A)}if(m.clickable||m.hoverable){var M=new h.Cylinder(C,o,s),S=new h.Sphere(C,s);m.intersectionShape.cylinder.push(M),m.intersectionShape.sphere.push(S)}}}else if(e.bondOrder[p]>1){var L=0,T=0;s!=a&&(L=2,T=2);var I=C.clone(),E=null;I.sub(w);var k,V,R,D,N,E=z(e,m,p);if(2==e.bondOrder[p]){var k=s/2.5,E=z(e,m,p);if(E.multiplyScalar(1.5*k),V=w.clone(),V.add(E),R=w.clone(),R.sub(E),D=V.clone(),D.add(I),N=R.clone(),N.add(I),f!=y?(o=(new h.Vector3).addVectors(V,D).multiplyScalar(.5),n=(new h.Vector3).addVectors(R,N).multiplyScalar(.5),d(r,V,o,k,f,L,0),d(r,o,D,k,y,0,T),d(r,R,n,k,f,L,0),d(r,n,N,k,y,0,T)):(d(r,V,D,k,f,L,T),d(r,R,N,k,f,L,T)),e.clickable||m.clickable){if(o=(new h.Vector3).addVectors(V,D).multiplyScalar(.5),n=(new h.Vector3).addVectors(R,N).multiplyScalar(.5),e.clickable||e.hoverable){var U=new h.Cylinder(V,o,k),B=new h.Cylinder(R,n,k);e.intersectionShape.cylinder.push(U),e.intersectionShape.cylinder.push(B)}if(m.clickable||m.hoverable){var j=new h.Cylinder(D,o,k),G=new h.Cylinder(N,n,k);m.intersectionShape.cylinder.push(j),m.intersectionShape.cylinder.push(G)}}}else if(3==e.bondOrder[p]&&(k=s/4,E.cross(I),E.normalize(),E.multiplyScalar(3*k),V=w.clone(),V.add(E),R=w.clone(),R.sub(E),D=V.clone(),D.add(I),N=R.clone(),N.add(I),f!=y?(o=(new h.Vector3).addVectors(V,D).multiplyScalar(.5),n=(new h.Vector3).addVectors(R,N).multiplyScalar(.5),mp3=(new h.Vector3).addVectors(w,C).multiplyScalar(.5),d(r,V,o,k,f,L,0),d(r,o,D,k,y,0,T),d(r,w,mp3,k,f,c,0),d(r,mp3,C,k,y,0,u),d(r,R,n,k,f,L,0),d(r,n,N,k,y,0,T)):(d(r,V,D,k,f,L,T),d(r,w,C,k,f,c,u),d(r,R,N,k,f,L,T)),e.clickable||m.clickable)){if(o=(new h.Vector3).addVectors(V,D).multiplyScalar(.5),n=(new h.Vector3).addVectors(R,N).multiplyScalar(.5),mp3=(new h.Vector3).addVectors(w,C).multiplyScalar(.5),e.clickable||e.hoverable){var U=new h.Cylinder(V.clone(),o.clone(),k),B=new h.Cylinder(R.clone(),n.clone(),k),H=new h.Cylinder(w.clone(),mp3.clone(),k);e.intersectionShape.cylinder.push(U),e.intersectionShape.cylinder.push(B),e.intersectionShape.cylinder.push(H)}if(m.clickable||m.hoverable){var j=new h.Cylinder(D.clone(),o.clone(),k),G=new h.Cylinder(N.clone(),n.clone(),k),W=new h.Cylinder(C.clone(),mp3.clone(),k);m.intersectionShape.cylinder.push(j),m.intersectionShape.cylinder.push(G),m.intersectionShape.cylinder.push(W)}}}}}for(var q=!1,Y=0,Z=!1,p=0;p<e.bonds.length;p++){var b=l;if(e.bondStyles&&e.bondStyles[p]){var x=e.bondStyles[p];x.singleBond&&(b=!0),x.radius&&x.radius!=a&&(Z=!0)}(b||1==e.bondOrder[p])&&Y++}if(Z?Y>0&&(q=!0):0==Y&&e.bonds.length>0&&(q=!0),q){e.style;s=a,r.imposter?O(r.sphereGeometry,e,s,f):h.GLDraw.drawSphere(r,e,s,f)}}}},R=function(e,t){t=t||{};var r=new h.Object3D,i=[],o={},n={},a=I,s=null,l=null;t.supportsImposters?(a=k,s=new h.Geometry((!0)),s.imposter=!0,l=new h.Geometry((!0),(!0)),l.imposter=!0,l.sphereGeometry=s,l.drawnCaps={}):t.supportsAIA?(a=E,s=new h.Geometry((!1),(!0),(!0)),s.instanced=!0,l=new h.Geometry((!0))):(s=new h.Geometry((!0)),l=new h.Geometry((!0)));var c,u,d,p,v={},m=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(c=0,d=e.length;c<d;c++){var g=e[c];if(g&&g.style){(g.clickable||g.hoverable)&&void 0===g.intersectionShape&&(g.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),p={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(u in p)g.style[u]?g.style[u].opacity?p[u]=parseFloat(g.style[u].opacity):p[u]=1:p[u]=void 0,v[u]?void 0!=p[u]&&v[u]!=p[u]&&(console.log("Warning: "+u+" opacity is ambiguous"),v[u]=1):v[u]=p[u];a(g,s),S(g,n),T(g,e,o),V(g,e,l),"undefined"==typeof g.style.cartoon||g.style.cartoon.hidden||("spectrum"!==g.style.cartoon.color||"number"!=typeof g.resi||g.hetflag||(g.resi<m[0]&&(m[0]=g.resi),g.resi>m[1]&&(m[1]=g.resi)),i.push(g))}}if(i.length>0){var y=null;m[0]<m[1]&&(y=new h.Gradient.Sinebow(m[0],m[1])),h.drawCartoon(r,i,y)}if(s&&s.vertices>0){s.initTypedArrays();var b=null;if(s.imposter)b=new h.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});else if(s.instanced){var w=new h.Geometry((!0));h.GLDraw.drawSphere(w,{x:0,y:0,z:0},1,new h.Color(.5,.5,.5)),w.initTypedArrays(),b=new h.InstancedMaterial({sphereMaterial:new h.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:w})}else var b=new h.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0});v.sphere<1&&v.sphere>=0&&(b.transparent=!0,b.opacity=v.sphere);var w=new h.Mesh(s,b);r.add(w)}if(l.vertices>0)if(l.imposter){var C=new h.StickImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});l.initTypedArrays();var _=new h.Mesh(l,C);r.add(_)}else{var A=new h.MeshLambertMaterial({vertexColors:!0,ambient:0,reflectivity:0});v.stick<1&&v.stick>=0&&(A.transparent=!0,A.opacity=v.stick),l.initTypedArrays(),A.wireframe&&l.setUpWireframe();var _=new h.Mesh(l,A);r.add(_)}for(c in o)if(o.hasOwnProperty(c)){var M=c,z=new h.LineBasicMaterial({linewidth:M,vertexColors:!0});v.line<1&&v.line>=0&&(z.transparent=!0,z.opacity=v.line),o[c].initTypedArrays();var L=new h.Line(o[c],z,h.LinePieces);r.add(L)}for(c in n)if(n.hasOwnProperty(c)){var M=c,F=new h.LineBasicMaterial({linewidth:M,vertexColors:!0});v.cross<1&&v.cross>=0&&(F.transparent=!0,F.opacity=v.cross),n[c].initTypedArrays();var O=new h.Line(n[c],F,h.LinePieces);r.add(O)}if(f&&x.symmetries&&x.symmetries.length>0){var P,R=new h.Object3D;for(P=0;P<x.symmetries.length;P++){var D=new h.Object3D;D=r.clone(),D.matrix.copy(x.symmetries[P]),D.matrixAutoUpdate=!1,R.add(D)}return R}return r};this.getCrystData=function(){return x.cryst?x.cryst:null},this.getSymmetries=function(){return"undefined"==typeof x.symmetries&&(x.symmetries=[w]),x.symmetries},this.setSymmetries=function(e){"undefined"==typeof e?x.symmetries=[w]:x.symmetries=e},this.getID=function(){return v},this.getFrames=function(){return p},this.forceRedraw=function(){g=null},this.setFrame=function(e){0!=p.length&&(d=e>=0&&e<p.length?p[e]:p[p.length-1],g=null)},this.addFrame=function(e){p.push(e)},this.vibrate=function(e,t){for(var r=[],t=t||1,e=e||10,i=0;i<d.length;i++){var o=new h.Vector3(d[i].dx,d[i].dy,d[i].dz);r.push(o)}e--;for(var i=1;i<=e;i++){for(var n=[],a=0;a<d.length;a++){var s=new h.Vector3(d[a].dx,d[a].dy,d[a].dz),l=new h.Vector3(d[a].x,d[a].y,d[a].z);s.sub(l),s.multiplyScalar(i*t/e),l.add(s);var c={};for(var u in d[a])c[u]=d[a][u];c.x=l.x,c.y=l.y,c.z=l.z,n.push(c)}p.push(n)}p.unshift(d)},this.setAtomDefaults=function(e){for(var r=0;r<e.length;r++){var i=e[r];i&&(i.style=i.style||t,i.color=i.color||_[i.elem]||C,i.model=v,(i.clickable||i.hoverable)&&(i.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},this.addMolData=function(e,t,r){r=r||{};var i=h.GLModel.parseMolData(e,t,r);f=!r.duplicateAssemblyAtoms;var o=i.modelData;if(o&&(x=Array.isArray(o)?o[0]:o),0==p.length){for(var n=0;n<i.length;n++)0!=i[n].length&&p.push(i[n]);p[0]&&(d=p[0])}else if(r.frames)for(var n=0;n<i.length;n++)p.push(i[n]);else for(var n=0;n<i.length;n++)this.addAtoms(i[n]);for(var n=0;n<p.length;n++)this.setAtomDefaults(p[n],v);r.vibrate&&r.vibrate.frames&&r.vibrate.amplitude&&this.vibrate(r.vibrate.frames,r.vibrate.amplitude)},this.setDontDuplicateAtoms=function(e){f=e},this.setModelData=function(e){x=e},this.atomIsSelected=function(e,t){if("undefined"==typeof t)return!0;var r=!!t.invert,i=!0;for(var o in t)if("predicate"===o){if(!t.predicate(e)){i=!1;break}}else if("properties"==o&&e[o])for(var n in t.properties){if("undefined"==typeof e.properties[n]){i=!1;break}if(e.properties[n]!=t.properties[n]){i=!1;break}}else if(t.hasOwnProperty(o)&&"props"!=o&&"invert"!=o&&"model"!=o&&"byres"!=o&&"expand"!=o&&"within"!=o){if("undefined"==typeof e[o]){i=!1;break}var a=!1;if("bonds"===o){var s=t[o];if(s!=e.bonds.length){i=!1;break}}else if($.isArray(t[o])){for(var l=t[o],c=0;c<l.length;c++)if(e[o]==l[c]){a=!0;break}if(!a){i=!1;break}}else{var s=t[o];if(e[o]!=s){i=!1;break}}}return r?!i:i},this.selectedAtoms=function(e,t){var r=[];e=e||{},t||(t=d);for(var i=t.length,o=0;o<i;o++){var n=t[o];n&&this.atomIsSelected(n,e)&&r.push(n)}if(e.hasOwnProperty("expand"))for(var a=N(r,parseFloat(e.expand)),s=r.length,o=0;o<a.length;o++)for(var l=0;l<s;l++){var c=D(a[o],r[l]),u=Math.pow(e.expand,2);c<u&&c>0&&r.push(a[o])}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){for(var h=this.selectedAtoms(e.within.sel,d),f=[],o=0;o<h.length;o++)for(var l=0;l<r.length;l++){var c=D(h[o],r[l]),u=Math.pow(parseFloat(e.within.distance),2);c<u&&c>0&&f.push(r[l])}r=f}if(e.hasOwnProperty("byres"))for(var p={},v=[],m=[],o=0;o<r.length;o++){var n=r[o],g=n.chain,y=n.resi;if(void 0===p[g]&&(p[g]={}),n.hasOwnProperty("resi")&&void 0===p[g][y])for(p[g][y]=!0,m.push(n);m.length>0;)if(n=m.pop(),g=n.chain,y=n.resi,void 0===v[n.index]){v[n.index]=!0;for(var l=0;l<n.bonds.length;l++){var b=d[n.bonds[l]];void 0===v[b.index]&&b.hasOwnProperty("resi")&&b.chain==g&&b.resi==y&&(m.push(b),r.push(b))}}}return r};var D=function(e,t){var r=t.x-e.x,i=t.y-e.y,o=t.z-e.z;return Math.pow(r,2)+Math.pow(i,2)+Math.pow(o,2)},N=function(e,t){if(t<=0)return e;for(var r=h.getExtent(e),i=[[],[],[]],o=0;o<3;o++)i[0][o]=r[0][o]-t,i[1][o]=r[1][o]+t,i[2][o]=r[2][o];for(var n=[],o=0;o<d.length;o++){var a=d[o].x,s=d[o].y,l=d[o].z;a>=i[0][0]&&a<=i[1][0]&&s>=i[0][1]&&s<=i[1][1]&&l>=i[0][2]&&l<=i[1][2]&&(a>=r[0][0]&&a<=r[1][0]&&s>=r[0][1]&&s<=r[1][1]&&l>=r[0][2]&&l<=r[1][2]||n.push(d[o]))}return n};this.addAtoms=function(e){g=null;var r,i=d.length,o=[];for(r=0;r<e.length;r++)"undefined"==typeof e[r].index&&(e[r].index=r),"undefined"==typeof e[r].serial&&(e[r].serial=r),o[e[r].index]=i+r;for(r=0;r<e.length;r++){var n=e[r],a=o[n.index],s=$.extend(!1,{},n);s.index=a,s.bonds=[],s.bondOrder=[],s.model=v,s.style=s.style||t,"undefined"==typeof s.color&&(s.color=_[s.elem]||C);for(var l=n.bonds?n.bonds.length:0,c=0;c<l;c++){var u=o[n.bonds[c]];"undefined"!=typeof u&&(s.bonds.push(u),s.bondOrder.push(n.bondOrder?n.bondOrder[c]:1))}d.push(s)}},this.removeAtoms=function(e){g=null;var t,r=[];for(t=0;t<e.length;t++)r[e[t].index]=!0;var i=[];for(t=0;t<d.length;t++){var o=d[t];r[o.index]||i.push(o)}d=[],this.addAtoms(i)},this.setStyle=function(e,t,r){"undefined"==typeof t&&"undefined"==typeof r&&(t=e,e={});var i;for(i in e)s.indexOf(i)===-1&&console.log("Unknown selector "+i);for(i in t)l.indexOf(i)===-1&&console.log("Unknown style "+i);var o=!1,n=function(n){for(var s=a.selectedAtoms(e,n),l=0;l<n.length;l++)n[l]&&(n[l].capDrawn=!1);for(var l=0;l<s.length;l++){o=!0,(s[l].clickable||s[l].hoverable)&&(s[l].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),r||(s[l].style={});for(i in t)if(t.hasOwnProperty(i)){s[l].style[i]=s[l].style[i]||{};for(var c in t[i])s[l].style[i][c]=t[i][c]}}},a=this;n(d);for(var c=0;c<p.length;c++)n(p[c]);o&&(g=null)},this.setClickable=function(e,t,r){var i;for(i in e)s.indexOf(i)===-1&&console.log("Unknown selector "+i);if(t=!!t,r&&"function"!=typeof r)return void console.log("Callback is not a function");var o,n=this.selectedAtoms(e,d),a=n.length;for(o=0;o<a;o++)n[o].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},n[o].clickable=t,r&&(n[o].callback=r);a>0&&(g=null)},this.setHoverable=function(e,t,r,i){var o;for(o in e)s.indexOf(o)===-1&&console.log("Unknown selector "+o);if(t=!!t,r&&"function"!=typeof r)return void console.log("Hover_callback is not a function");if(i&&"function"!=typeof i)return void console.log("Unhover_callback is not a function");var n,a=this.selectedAtoms(e,d),l=a.length;for(n=0;n<l;n++)a[n].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},a[n].hoverable=t,r&&(a[n].hover_callback=r),i&&(a[n].unhover_callback=i);l>0&&(g=null)},this.setColorByElement=function(e,t){if(null===g||!c(t,b)){b=t;var r=this.selectedAtoms(e,r);r.length>0&&(g=null);for(var i=0;i<r.length;i++){var o=r[i];"undefined"!=typeof t[o.elem]&&(o.color=t[o.elem])}}},this.setColorByProperty=function(e,t,r,i){var o=this.selectedAtoms(e,o);b=null,o.length>0&&(g=null);var n,a;Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY;for(i||(i=r.range()),i||(i=h.getPropertyRange(o,t)),n=0;n<o.length;n++){a=o[n];var s=h.getAtomProperty(a,t);null!=s&&(a.color=r.valueToHex(parseFloat(a.properties[t]),[i[0],i[1]]))}},this.setColorByFunction=function(e,t){var r=this.selectedAtoms(e,r);for(b=null,r.length>0&&(g=null),i=0;i<r.length;i++)a=r[i],a.color=t(a)},this.toCDObject=function(e){var t={a:[],b:[]};e&&(t.s=[]);for(var r=0;r<d.length;r++){var i={},o=d[r];if(i.x=o.x,i.y=o.y,i.z=o.z,"C"!=o.elem&&(i.l=o.elem),e){for(var n=0;n<t.s.length&&JSON.stringify(o.style)!==JSON.stringify(t.s[n]);)n++;n===t.s.length&&t.s.push(o.style),0!==n&&(i.s=n)}t.a.push(i);for(var a=0;a<o.bonds.length;a++){var s=r,l=o.bonds[a];if(!(s>=l)){var c={b:s,e:l},u=o.bondOrder[a];1!=u&&(c.o=u),t.b.push(c)}}}return t},this.globj=function(e,t){new Date;if(null===g){g=R(d,t);new Date;y&&(e.remove(y),y=null),y=g.clone(),m&&(y.setVisible(!1),g.setVisible(!1)),e.add(y)}},this.removegl=function(e){y&&(void 0!==y.geometry&&y.geometry.dispose(),void 0!==y.material&&y.material.dispose(),e.remove(y),y=null),g=null},this.hide=function(){m=!0,y&&y.setVisible(!1),g&&g.setVisible(!1)},this.show=function(){m=!1,y&&y.setVisible(!0),g&&g.setVisible(!0)},this.addResLabels=function(e,t,r){for(var i=this.selectedAtoms(e,i),o={},n=0;n<i.length;n++){var a=i[n],s=a.chain,l=a.resn,c=a.resi,u=l+""+c;o[s]||(o[s]={}),o[s][u]||(o[s][u]=[]),o[s][u].push(a)}var f=$.extend(!0,{},r);for(var s in o)if(o.hasOwnProperty(s)){var d=o[s];for(var u in d)if(d.hasOwnProperty(u)){for(var i=d[u],p=new h.Vector3(0,0,0),n=0;n<i.length;n++){var a=i[n];p.x+=a.x,p.y+=a.y,p.z+=a.z}p.divideScalar(i.length),f.position=p,t.addLabel(u,f)}}},this.setCoordinates=function(t,r){if(r=r||"",!t)return[];if(/\.gz$/.test(r)){r=r.replace(/\.gz$/,"");try{t=pako.inflate(t,{to:"string"})}catch(o){console.log(o)}}if("mdcrd"==r||"inpcrd"==r){p=[];for(var n=d.length,a=e.parseCrd(t,r),s=0;s<a.length;){var l=JSON.parse(JSON.stringify(d));for(i=0;i<n;i++)l[i].x=a[s++],l[i].y=a[s++],l[i].z=a[s++];p.push(l)}return d=p[0],p}return[]}}var t={line:{}},r=1,o={H:1.2,Li:1.82,LI:1.82,Na:2.27,NA:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,Cl:1.75,BR:1.85,Br:1.85,SE:1.9,Se:1.9,ZN:1.39,Zn:1.39,CU:1.4,Cu:1.4,NI:1.63,Ni:1.63},n=["resn","x","y","z","color","surfaceColor","elem","hetflag","chain","resi","icode","rescode","serial","atom","bonds","ss","singleBonds","bondOrder","properties","b","pdbline","clickable","callback","invert"],s=n.concat(["model","bonds","predicate","invert","byres","expand","within"]),l=["line","cross","stick","sphere","cartoon"],c=function(e,t){return e&&t?JSON.stringify(e)==JSON.stringify(t):e==t};return e.parseCrd=function(e,t){var r=[],i=8,o=e.indexOf("\n");e=e.slice(o+1),"inpcrd"==t&&(o=e.indexOf("\n"),e=e.slice(o+1),i=12),o=0;for(var n=0;o<e.length-i;)"\n"==e[o]&&o++,"\n"!=e[o]&&(r[n]=parseFloat(e.slice(o,o+i)),o+=i,n++);return r},e.parseMolData=function(e,t,r){if(t=t||"",!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=pako.inflate(e,{to:"string"})}catch(i){console.log(i)}}"undefined"==typeof h.Parsers[t]&&(t=t.split(".").pop(),"undefined"==typeof h.Parsers[t]&&(console.log("Unknown format: "+t),t=e.match(/^@<TRIPOS>MOLECULE/gm)?"mol2":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?"pdb":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?"sdf":e.match(/^%VERSION\s+\VERSION_STAMP/gm)?"prmtop":"xyz",console.log("Best guess: "+t)));var o=h.Parsers[t],n=o(e,r);return n},e.setAtomDefaults=function(e,r){for(var i=0;i<e.length;i++){var o=e[i];o&&(o.style=o.style||t,o.color=o.color||ElementColors[o.elem]||defaultColor,o.model=r,(o.clickable||o.hoverable)&&(o.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},e}(),h.GLShape=function(){function e(e){e=e||{},h.ShapeIDCount++,this.boundingSphere=new h.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},l(this,e);var n=[],c=null,u=null,f=new h.Geometry((!0)),d=new h.Geometry((!0));this.updateStyle=function(t){for(var r in t)e[r]=t[r];l(this,e)},this.addCustom=function(e){e.vertexArr=e.vertexArr||[],e.faceArr=e.faceArr||[],e.normalArr=e.normalArr||[];f.geometryGroups.length;a(this,f,e)},this.addSphere=function(e){e.center=e.center||{x:0,y:0,z:0},e.radius=e.radius?h.Math.clamp(e.radius,0,1/0):1.5,e.color=h.CC.color(e.color),this.intersectionShape.sphere.push(new h.Sphere(e.center,e.radius)),h.GLDraw.drawSphere(f,e.center,e.radius,e.color),n.push({centroid:new h.Vector3(e.center.x,e.center.y,e.center.z)});var t=f.updateGeoGroup(0);s(this.boundingSphere,n,t.vertexArray)},this.addCylinder=function(e){e.start=e.start||{},e.end=e.end||{};var t=new h.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),r=new h.Vector3(e.end.x,e.end.y||0,e.end.z||0);"undefined"==typeof r.x&&(r.x=3);var i=e.radius||.1,o=h.CC.color(e.color);this.intersectionShape.cylinder.push(new h.Cylinder(t,r,i)),h.GLDraw.drawCylinder(f,t,r,i,o,e.fromCap,e.toCap);var a=new h.Vector3;n.push({centroid:a.addVectors(t,r).multiplyScalar(.5)});var l=f.updateGeoGroup(0);s(this.boundingSphere,n,l.vertexArray)},this.addLine=function(e){e.start=e.start||{},e.end=e.end||{};var t=new h.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),r=new h.Vector3(e.end.x,e.end.y||0,e.end.z||0);"undefined"==typeof r.x&&(r.x=3);var i=f.updateGeoGroup(2),o=i.vertices,n=3*o,a=i.vertexArray;a[n]=t.x,a[n+1]=t.y,a[n+2]=t.z,a[n+3]=r.x,a[n+4]=r.y,a[n+5]=r.z,i.vertices+=2;var s=i.lineArray,l=i.lineidx;s[l]=o,s[l+1]=o+1,i.lineidx+=2},this.addArrow=function(e){if(e.start=e.start||{},e.end=e.end||{},e.start=new h.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),e.dir instanceof h.Vector3&&e.length instanceof number){var t=e.dir.clone().multiplyScalar(e.length).add(start);e.end=t}else e.end=new h.Vector3(e.end.x,e.end.y||0,e.end.z||0),"undefined"==typeof e.end.x&&(e.end.x=3);e.radius=e.radius||.1,e.radiusRatio=e.radiusRatio||1.618034,e.mid=0<e.mid&&e.mid<1?e.mid:.618034,o(this,f,e);var r=new h.Vector3;n.push({centroid:r.addVectors(e.start,e.end).multiplyScalar(.5)});var i=f.updateGeoGroup(0);s(this.boundingSphere,n,i.vertexArray)},this.addIsosurface=function(e,r){var i,o,n=void 0!==r.isoval&&"number"==typeof r.isoval?r.isoval:0,s=!!r.voxel,l=void 0===r.smoothness?1:r.smoothness,c=e.size.x,u=e.size.y,d=e.size.z,v=new Int16Array(c*u*d),g=e.data;for(i=0,o=v.length;i<o;++i)v[i]=-1;var y=new Uint8Array(c*u*d);for(i=0,o=g.length;i<o;++i){var b=n>=0?g[i]-n:n-g[i];b>0&&(y[i]|=t)}if(void 0!==r.selectedRegion)for(var i=0;i<c;i++)for(var x=0;x<u;x++)for(var w=0;w<d;w++){var C=m(i,x,w,e);if(!p(C,r.selectedRegion,r.selectedOffset,r.radius)){var _=(i*u+x)*d+w;y[_]=0}}var A=[],M=[];h.MarchingCube.march(y,A,M,{fulltable:!0,voxel:s,unitCube:e.unit,origin:e.origin,matrix:e.matrix,nX:c,nY:u,nZ:d}),!s&&l>0&&h.MarchingCube.laplacianSmooth(l,A,M),a(this,f,{vertexArr:A,faceArr:M,normalArr:[],clickable:r.clickable,hoverable:r.hoverable}),this.updateStyle(r);for(var S=new h.Vector3(e.origin.x,e.origin.y,e.origin.z),z=new h.Vector3(e.size.x*e.unit.x,e.size.y*e.unit.y,e.size.z*e.unit.z),L=new h.Vector3(0,0,0),T=S.clone(),F=S.clone().add(z),i=0;i<A.length;i++)L.add(A[i]),T.max(A[i]),F.min(A[i]);L.divideScalar(A.length);var I=L.distanceTo(F),E=L.distanceTo(T);this.boundingSphere.center=L,this.boundingSphere.radius=Math.max(I,E)};var p=function(e,t,r,i){for(var o=0;o<t.length;o++)if(v(t[o],e)<=i)return!0;return!1},v=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},m=function(e,t,r,i){var o;return i.matrix?(o=new h.Vector3(e,t,r),
o=o.applyMatrix4(i.matrix),o={x:o.x,y:o.y,z:o.z}):(o.x=i.origin.x+i.unit.x*e,o.y=i.origin.y+i.unit.y*t,o.z=i.origin.z+i.unit.z*r),o};this.addVolumetricData=function(e,t,r){var e=new h.VolumeData(e,t);this.addIsosurface(e,r)},this.globj=function(e){if(u&&(e.remove(u),u=null),!this.hidden){r(f),f.initTypedArrays(),"undefined"!=typeof this.color&&i(f,this.color),c=new h.Object3D;var t=null;if(this.side==h.DoubleSide)var t=new h.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth});else var t=new h.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth});var o=new h.Mesh(f,t);c.add(o);var n=new h.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),a=new h.Line(d,n,h.LinePieces);c.add(a),u=c.clone(),e.add(u)}},this.removegl=function(e){u&&(void 0!==u.geometry&&u.geometry.dispose(),void 0!==u.material&&u.material.dispose(),e.remove(u),u=null),c=null}}var t=2,r=function(e){var t=e.updateGeoGroup(0);t.vertices>0&&t.truncateArrayBuffers(!0,!0)},i=function(e,t){t||h.CC.color(t);e.colorsNeedUpdate=!0;var r,i,o;t.constructor!==Array&&(r=t.r,i=t.g,o=t.b);for(var n in e.geometryGroups)for(var a=e.geometryGroups[n],s=a.colorArray,l=0,c=a.vertices;l<c;++l){if(t.constructor===Array){var u=t[l];r=u.r,i=u.g,o=u.b}s[3*l]=r,s[3*l+1]=i,s[3*l+2]=o}},o=function(e,t,r){var i=r.start,o=r.end,n=r.radius,a=r.radiusRatio,s=r.mid;if(i&&o){var l=t.updateGeoGroup(51),c=o.clone();c.sub(i).multiplyScalar(s);var u=i.clone().add(c),f=c.clone().negate();e.intersectionShape.cylinder.push(new h.Cylinder(i.clone(),u.clone(),n)),e.intersectionShape.sphere.push(new h.Sphere(i.clone(),n));var d=[];d[0]=c.clone(),Math.abs(d[0].x)>1e-4?d[0].y+=1:d[0].x+=1,d[0].cross(c),d[0].normalize(),d[0]=d[0],d[4]=d[0].clone(),d[4].crossVectors(d[0],c),d[4].normalize(),d[8]=d[0].clone().negate(),d[12]=d[4].clone().negate(),d[2]=d[0].clone().add(d[4]).normalize(),d[6]=d[4].clone().add(d[8]).normalize(),d[10]=d[8].clone().add(d[12]).normalize(),d[14]=d[12].clone().add(d[0]).normalize(),d[1]=d[0].clone().add(d[2]).normalize(),d[3]=d[2].clone().add(d[4]).normalize(),d[5]=d[4].clone().add(d[6]).normalize(),d[7]=d[6].clone().add(d[8]).normalize(),d[9]=d[8].clone().add(d[10]).normalize(),d[11]=d[10].clone().add(d[12]).normalize(),d[13]=d[12].clone().add(d[14]).normalize(),d[15]=d[14].clone().add(d[0]).normalize();var p,v,m,g=l.vertices,y=l.vertexArray,b=(l.colorArray,l.faceArray),x=l.normalArray,w=l.lineArray;for(v=0,m=d.length;v<m;++v){p=3*(g+3*v);var C=d[v].clone().multiplyScalar(n).add(i),_=d[v].clone().multiplyScalar(n).add(u),A=d[v].clone().multiplyScalar(n*a).add(u);if(y[p]=C.x,y[p+1]=C.y,y[p+2]=C.z,y[p+3]=_.x,y[p+4]=_.y,y[p+5]=_.z,y[p+6]=A.x,y[p+7]=A.y,y[p+8]=A.z,v>0){var M=y[p-3],S=y[p-2],z=y[p-1],L=new h.Vector3(M,S,z),T=o.clone(),F=u.clone(),I=new h.Vector3(A.x,A.y,A.z);e.intersectionShape.triangle.push(new h.Triangle(I,T,L)),e.intersectionShape.triangle.push(new h.Triangle(L.clone(),F,I.clone()))}}l.vertices+=48,p=3*l.vertices,y[p]=i.x,y[p+1]=i.y,y[p+2]=i.z,y[p+3]=u.x,y[p+4]=u.y,y[p+5]=u.z,y[p+6]=o.x,y[p+7]=o.y,y[p+8]=o.z,l.vertices+=3;var E,O,k,P,V,R,D,N,U,B,j,G,H,W,q,Y,Z,$,X,Q,K=l.vertices-3,J=l.vertices-2,ee=l.vertices-1,te=3*K,re=3*J,ie=3*ee;for(v=0,m=d.length-1;v<m;++v){var oe=g+3*v;p=3*oe,k=l.faceidx,P=l.lineidx,V=oe,j=3*V,R=oe+1,G=3*R,D=oe+2,H=3*D,N=oe+4,W=3*N,U=oe+5,q=3*U,B=oe+3,Y=3*B,O=[d[v],d[v],d[v+1],d[v+1]],Z=$=d[v],X=Q=d[v+1],x[j]=Z.x,x[G]=$.x,x[Y]=Q.x,x[j+1]=Z.y,x[G+1]=$.y,x[Y+1]=Q.y,x[j+2]=Z.z,x[G+2]=$.z,x[Y+2]=Q.z,x[G]=$.x,x[W]=X.x,x[Y]=Q.x,x[G+1]=$.y,x[W+1]=X.y,x[Y+1]=Q.y,x[G+2]=$.z,x[W+2]=X.z,x[Y+2]=Q.z,x[H]=$.x,x[q]=X.x,x[H+1]=$.y,x[q+1]=X.y,x[H+2]=$.z,x[q+2]=X.z,b[k]=V,b[k+1]=R,b[k+2]=B,b[k+3]=R,b[k+4]=N,b[k+5]=B,b[k+6]=V,b[k+7]=B,b[k+8]=K,b[k+9]=D,b[k+10]=J,b[k+11]=U,b[k+12]=D,b[k+13]=ee,b[k+14]=U,w[P]=V,w[P+1]=R,w[P+2]=V,w[P+3]=B,w[P+4]=N,w[P+5]=B,w[P+6]=V,w[P+7]=B,w[P+8]=D,w[P+9]=R,w[P+10]=D,w[P+11]=U,w[P+12]=N,w[P+13]=U,w[P+14]=D,w[P+15]=ee,w[P+16]=D,w[P+17]=U,w[P+18]=ee,w[P+19]=U,l.faceidx+=15,l.lineidx+=20}E=[g+45,g+46,g+1,g,g+47,g+2],O=[d[15],d[15],d[0],d[0]],k=l.faceidx,P=l.lineidx,V=E[0],j=3*V,R=E[1],G=3*R,D=E[4],H=3*D,N=E[2],W=3*N,U=E[5],q=3*U,B=E[3],Y=3*B,Z=$=d[15],X=Q=d[0],x[j]=Z.x,x[G]=$.x,x[Y]=Q.x,x[j+1]=Z.y,x[G+1]=$.y,x[Y+1]=Q.y,x[j+2]=Z.z,x[G+2]=$.z,x[Y+2]=Q.z,x[G]=$.x,x[W]=X.x,x[Y]=Q.x,x[G+1]=$.y,x[W+1]=X.y,x[Y+1]=Q.y,x[G+2]=$.z,x[W+2]=X.z,x[Y+2]=Q.z,x[H]=$.x,x[q]=X.x,x[H+1]=$.y,x[q+1]=X.y,x[H+2]=$.z,x[q+2]=X.z,c.normalize(),f.normalize(),x[te]=f.x,x[re]=x[ie]=c.x,x[te+1]=f.y,x[re+1]=x[ie+1]=c.y,x[te+2]=f.z,x[re+2]=x[ie+2]=c.z,b[k]=V,b[k+1]=R,b[k+2]=B,b[k+3]=R,b[k+4]=N,b[k+5]=B,b[k+6]=V,b[k+7]=B,b[k+8]=K,b[k+9]=D,b[k+10]=J,b[k+11]=U,b[k+12]=D,b[k+13]=ee,b[k+14]=U,w[P]=V,w[P+1]=R,w[P+2]=V,w[P+3]=B,w[P+4]=N,w[P+5]=B,w[P+6]=V,w[P+7]=B,w[P+8]=D,w[P+9]=R,w[P+10]=D,w[P+11]=U,w[P+12]=N,w[P+13]=U,w[P+14]=D,w[P+15]=ee,w[P+16]=D,w[P+17]=U,w[P+18]=ee,w[P+19]=U,l.faceidx+=15,l.lineidx+=20}},n=function(e,t,r,i,o){var n=t.addGeoGroup(),a=r.vertexArr,l=r.normalArr,c=r.faceArr;n.vertices=a.length,n.faceidx=c.length;var u,f,d,p,v,m,g,y=n.vertexArray,b=n.colorArray;if(i.constructor!==Array)var x=i.r,w=i.g,p=i.b;for(m=0,g=n.vertices;m<g;++m){if(u=3*m,f=a[m],y[u]=f.x,y[u+1]=f.y,y[u+2]=f.z,i.constructor===Array)var v=i[m],x=v.r,w=v.g,p=v.b;b[u]=x,b[u+1]=w,b[u+2]=p}if(o)for(m=0,g=n.faceidx/3;m<g;++m){u=3*m,d=c[u],p=c[u+1],v=c[u+2];var C=new h.Vector3,_=new h.Vector3,A=new h.Vector3;e.intersectionShape.triangle.push(new h.Triangle(C.copy(a[d]),_.copy(a[p]),A.copy(a[v])))}if(o){for(var M=new h.Vector3(0,0,0),S=0,w=0;w<t.geometryGroups.length;w++)M.add(t.geometryGroups[w].getCentroid()),S++;M.divideScalar(S),s(e.boundingSphere,{centroid:M},y)}if(n.faceArray=new Uint16Array(c),n.truncateArrayBuffers(!0,!0),l.length<n.vertices)n.setNormals();else{var z,L=n.normalArray=new Float32Array(3*n.vertices);for(m=0,g=n.vertices;m<g;++m)u=3*m,z=l[m],L[u]=z.x,L[u+1]=z.y,L[u+2]=z.z}n.setLineIndices(),n.lineidx=n.lineArray.length},a=function(e,t,r){var i=r,o=i.vertexArr,a=(i.normalArr,i.faceArr);0!==o.length&&0!==a.length||console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var s=r.color;"undefined"==typeof s&&(s=e.color),s=h.CC.color(s);for(var l=h.splitMesh(i),c=0,u=l.length;c<u;c++)n(e,t,l[c],l[c].colorArr?l[c].colorArr:s,r.clickable)},s=function(e,t,r){e.center.set(0,0,0);var i,o;if(t.length>0){for(i=0,o=t.length;i<o;++i){var n=t[i].centroid;e.center.add(n)}e.center.divideScalar(t.length)}var a=e.radius*e.radius;for(i=0,o=r.length/3;i<o;i++){var s=r[3*i],l=r[3*i+1],c=r[3*i+2],u=e.center.distanceToSquared({x:s,y:l,z:c});a=Math.max(a,u)}e.radius=Math.sqrt(a)},l=function(e,t){"undefined"!=typeof t.color&&(e.color=t.color||new h.Color,t.color instanceof h.Color||(e.color=h.CC.color(t.color))),e.wireframe=!!t.wireframe,e.opacity=t.alpha?h.Math.clamp(t.alpha,0,1):1,"undefined"!=typeof t.opacity&&(e.opacity=h.Math.clamp(t.opacity,0,1)),e.side=void 0!==t.side?t.side:h.DoubleSide,e.linewidth="undefined"==typeof t.linewidth?1:t.linewidth,e.clickable=!!t.clickable,e.callback="function"==typeof t.callback?t.callback:null,e.hoverable=!!t.hoverable,e.hover_callback="function"==typeof t.hover_callback?t.hover_callback:null,e.unhover_callback="function"==typeof t.unhover_callback?t.unhover_callback:null,e.hidden=t.hidden};return Object.defineProperty(e.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(e.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(e.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(e.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),e}(),h.ShapeIDCount=0,h.splitMesh=function(e){var t=64e3;if(e.vertexArr.length<t)return[e];var r=(e.vertexArr.length,[{vertexArr:[],normalArr:[],faceArr:[]}]);e.colorArr&&(r.colorArr=[]);for(var i=[],o=[],n=0,a=e.faceArr,s=0,l=a.length;s<l;s+=3){for(var c=r[n],u=0;u<3;u++){var h=a[s+u];i[h]!==n&&(i[h]=n,o[h]=c.vertexArr.length,c.vertexArr.push(e.vertexArr[h]),e.normalArr&&e.normalArr[h]&&c.normalArr.push(e.normalArr[h]),e.colorArr&&e.colorArr[h]&&c.colorArr.push(e.colorArr[h])),c.faceArr.push(o[h])}c.vertexArr.length>=t&&(r.push({vertexArr:[],normalArr:[],faceArr:[]}),e.colorArr&&(r.colorArr=[]),n++)}return r},h.GLViewer=function(){function e(e,o){function a(e){var t=[];"undefined"==typeof e&&(e={});var r,i=[];if("undefined"==typeof e.model)for(r=0;r<w.length;r++)w[r]&&i.push(w[r]);else i=e.model,$.isArray(i)||(i=[i]);for(r=0;r<i.length;r++)t=t.concat(i[r].selectedAtoms(e));return t}function s(e,t){"undefined"==typeof t&&(t={});var r,i=[];if("undefined"==typeof t.model)for(r=0;r<w.length;r++)w[r]&&i.push(w[r]);else i=t.model,$.isArray(i)||(i=[i]);for(r=0;r<i.length;r++)if(i[r].atomIsSelected(e,t))return!0;return!1}function l(e,t){e.dashLength=e.dashLength||.5,e.gapLength=e.gapLength||.5,e.start=e.start||{},e.end=e.end||{};var r,i,o,n=new h.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),a=new h.Vector3(e.end.x,e.end.y||0,e.end.z||0),s=new h.Vector3,l=new h.Vector3,c=new h.Vector3,u=n.clone(),f=0;for(s.subVectors(a,n),r=s.length(),s.normalize(),l=s.clone(),c=s.clone(),l.multiplyScalar(e.dashLength),c.multiplyScalar(e.gapLength),i=l.length(),o=c.length();f<r;){if(f+i>r){e.start=n,e.end=a,t.addLine(e);break}u.addVectors(n,l),e.start=n,e.end=u,t.addLine(e),n=u.clone(),f+=i,u.addVectors(n,c),n=u.clone(),f+=o}return t}function c(e,t,r,i){var o=[];if("undefined"==typeof t.model)for(n=0;n<w.length;n++)w[n]&&o.push(w[n]);else o=t.model,$.isArray(o)||(o=[o]);for(var n=0;n<o.length;n++)o[n]&&o[n][e](t,r,i)}function f(e){var t=new h.MeshLambertMaterial;t.vertexColors=h.VertexColors;for(var r in e)"color"===r||"map"===r||e.hasOwnProperty(r)&&(t[r]=e[r]);return void 0!==e.opacity&&(1===e.opacity?t.transparent=!1:t.transparent=!0),t}o=o||{};var d=o.callback,p=o.defaultcolors;p||(p=h.elementColors.defaultColors);var v=o.nomouse,m=0;void 0!=u(o.backgroundColor)&&(m=h.CC.color(o.backgroundColor).getHex());var g=0;void 0!=u(o.camerax)&&(g=parseFloat(o.camerax));var y=this,b=e,x=(b.id,null),w=[],C={},_=[],A=[],M=[],S=[],z=null,L=b.width(),T=b.height(),F=L/T,I=1,E=800,O=150,k=20,P=[],V=new h.Renderer({antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1});V.domElement.style.width="100%",V.domElement.style.height="100%",V.domElement.style.padding="0",V.domElement.style.position="absolute",V.domElement.style.top="0px",V.domElement.style.left="0px",V.domElement.style.zIndex="0";var R=new h.Camera(k,F,I,E,o.orthographic);R.position=new h.Vector3(g,0,O);var D=new h.Vector3;R.lookAt(D);var N=new h.Raycaster(new h.Vector3(0,0,0),new h.Vector3(0,0,0)),U=new h.Projector,B=new h.Vector3(0,0,0),j=null,G=null,H=null,W=.4,q=-50,Y=50,Z=new h.Quaternion(0,0,0,1),X=new h.Quaternion(0,0,0,1),Q=!1,K=!1,J=0,ee=0,te=0,re=0,ie=0,oe=0,ne=0,ae=function(){var e=0;for(i in C)C.hasOwnProperty(i)&&i>e&&(e=i);return e+1},se=function(){var e=R.position.z-G.position.z;e<1&&(e=1),R.near=e+q,R.near<1&&(R.near=1),R.far=e+Y,R.near+1>R.far&&(R.far=R.near+1),R.fov=k,R.right=e*Math.tan(Math.PI/180*k),R.left=-R.right,R.top=R.right/F,R.bottom=-R.top,R.updateProjectionMatrix(),j.fog.near=R.near+W*(R.far-R.near),j.fog.far=R.far},le=function(e){if(j&&(se(),V.render(j,R),!e&&P.length>0))for(var t=y.getView(),r=0;r<P.length;r++){var i=P[r];i.setView(t,!0)}},ce=function(){j=new h.Scene,j.fog=new h.Fog(m,100,200),H=new h.Object3D,G=new h.Object3D,G.useQuaternion=!0,G.quaternion=new h.Quaternion(0,0,0,1),G.add(H),j.add(G);var e=new h.Light(16777215);e.position=new h.Vector3(.2,.2,1).normalize(),e.intensity=1,j.add(e)};ce(),V.setClearColorHex(m,1),j.fog.color=h.CC.color(m);var ue=null,he=function(){M.splice(0,M.length),S.splice(0,S.length);var e,t;for(e=0,t=w.length;e<t;e++){var r=w[e];if(r){var i=r.selectedAtoms({clickable:!0}),o=r.selectedAtoms({hoverable:!0});Array.prototype.push.apply(S,o),Array.prototype.push.apply(M,i)}}for(e=0,t=_.length;e<t;e++){var n=_[e];n&&n.clickable&&M.push(n),n&&n.hoverable&&S.push(n)}},fe=function(e,t,r){if(0!=M.length){var i={x:e,y:t,z:-1};B.set(i.x,i.y,i.z),U.unprojectVector(B,R),B.sub(R.position).normalize(),N.set(R.position,B);var o=[];if(o=N.intersectObjects(H,M),o.length){var n=o[0].clickable;void 0!==n.callback&&"function"==typeof n.callback&&n.callback(n,y,r,b)}}},de=function(e,t,r){if(0!=S.length){var i={x:e,y:t,z:-1};B.set(i.x,i.y,i.z),U.unprojectVector(B,R),B.sub(R.position).normalize(),N.set(R.position,B);var o=[];if(o=N.intersectObjects(H,S),o.length){var n=o[0].clickable;z=n,void 0!==n.hover_callback&&"function"==typeof n.hover_callback&&n.hover_callback(n,y,r,b)}else z=null}},pe=function(e,t,r){console.log("continue");var i={x:e,y:t,z:-1};B.set(i.x,i.y,i.z),U.unprojectVector(B,R),B.sub(R.position).normalize(),N.set(R.position,B);var o=[];o=N.intersectObjects(H,S),void 0===o[0]&&(z.unhover_callback(z,y,r,b),z=null),void 0!==o[0]&&o[0].clickable!==z&&(z.unhover_callback(z,y,r,b),z=null)},ve=function(e){var t=e.originalEvent.targetTouches[0].pageX-e.originalEvent.targetTouches[1].pageX,r=e.originalEvent.targetTouches[0].pageY-e.originalEvent.targetTouches[1].pageY;return Math.sqrt(t*t+r*r)},me=function(e){var t=e.pageX,r=e.pageY;return e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]?(t=e.originalEvent.targetTouches[0].pageX,r=e.originalEvent.targetTouches[0].pageY):e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(t=e.originalEvent.changedTouches[0].pageX,r=e.originalEvent.changedTouches[0].pageY),[t,r]},ge=function(e,t){var r=e/L,i=t/T,o=G.position.z,n=G.quaternion,a=new h.Vector3(0,0,o);return U.projectVector(a,R),a.x+=2*r,a.y-=2*i,U.unprojectVector(a,R),a.z=0,a.applyQuaternion(n),a};$("body").bind("mouseup touchend",function(e){if(K&&j){var t=me(e),r=t[0],i=t[1];if(r==J&&i==ee){var o=$("canvas",b).offset(),n=(r-o.left)/L*2-1,a=2*-((i-o.top)/T)+1;fe(n,a,e,b)}}K=!1});var ye,be,xe=this._handleMouseDown=function(e){if(e.preventDefault(),j){var t=me(e),r=t[0],i=t[1];void 0!==r&&(K=!0,ue=null,ye=e.which,J=r,ee=i,te=0,e.originalEvent.targetTouches&&2==e.originalEvent.targetTouches.length&&(te=ve(e)),Z=G.quaternion,ie=G.position.z,re=H.position.clone(),oe=q,ne=Y)}},we=this._handleMouseScroll=function(e){if(e.preventDefault(),j){var t=.85*(O-G.position.z),r=1;e.originalEvent.ctrlKey&&(r=-1),e.originalEvent.detail?G.position.z+=r*t*e.originalEvent.detail/10:e.originalEvent.wheelDelta&&(G.position.z-=r*t*e.originalEvent.wheelDelta/400),G.position.z>O&&(G.position.z=.999*O),le()}},Ce=this._handleMouseMove=function(e){clearTimeout(be);var t=$("canvas",b).offset(),r=(me(e)[0]-t.left)/L*2-1,i=2*-((me(e)[1]-t.top)/T)+1;if(null!==z&&pe(r,i,e),be=setTimeout(function(){de(r,i,e)},500),L=b.width(),T=b.height(),e.preventDefault(),j&&K){var o=0,n=me(e),a=n[0],s=n[1];if(void 0!==a){var l=(a-J)/L,c=(s-ee)/T;if(0!=te&&e.originalEvent.targetTouches&&2==e.originalEvent.targetTouches.length){var u=ve(e);o=2,c=2*(u-te)/(L+T),console.log("pinch "+te+" dy "+c)}else e.originalEvent.targetTouches&&3==e.originalEvent.targetTouches.length&&(o=1);var f,d=Math.sqrt(l*l+c*c);if(3==o||3==ye&&e.ctrlKey)q=oe+100*l,Y=ne+100*c;else if(2==o||3==ye||e.shiftKey)f=.85*(O-G.position.z),f<80&&(f=80),G.position.z=ie+c*f,G.position.z>O&&(G.position.z=.999*O);else if(1==o||2==ye||e.ctrlKey){var p=ge(a-J,s-ee);H.position.addVectors(re,p)}else if((0===o||1==ye)&&0!==d){var v=Math.sin(d*Math.PI)/d;X.x=Math.cos(d*Math.PI),X.y=0,X.z=v*l,X.w=-v*c,G.quaternion=new h.Quaternion(1,0,0,0),G.quaternion.multiply(X),G.quaternion.multiply(Z)}le()}}},_e=function(e){b=e,L=b.width(),T=b.height(),F=L/T,V.setSize(L,T),b.append(V.domElement),x=$(V.domElement),v||(x.bind("mousedown touchstart",xe),x.bind("DOMMouseScroll mousewheel",we),x.bind("mousemove touchmove",Ce),x.bind("contextmenu",function(e){e.preventDefault()}))};_e(b),this.setContainer=function(e){return"string"===$.type(e)&&(e=$("#"+e)),e||(e=b),_e(e),this},this.setBackgroundColor=function(e,t){"undefined"==typeof t?t=1:(t<0||t>1)&&(t=1);var r=h.CC.color(e);return j.fog.color=r,m=r.getHex(),V.setClearColorHex(r.getHex(),t),le(),this},this.setProjection=function(e){R.ortho="orthographic"===e,se()},this.setViewStyle=function(e){if("outline"===e.style){var t={};e.color&&(t.color=h.CC.color(e.color)),e.width&&(t.width=e.width),V.enableOutline(t)}else V.disableOutline();return this},o.style&&this.setViewStyle(o),this.setWidth=function(e){return L=e||L,V.setSize(L,T),this},this.setHeight=function(e){return T=e||T,V.setSize(L,T),this},this.resize=function(){return L=b.width(),T=b.height(),F=L/T,V.setSize(L,T),R.aspect=F,R.updateProjectionMatrix(),le(),this},$(window).resize(this.resize),this.getModel=function(e){return e=e||w.length-1,w[e]},this.rotate=function(e,t){"undefined"==typeof t&&(t="y");var r=0,i=0,o=0,n=Math.PI*e/180,a=Math.sin(n/2),s=Math.cos(n/2);"x"==t&&(r=a),"y"==t&&(i=a),"z"==t&&(o=a);var l=new h.Quaternion(r,i,o,s).normalize();return G.quaternion.multiply(l),le(),this},this.getView=function(){if(!H)return[0,0,0,0,0,0,0,1];var e=H.position,t=G.quaternion;return[e.x,e.y,e.z,G.position.z,t.x,t.y,t.z,t.w]},this.setView=function(e,t){return void 0!==e&&(e instanceof Array||8!==e.length)&&H&&G?(H.position.x=e[0],H.position.y=e[1],H.position.z=e[2],G.position.z=e[3],G.quaternion.x=e[4],G.quaternion.y=e[5],G.quaternion.z=e[6],G.quaternion.w=e[7],"undefined"!=typeof e[8]&&(G.position.x=e[8],G.position.y=e[9]),le(t),this):this},this.render=function(){var e=new Date;he();var t,r,i=this.getView(),o=V.supportedExtensions();for(t=0;t<w.length;t++)w[t]&&w[t].globj(H,o);for(t=0;t<_.length;t++)_[t]&&_[t].globj(H,o);for(t in C)if(C.hasOwnProperty(t)){var n=C[t];for(r=0;r<n.length;r++)if(n.hasOwnProperty(r)){var a=n[r].geo;if(!n[r].finished){a.verticesNeedUpdate=!0,a.elementsNeedUpdate=!0,a.normalsNeedUpdate=!0,a.colorsNeedUpdate=!0,a.buffersNeedUpdate=!0,a.boundingSphere=null,n[r].done&&(n[r].finished=!0),n[r].lastGL&&H.remove(n[r].lastGL);var s=null;if(s=n[r].mat instanceof h.LineBasicMaterial?new h.Line(a,n[r].mat):new h.Mesh(a,n[r].mat),n[r].mat.transparent&&0==n[r].mat.opacity?s.visible=!1:s.visible=!0,n[r].symmetries.length>1||1==n[r].symmetries.length&&!n[r].symmetries[r].isIdentity()){var l,c=new h.Object3D;for(l=0;l<n[r].symmetries.length;l++){var u=s.clone();u.matrix=n[r].symmetries[l],u.matrixAutoUpdate=!1,c.add(u)}n[r].lastGL=c,H.add(c)}else n[r].lastGL=s,H.add(s)}}}this.setView(i);var f=new Date;return console.log("render time: "+(f-e)),this},this.selectedAtoms=function(e){return a(e)},this.pdbData=function(e){for(var t=a(e),r="",i=0,o=t.length;i<o;++i)r+=t[i].pdbline+"\n";return r},this.zoom=function(e){var e=e||2,t=(O-G.position.z)/e;return G.position.z=O-t,le(),this},this.translate=function(e,t){var r=e/L,i=t/T,o=new h.Vector3(0,0,(-O));return U.projectVector(o,R),o.x-=r,o.y-=i,U.unprojectVector(o,R),o.z=0,D.add(o),R.lookAt(D),le(),this},this.zoomTo=function(e){var t,r;e=e||{};var i=a(e),o=h.getExtent(i);$.isEmptyObject(e)?($.each(_,function(e,t){if(t&&t.boundingSphere&&t.boundingSphere.center)var r=t.boundingSphere.center;var o=t.boundingSphere.radius;o>0?(i.push(new h.Vector3(r.x+o,r.y,r.z)),i.push(new h.Vector3(r.x-o,r.y,r.z)),i.push(new h.Vector3(r.x,r.y+o,r.z)),i.push(new h.Vector3(r.x,r.y-o,r.z)),i.push(new h.Vector3(r.x,r.y,r.z+o)),i.push(new h.Vector3(r.x,r.y,r.z-o))):i.push(r)}),o=h.getExtent(i),t=i,r=o):(t=a({}),r=h.getExtent(t));var n=new h.Vector3(o[2][0],o[2][1],o[2][2]);H.position=n.clone().multiplyScalar(-1);var s=r[1][0]-r[0][0],l=r[1][1]-r[0][1],c=r[1][2]-r[0][2],u=Math.sqrt(s*s+l*l+c*c);u<5&&(u=5),q=-u/1.9,Y=u/2,s=o[1][0]-o[0][0],l=o[1][1]-o[0][1],c=o[1][2]-o[0][2],u=Math.sqrt(s*s+l*l+c*c),u<5&&(u=5);for(var f=25,d=0;d<i.length;d++)if(i[d]){var p=n.distanceToSquared(i[d]);p>f&&(f=p)}var u=2*Math.sqrt(f);return G.position.z=-(.5*u/Math.tan(Math.PI/180*R.fov/2)-O),le(),this},this.setSlab=function(e,t){q=e,Y=t},this.getSlab=function(e){return{near:q,far:Y}},this.addLabel=function(e,t){var r=new h.Label(e,t);return r.setContext(),H.add(r.sprite),A.push(r),le(),r},this.addResLabels=function(e,t){return c("addResLabels",e,this,t),this},this.removeLabel=function(e){for(var t=0;t<A.length;t++)if(A[t]==e){A.splice(t,1),e.dispose(),H.remove(e.sprite);break}return this},this.removeAllLabels=function(){for(var e=0;e<A.length;e++)H.remove(A[e].sprite);return A.splice(0,A.length),this},this.setLabelStyle=function(e,t){return H.remove(e.sprite),e.dispose(),e.stylespec=t,e.setContext(),H.add(e.sprite),le(),e},this.setLabelText=function(e,t){return H.remove(e.sprite),e.dispose(),e.text=t,e.setContext(),H.add(e.sprite),le(),e},this.addShape=function(e){e=e||{};var t=new h.GLShape(e);return t.shapePosition=_.length,_.push(t),t},this.removeShape=function(e){if(!e)return this;for(e.removegl(H),delete _[e.shapePosition];_.length>0&&"undefined"==typeof _[_.length-1];)_.pop();return this},this.removeAllShapes=function(){for(var e=0;e<_.length;e++){var t=_[e];t.removegl(H)}return _.splice(0,_.length),this},this.addSphere=function(e){e=e||{};var t=new h.GLShape(e);return t.shapePosition=_.length,t.addSphere(e),_.push(t),t},this.addArrow=function(e){e=e||{};var t=new h.GLShape(e);return t.shapePosition=_.length,t.addArrow(e),_.push(t),t},this.addCylinder=function(e){e=e||{};var t=new h.GLShape(e);return t.shapePosition=_.length,t.addCylinder(e),_.push(t),t},this.addLine=function(e){e=e||{},e.wireframe=!0;var t=new h.GLShape(e);return t.shapePosition=_.length,e.dashed?t=l(e,t):t.addLine(e),_.push(t),t},this.addUnitCell=function(e){var t=new h.GLShape({wireframe:!0});t.shapePosition=_.length;var r=e.getCrystData();if(r){var i=r.a,o=r.b,n=r.c,a=r.alpha,s=r.beta,l=r.gamma;a=a*Math.PI/180,s=s*Math.PI/180,l=l*Math.PI/180;var c,u,f;c=Math.cos(s),u=(Math.cos(a)-Math.cos(s)*Math.cos(l))/Math.sin(l),f=Math.sqrt(Math.max(0,1-c*c-u*u));for(var d=new h.Matrix4(i,o*Math.cos(l),n*c,0,0,o*Math.sin(l),n*u,0,0,0,n*f,0,0,0,0,1),p=[new h.Vector3(0,0,0),new h.Vector3(1,0,0),new h.Vector3(0,1,0),new h.Vector3(0,0,1),new h.Vector3(1,1,0),new h.Vector3(0,1,1),new h.Vector3(1,0,1),new h.Vector3(1,1,1)],v=0;v<p.length;v++)p[v]=p[v].applyMatrix4(d);t.addLine({start:p[0],end:p[1]}),t.addLine({start:p[0],end:p[2]}),t.addLine({start:p[1],end:p[4]}),t.addLine({start:p[2],end:p[4]}),t.addLine({start:p[0],end:p[3]}),t.addLine({start:p[3],end:p[5]}),t.addLine({start:p[2],end:p[5]}),t.addLine({start:p[1],end:p[6]}),t.addLine({start:p[4],end:p[7]}),t.addLine({start:p[6],end:p[7]}),t.addLine({start:p[3],end:p[6]}),t.addLine({start:p[5],end:p[7]})}return _.push(t),t},this.addCustom=function(e){e=e||{};var t=new h.GLShape(e);return t.shapePosition=_.length,t.addCustom(e),_.push(t),t},this.addVolumetricData=function(e,t,r){r=r||{};var i=new h.GLShape(r);return i.shapePosition=_.length,i.addVolumetricData(e,t,r),_.push(i),i},this.addIsosurface=function(e,t){t=t||{};var r=new h.GLShape(t);return r.shapePosition=_.length,r.addIsosurface(e,t),_.push(r),r},this.setFrame=function(e){for(var t=0;t<w.length;t++)w[t].setFrame(e);return this},this.getFrames=function(){for(var e=0,t=0,r=0;r<w.length;r++)w[r].getFrames().length>e&&(t=r,e=w[r].getFrames().length);return e},this.animate=function(e){Q=!0;var t=100,r="forward",i=0;e=e||{},e.interval&&(t=e.interval),e.loop&&(r=e.loop),e.reps&&(i=e.reps);var o=this.getFrames(),n=this,a=0,s=1,l=0,c=o*i,u=function(e){"forward"==e?(n.setFrame(a),a=(a+s)%o):"backward"==e?(n.setFrame(o-1-a),a=(a+s)%o):(n.setFrame(a),a+=s,s*=a%(o-1)==0?-1:1),n.render(),++l!=c&&n.isAnimated()||clearInterval(h)},h=setInterval(function(){u(r)},t);return this},this.stopAnimate=function(){return Q=!1,this},this.isAnimated=function(){return Q},this.addModel=function(e,t,r){var i=new h.GLModel(w.length,p);return i.addMolData(e,t,r),w.push(i),i},this.addModels=function(e,t,r){r=r||{},r.multimodel=!0,r.frames=!0;for(var i=h.GLModel.parseMolData(e,t,r),o=0;o<i.length;o++){var n=new h.GLModel(w.length,p);n.setAtomDefaults(i[o]),n.addFrame(i[o]),n.setFrame(0),n.setModelData(i.modelData[o]),n.setDontDuplicateAtoms(!r.duplicateAssemblyAtoms),w.push(n)}return w},this.addModelsAsFrames=function(e,t,r){r=r||{},r.multimodel=!0,r.frames=!0;var i=new h.GLModel(w.length,p);return i.addMolData(e,t,r),w.push(i),i},this.addAsOneMolecule=function(e,t,r){r=r||{},r.multimodel=!0,r.onemol=!0;var i=new h.GLModel(w.length,p);return i.addMolData(e,t,r),w.push(i),i},this.removeModel=function(e){if(e){for(e.removegl(H),delete w[e.getID()];w.length>0&&"undefined"==typeof w[w.length-1];)w.pop();return this}},this.removeAllModels=function(){for(var e=0;e<w.length;e++){var t=w[e];t.removegl(H)}return w.splice(0,w.length),this},this.exportJSON=function(e,t){var r={};return void 0===t?r.m=w.map(function(t){return t.toCDObject(e)}):r.m=[model[t].toCDObject()],JSON.stringify(r)},this.createModelFrom=function(e,t){for(var r=new h.GLModel(w.length,p),i=0;i<w.length;i++)if(w[i]){var o=w[i].selectedAtoms(e);r.addAtoms(o),t&&w[i].removeAtoms(o)}return w.push(r),r},this.setStyle=function(e,t){return"undefined"==typeof t&&(t=e,e={}),c("setStyle",e,t,!1),this},this.addStyle=function(e,t){return"undefined"==typeof t&&(t=e,e={}),c("setStyle",e,t,!0),this},this.setClickable=function(e,t,r){return c("setClickable",e,t,r),this},this.setHoverable=function(e,t,r,i){return c("setHoverable",e,t,r,i),this},this.setColorByProperty=function(e,t,r){return c("setColorByProperty",e,t,r),this},this.setColorByElement=function(e,t){return c("setColorByElement",e,t),this};var Ae=function(e,t){for(var r=[],i=0;i<e.length;i++){var o=e[i];"undefined"!=typeof o&&(o.x<t[0][0]||o.x>t[1][0]||o.y<t[0][1]||o.y>t[1][1]||o.z<t[0][2]||o.z>t[1][2]||r.push(o))}return r},Me=function(e){var t=e[1][0]-e[0][0],r=e[1][1]-e[0][1],i=e[1][2]-e[0][2];return t*r*i},Se=function(e,t,i){for(var o=[],n={},a=0,s=t.length;a<s;a++)n[t[a].index]=a;for(var l=(function(e){for(var t=[],r=0,i=e.length;r<i;r++)e[r].index in n&&t.push(n[e[r].index]);return t}),c=function(e){var t=[];return t[0]=[e[0][0],e[0][1],e[0][2]],t[1]=[e[1][0],e[1][1],e[1][2]],t},u=function m(e){if(Me(e)<r)return[e];var t,i=e[1][0]-e[0][0],o=e[1][1]-e[0][1],n=e[1][2]-e[0][2];t=i>o&&i>n?0:o>i&&o>n?1:2;var a=c(e),s=c(e),l=(e[1][t]-e[0][t])/2+e[0][t];a[1][t]=l,s[0][t]=l;var u=m(a),h=m(s);return u.concat(h)},h=u(e),f=6,a=0,s=h.length;a<s;a++){var d=c(h[a]);d[0][0]-=f,d[0][1]-=f,d[0][2]-=f,d[1][0]+=f,d[1][1]+=f,d[1][2]+=f;var p=Ae(t,d),v=Ae(i,h[a]);o.push({extent:h[a],atoms:l(p),toshow:l(v)})}return o},ze=function(e,t,r){var i=new h.Geometry((!0)),o=i.updateGeoGroup(0),n=[];for(l=0,c=e.length;l<c;l++){var a=e[l];a&&("undefined"!=typeof a.surfaceColor?n[l]=a.surfaceColor:a.color&&(n[l]=h.CC.color(a.color)))}var s,l,c,u=o.vertexArray,f=t.vertices;for(l=0,c=f.length;l<c;l++)s=3*o.vertices,u[s]=f[l].x,u[s+1]=f[l].y,u[s+2]=f[l].z,o.vertices++;var d=o.colorArray;if(r.voldata&&r.volscheme){var p=r.volscheme,v=r.voldata,m=p.range()||[-1,1];for(l=0,c=f.length;l<c;l++){var g=v.getVal(f[l].x,f[l].y,f[l].z),y=h.CC.color(p.valueToHex(g,m)),s=3*l;d[s]=y.r,d[s+1]=y.g,d[s+2]=y.b}}else if(n.length>0)for(l=0,c=f.length;l<c;l++){var b=f[l].atomid,x=3*l;d[x]=n[b].r,d[x+1]=n[b].g,d[x+2]=n[b].b}var w=t.faces;o.faceidx=w.length,i.initTypedArrays();var C,_,A,M,S=o.vertexArray,z=o.normalArray;for(l=0,c=w.length;l<c;l+=3){var L=w[l],T=w[l+1],F=w[l+2],b=f[L].atomid,x=(f[T].atomid,f[F].atomid,3*L),I=3*T,E=3*F;C=new h.Vector3(S[x],S[x+1],S[x+2]),_=new h.Vector3(S[I],S[I+1],S[I+2]),A=new h.Vector3(S[E],S[E+1],S[E+2]),A.subVectors(A,_),C.subVectors(C,_),A.cross(C),M=A,M.normalize(),z[x]+=M.x,z[I]+=M.x,z[E]+=M.x,z[x+1]+=M.y,z[I+1]+=M.y,z[E+1]+=M.y,z[x+2]+=M.z,z[I+2]+=M.z,z[E+2]+=M.z}o.faceArray=new Uint16Array(w);var O=new h.Mesh(i,r);return O.doubleSided=!0,O},Le=function(e,t,r,i,o,n){var a=(new Date,new h.ProteinSurface);a.initparm(t,1!==e,n);new Date;a.fillvoxels(o,r);new Date;a.buildboundary(),e!=h.SurfaceType.SES&&e!=h.SurfaceType.MS||(a.fastdistancemap(),a.boundingatom(!1),a.fillvoxelswaals(o,r));new Date;a.marchingcube(e);new Date;return a.getFacesAndVertices(i)};this.addMesh=function(e){var t={geo:e.geometry,mat:e.material,done:!0,finished:!1},r=ae();return C[r]=t,r};var Te=function(e){var t=[];return $.each(e,function(e,r){t[e]=$.extend({},r)}),t};this.addSurface=function(e,r,i,o,n){var s=null,l=null,c=Te(a(i));s=o?Te(a(o)):c;var u,d=!1;for(u=0;u<w.length;u++)if(w[u]){var p=w[u].getSymmetries();if(p.length>1||1==p.length&&!p[0].isIdentity()){d=!0;break}}var v=function(i,o,s){l=n?Te(a(n)):s;var c,u,f,d=(new Date,h.getExtent(s,!0));if(r.map&&r.map.prop){var p=r.map.prop,v=r.map.scheme||r.map.gradient||new h.Gradient.RWB,g=v.range();g||(g=h.getPropertyRange(s,p)),r.colorscheme={prop:p,gradient:v}}for(u=0,f=o.length;u<f;u++)c=o[u],c.surfaceColor=h.getColorFromStyle(c,r);var b=Me(d),x=Se(d,o,s);if(l&&l.length&&l.length>0){var w=h.getExtent(l,!0),C=function(e,t){var r=function(e,t){var r=e.extent,i=r[1][0]-r[0][0],o=r[1][1]-r[0][1],n=r[1][2]-r[0][2],a=i-t[2][0];a*=a;var s=o-t[2][1];s*=s;var l=n-t[2][2];return l*=l,a+s+l},i=r(e,w),o=r(t,w);return i-o};x.sort(C)}var _=[];for(u=0,f=o.length;u<f;u++)c=o[u],_[u]={x:c.x,y:c.y,z:c.z,serial:u,elem:c.elem};var A=!!h.syncSurface;if(A){var M=function E(t){if(!(t>=x.length)){var r=Le(e,x[t].extent,x[t].atoms,x[t].toshow,_,b),n=ze(o,r,m);h.mergeGeos(i.geo,n),y.render(),setTimeout(E,1,t+1)}};setTimeout(M,1,0)}else{var S=[];for(e<0&&(e=0),u=0,f=t;u<f;u++){var z=new Worker(h.SurfaceWorker);S.push(z),z.postMessage({type:-1,atoms:_,volume:b})}var L=0,T=function(e){for(var t=h.splitMesh({vertexArr:e.data.vertices,faceArr:e.data.faces}),r=0,n=t.length;r<n;r++){var a={vertices:t[r].vertexArr,faces:t[r].faceArr},s=ze(o,a,m);h.mergeGeos(i.geo,s),y.render()}L++,L==x.length&&(i.done=!0)},F=function(e){console.log(e.message+" ("+e.filename+":"+e.lineno+")")};for(u=0;u<x.length;u++){var I=S[u%S.length];I.onmessage=T,I.onerror=F,I.postMessage({type:e,expandedExtent:x[u].extent,extendedAtoms:x[u].atoms,atomsToShow:x[u].toshow})}}};r=r||{};var m=f(r),g=[];if(d){var b={},x={};for(u=0;u<w.length;u++)b[u]=[],x[u]=[];for(u=0;u<s.length;u++)b[s[u].model].push(s[u]);for(u=0;u<c.length;u++)x[c[u].model].push(c[u]);for(u=0;u<w.length;u++)g.push({geo:new h.Geometry((!0)),mat:m,done:!1,finished:!1,symmetries:w[u].getSymmetries()}),v(g[u],b[u],x[u])}else g.push({geo:new h.Geometry((!0)),mat:m,done:!1,finished:!1,symmetries:[new h.Matrix4]}),v(g[g.length-1],s,c);var _=ae();return C[_]=g,_},this.setSurfaceMaterialStyle=function(e,t){if(C[e]){surfArr=C[e];for(var r=0;r<surfArr.length;r++)surfArr[r].mat=f(t),surfArr[r].mat.side=h.FrontSide,surfArr[r].finished=!1}return this},this.removeSurface=function(e){for(var t=C[e],r=0;r<t.length;r++)t[r]&&t[r].lastGL&&(void 0!==t[r].geo&&t[r].geo.dispose(),void 0!==t[r].mat&&t[r].mat.dispose(),H.remove(t[r].lastGL));return delete C[e],le(),this},this.removeAllSurfaces=function(){for(n in C)if(C.hasOwnProperty(n)){for(var e=C[n],t=0;t<e.length;t++)e[t]&&e[t].lastGL&&(void 0!==e[t].geo&&e[t].geo.dispose(),void 0!==e[t].mat&&e[t].mat.dispose(),H.remove(e[t].lastGL));delete C[n]}return le(),this},this.jmolMoveTo=function(){var e=H.position,t="center { "+-e.x+" "+-e.y+" "+-e.z+" }; ",r=G.quaternion;return t+="moveto .5 quaternion { "+r.x+" "+r.y+" "+r.z+" "+r.w+" };"},this.clear=function(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),le(),this},this.mapAtomProperties=function(e,t){t=t||{};var r=a(t);if("function"==typeof e)for(var i=0,o=r.length;i<o;i++){var n=r[i];e(n)}else for(var i=0,o=r.length;i<o;i++)for(var n=r[i],l=0,c=e.length;l<c;l++){var u=e[l];if(u.props)for(var h in u.props)u.props.hasOwnProperty(h)&&s(n,u)&&(n.properties||(n.properties={}),n.properties[h]=u.props[h])}return this},this.linkViewer=function(e){return P.push(e),this};try{"function"==typeof d&&d(this)}catch(Fe){console.log("error with glviewer callback: "+Fe)}}var t=4,r=64e3;return e}(),h.glmolViewer=h.GLViewer;var h=h||{};h.Gradient=function(e,t){},
h.Gradient.valueToHex=function(e,t){},h.Gradient.range=function(){},h.Gradient.RWB=function(e,t,r){var i=1;"undefined"==typeof t&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),t<e&&(i=-1,e*=-1,t*=-1),this.valueToHex=function(o,n){var a,s;if(o=i*o,n?(a=n[0],s=n[1]):(a=e,s=t),void 0===o)return 16777215;o<a&&(o=a),o>s&&(o=s);var l=(s+a)/2;"undefined"!=typeof r&&(l=r);var c,u;return o<=l?(c=Math.floor(255*Math.sqrt((o-a)/(l-a))),u=16711680+256*c+c):(c=Math.floor(255*Math.sqrt(1-(o-l)/(s-l))),u=65536*c+256*c+255)},this.range=function(){return"undefined"!=typeof e&&"undefined"!=typeof t?[e,t]:null}},h.Gradient.ROYGB=function(e,t){var r=1;"undefined"==typeof t&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),t<e&&(r=-1,e*=-1,t*=-1),this.valueToHex=function(i,o){var n,a;if(i=r*i,o?(n=o[0],a=o[1]):(n=e,a=t),"undefined"==typeof i)return 16777215;i<n&&(i=n),i>a&&(i=a);var s,l,c=(n+a)/2,u=(n+c)/2,h=(c+a)/2;return i<u?(s=Math.floor(255*Math.sqrt((i-n)/(u-n))),l=16711680+256*s+0):i<c?(s=Math.floor(255*Math.sqrt(1-(i-u)/(c-u))),l=65536*s+65280+0):i<h?(s=Math.floor(255*Math.sqrt((i-c)/(h-c))),l=65280+1*s):(s=Math.floor(255*Math.sqrt(1-(i-h)/(a-h))),l=0+256*s+255)},this.range=function(){return"undefined"!=typeof e&&"undefined"!=typeof t?[e,t]:null}},h.Gradient.Sinebow=function(e,t){var r=1;"undefined"==typeof t&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),t<e&&(r=-1,e*=-1,t*=-1),this.valueToHex=function(i,o){var n,a;if(i=r*i,o?(n=o[0],a=o[1]):(n=e,a=t),"undefined"==typeof i)return 16777215;i<n&&(i=n),i>a&&(i=a);var s=(i-n)/(a-n),l=5*s/6+.5,c=Math.sin(Math.PI*l);c*=255*c;var u=Math.sin(Math.PI*(l+1/3));u*=255*u;var h=Math.sin(Math.PI*(l+2/3));return h*=255*h,65536*Math.floor(c)+256*Math.floor(h)+1*Math.floor(u)},this.range=function(){return"undefined"!=typeof e&&"undefined"!=typeof t?[e,t]:null}},h.LabelCount=0,h.Label=function(e,t){this.id=h.LabelCount++,this.stylespec=t||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new h.Sprite,this.text=e},h.Label.prototype={constructor:h.Label,getStyle:function(){return this.stylespec},setContext:function(){var e=function(e,t,r,i,o,n,a){e.beginPath(),e.moveTo(t+n,r),e.lineTo(t+i-n,r),e.quadraticCurveTo(t+i,r,t+i,r+n),e.lineTo(t+i,r+o-n),e.quadraticCurveTo(t+i,r+o,t+i-n,r+o),e.lineTo(t+n,r+o),e.quadraticCurveTo(t,r+o,t,r+o-n),e.lineTo(t,r+n),e.quadraticCurveTo(t,r,t+n,r),e.closePath(),e.fill(),a&&e.stroke()},t=function(e,t,r){var i=r;return"undefined"!=typeof e&&(i=e instanceof h.Color?e.scaled():h.CC.color(e).scaled()),"undefined"!=typeof t&&(i.a=parseFloat(t)),i};return function(){var r=this.stylespec,i="undefined"!=typeof r.useScreen&&r.useScreen,o=r.showBackground;"0"!==o&&"false"!==o||(o=!1),"undefined"==typeof o&&(o=!0);var n=r.font?r.font:"sans-serif",a=parseInt(r.fontSize)?parseInt(r.fontSize):18,s=t(r.fontColor,r.fontOpacity,{r:255,g:255,b:255,a:1}),l=r.padding?r.padding:4,c=r.borderThickness?r.borderThickness:0,u=t(r.backgroundColor,r.backgroundOpacity,{r:0,g:0,b:0,a:1}),f=t(r.borderColor,r.borderOpacity,u),d=r.position?r.position:{x:-10,y:1,z:1},p=void 0===r.inFront||r.inFront;"false"!==p&&"0"!==p||(p=!1);var v=r.alignment||h.SpriteAlignment.topLeft,m="";r.bold&&(m="bold "),this.context.font=m+a+"px  "+n;var g=this.context.measureText(this.text),y=g.width;o||(c=0);var b=y+2.5*c+2*l,x=1.25*a+2*c+2*l;if(r.backgroundImage){var w=r.backgroundImage,C=r.backgroundWidth?r.backgroundWidth:w.width,_=r.backgroundHeight?r.backgroundHeight:w.height;C>b&&(b=C),_>x&&(x=_)}this.canvas.width=b,this.canvas.height=x,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var m="";if(r.bold&&(m="bold "),this.context.font=m+a+"px  "+n,this.context.fillStyle="rgba("+u.r+","+u.g+","+u.b+","+u.a+")",this.context.strokeStyle="rgba("+f.r+","+f.g+","+f.b+","+f.a+")",this.context.lineWidth=c,o&&e(this.context,c,c,b-2*c,x-2*c,6,c>0),r.backgroundImage){var w=r.backgroundImage,C=r.backgroundWidth?r.backgroundWidth:w.width,_=r.backgroundHeight?r.backgroundHeight:w.height;this.context.drawImage(w,0,0,C,_)}this.context.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",this.context.fillText(this.text,c+l,a+c+l,y);var A=new h.Texture(this.canvas);A.needsUpdate=!0,this.sprite.material=new h.SpriteMaterial({map:A,useScreenCoordinates:i,alignment:v,depthTest:!p}),this.sprite.scale.set(1,1,1),this.sprite.position.set(d.x,d.y,d.z)}}(),dispose:function(){void 0!==this.sprite.material.map&&this.sprite.material.map.dispose(),void 0!==this.sprite.material&&this.sprite.material.dispose()}},h=h||{},h.MarchingCubeInitializer=function(){var e=2,t={};t.march=function(t,a,s,l){var c=!!l.fulltable,u=l.hasOwnProperty("origin")&&l.origin.hasOwnProperty("x")?l.origin:{x:0,y:0,z:0},f=!!l.voxel,d=l.matrix,p=l.nX||0,v=l.nY||0,m=l.nZ||0,g=l.scale||1,y=null;y=l.unitCube?l.unitCube:{x:g,y:g,z:g};var b,x,w=new Int32Array(p*v*m);for(b=0,x=w.length;b<x;++b)w[b]=-1;var C=function(e,t,r,i,o,n){var s={x:0,y:0,z:0},l=!!(i&1<<o),c=!!(i&1<<n),p=o;!l&&c&&(p=n),1&p&&r++,2&p&&t++,4&p&&e++,d?(s=new h.Vector3(e,t,r),s=s.applyMatrix4(d),s={x:s.x,y:s.y,z:s.z}):(s.x=u.x+y.x*e,s.y=u.y+y.y*t,s.z=u.z+y.z*r);var g=(v*e+t)*m+r;return f?(a.push(s),a.length-1):(w[g]<0&&(w[g]=a.length,a.push(s)),w[g])},_=new Int32Array(12),A=c?o:r,M=c?n:i;for(b=0;b<p-1;++b)for(var S=0;S<v-1;++S)for(var z=0;z<m-1;++z){for(var L=0,T=0;T<8;++T){var F=(v*(b+((4&T)>>2))+S+((2&T)>>1))*m+z+(1&T),I=!!(t[F]&e);L|=I<<T}if(0!==L&&255!==L){var E=A[L];if(0!==E){var O=M[L];1&E&&(_[0]=C(b,S,z,L,0,1)),2&E&&(_[1]=C(b,S,z,L,1,3)),4&E&&(_[2]=C(b,S,z,L,3,2)),8&E&&(_[3]=C(b,S,z,L,2,0)),16&E&&(_[4]=C(b,S,z,L,4,5)),32&E&&(_[5]=C(b,S,z,L,5,7)),64&E&&(_[6]=C(b,S,z,L,7,6)),128&E&&(_[7]=C(b,S,z,L,6,4)),256&E&&(_[8]=C(b,S,z,L,0,4)),512&E&&(_[9]=C(b,S,z,L,1,5)),1024&E&&(_[10]=C(b,S,z,L,3,7)),2048&E&&(_[11]=C(b,S,z,L,2,6));for(var k=0;k<O.length;k+=3){var P=_[O[k]],V=_[O[k+1]],R=_[O[k+2]];f&&k>=3&&(a.push(a[P]),P=a.length-1,a.push(a[V]),V=a.length-1,a.push(a[R]),R=a.length-1),s.push(P),s.push(V),s.push(R)}}}}},t.laplacianSmooth=function(e,t,r){var i,o,n,a,s,l=new Array(t.length);for(i=0,o=t.length;i<o;i++)l[i]={x:0,y:0,z:0};var c,u=new Array(20);for(i=0;i<20;i++)u[i]=new Array(t.length);for(i=0,o=t.length;i<o;i++)u[0][i]=0;for(i=0,o=r.length/3;i<o;i++){var h=3*i,f=3*i+1,d=3*i+2;for(c=!0,n=0,a=u[0][r[h]];n<a;n++)if(r[f]==u[n+1][r[h]]){c=!1;break}for(c&&(u[0][r[h]]++,u[u[0][r[h]]][r[h]]=r[f]),c=!0,n=0,a=u[0][r[h]];n<a;n++)if(r[d]==u[n+1][r[h]]){c=!1;break}for(c&&(u[0][r[h]]++,u[u[0][r[h]]][r[h]]=r[d]),c=!0,n=0,a=u[0][r[f]];n<a;n++)if(r[h]==u[n+1][r[f]]){c=!1;break}for(c&&(u[0][r[f]]++,u[u[0][r[f]]][r[f]]=r[h]),c=!0,n=0,a=u[0][r[f]];n<a;n++)if(r[d]==u[n+1][r[f]]){c=!1;break}for(c&&(u[0][r[f]]++,u[u[0][r[f]]][r[f]]=r[d]),c=!0,n=0;n<u[0][r[d]];n++)if(r[h]==u[n+1][r[d]]){c=!1;break}for(c&&(u[0][r[d]]++,u[u[0][r[d]]][r[d]]=r[h]),c=!0,n=0,a=u[0][r[d]];n<a;n++)if(r[f]==u[n+1][r[d]]){c=!1;break}c&&(u[0][r[d]]++,u[u[0][r[d]]][r[d]]=r[f])}var p=1,v=.5;for(s=0;s<e;s++){for(i=0,o=t.length;i<o;i++)if(u[0][i]<3)l[i].x=t[i].x,l[i].y=t[i].y,l[i].z=t[i].z;else if(3==u[0][i]||4==u[0][i]){for(l[i].x=0,l[i].y=0,l[i].z=0,n=0,a=u[0][i];n<a;n++)l[i].x+=t[u[n+1][i]].x,l[i].y+=t[u[n+1][i]].y,l[i].z+=t[u[n+1][i]].z;l[i].x+=v*t[i].x,l[i].y+=v*t[i].y,l[i].z+=v*t[i].z,l[i].x/=v+u[0][i],l[i].y/=v+u[0][i],l[i].z/=v+u[0][i]}else{for(l[i].x=0,l[i].y=0,l[i].z=0,n=0,a=u[0][i];n<a;n++)l[i].x+=t[u[n+1][i]].x,l[i].y+=t[u[n+1][i]].y,l[i].z+=t[u[n+1][i]].z;l[i].x+=p*t[i].x,l[i].y+=p*t[i].y,l[i].z+=p*t[i].z,l[i].x/=p+u[0][i],l[i].y/=p+u[0][i],l[i].z/=p+u[0][i]}for(i=0,o=t.length;i<o;i++)t[i].x=l[i].x,t[i].y=l[i].y,t[i].z=l[i].z}},t.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var r=new Uint32Array(t.edgeTable),i=t.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],o=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],n=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];return t},h.MarchingCube=h.MarchingCubeInitializer(),h.Parsers=function(){var e={},t=function(e){for(var t=0,r=e.length;t<r;t++)e[t].index||(e[t].index=t);for(var i={},o=4.95,n=0;n<e.length;n++){var a=e[n],s=Math.floor(a.x/o),c=Math.floor(a.y/o),u=Math.floor(a.z/o);i[s]||(i[s]={}),i[s][c]||(i[s][c]={}),i[s][c][u]||(i[s][c][u]=[]),i[s][c][u].push(a)}var h=function(e,t){for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<t.length;o++){var n=t[o];l(i,n)&&i.bonds.indexOf(n.index)==-1&&(i.bonds.push(n.index),i.bondOrder.push(1),n.bonds.push(i.index),n.bondOrder.push(1))}},f=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(var s in i){s=parseInt(s);for(var c in i[s]){c=parseInt(c);for(var u in i[s][c]){u=parseInt(u);for(var d=i[s][c][u],t=0;t<d.length;t++)for(var p=d[t],v=t+1;v<d.length;v++){var m=d[v];l(p,m)&&p.bonds.indexOf(m.index)==-1&&(p.bonds.push(m.index),p.bondOrder.push(1),m.bonds.push(p.index),m.bondOrder.push(1))}for(var g=0;g<f.length;g++){var y=f[g];if(i[s+y.x]&&i[s+y.x][c+y.y]&&i[s+y.x][c+y.y][u+y.z]){var b=i[s+y.x][c+y.y][u+y.z];h(d,b)}}}}}},r=function(e){var r,i,o=[],n=[];for(r=0,i=e.length;r<i;r++){var a=e[r];a.index=r,a.hetflag?n.push(a):o.push(a)}t(n),o.sort(function(e,t){return e.chain!=t.chain?e.chain<t.chain?-1:1:e.resi-t.resi});var s,c=-1,u=-1;for(r=0,i=o.length;r<i;r++){var h=o[r];h.resi!==c&&(c=h.resi,s||u++,s=!1),h.reschain=u;for(var f=r+1;f<o.length;f++){var d=o[f];if(d.chain!=h.chain)break;if(d.resi-h.resi>1)break;l(h,d)&&(h.bonds.indexOf(d.index)===-1&&(h.bonds.push(d.index),h.bondOrder.push(1),d.bonds.push(h.index),d.bondOrder.push(1)),h.resi!==d.resi&&(s=!0))}}},o=function(e){var t,r,i,o=3.2,n=10.24,a=[];for(t=0,i=e.length;t<i;t++){e[t].index=t;var s=e[t];s.hetflag||"N"!==s.atom&&"O"!==s.atom||(a.push(s),s.hbondOther=null,s.hbondDistanceSq=Number.POSITIVE_INFINITY)}for(a.sort(function(e,t){return e.z-t.z}),t=0,i=a.length;t<i;t++){var l=a[t];for(r=t+1;r<i;r++){var c=a[r],u=c.z-l.z;if(u>o)break;if(c.atom!=l.atom){var h=Math.abs(c.y-l.y);if(!(h>o)){var f=Math.abs(c.x-l.x);if(!(f>o)){var d=f*f+h*h+u*u;d>n||c.chain==l.chain&&Math.abs(c.resi-l.resi)<4||(d<l.hbondDistanceSq&&(l.hbondOther=c,l.hbondDistanceSq=d),d<c.hbondDistanceSq&&(c.hbondOther=l,c.hbondDistanceSq=d))}}}}}},n=function(e){o(e);var t,r,i,n,a,s,l={};for(t=0,r=e.length;t<r;t++)if(a=e[t],"undefined"==typeof l[a.chain]&&(l[a.chain]=[]),isFinite(a.hbondDistanceSq)){var c=a.hbondOther;"undefined"==typeof l[c.chain]&&(l[c.chain]=[]),4===Math.abs(c.resi-a.resi)&&(l[a.chain][a.resi]="h")}for(i in l)for(n=1;n<l[i].length-1;n++){var u=l[i][n-1],h=l[i][n+1];s=l[i][n],"h"==u&&u==h&&s!=u&&(l[i][n]=u)}for(t=0,r=e.length;t<r;t++)a=e[t],isFinite(a.hbondDistanceSq)&&"h"!=l[a.chain][a.resi]&&"h"!=a.ss&&(l[a.chain][a.resi]="maybesheet");for(t=0,r=e.length;t<r;t++)if(a=e[t],isFinite(a.hbondDistanceSq)&&"maybesheet"==l[a.chain][a.resi]){var c=a.hbondOther,f=l[c.chain][c.resi];"maybesheet"!=f&&"s"!=f||(l[a.chain][a.resi]="s",l[c.chain][c.resi]="s")}for(i in l){for(n=1;n<l[i].length-1;n++){var u=l[i][n-1],h=l[i][n+1];s=l[i][n],"s"==u&&u==h&&s!=u&&(l[i][n]=u)}for(n=0;n<l[i].length;n++)s=l[i][n],"h"!=s&&"s"!=s||l[i][n-1]!=s&&l[i][n+1]!=s&&delete l[i][n]}for(t=0,r=e.length;t<r;t++)a=e[t],s=l[a.chain][a.resi],"undefined"!=typeof s&&"maybesheet"!=s&&(a.ss=s,l[a.chain][a.resi-1]!=s&&(a.ssbegin=!0),l[a.chain][a.resi+1]!=s&&(a.ssend=!0))};e.vasp=e.VASP=function(e,t){var r=[[]],i={},o=e.replace(/^\s+/,"").split(/[\n\r]/);if(o.length<3)return r;if(!o[1].match(/\d+/))return console.log("Warning: second line of the vasp structure file must be a number"),r;if(i.length=parseFloat(o[1]),i.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),r;i.xVec=new Float32Array(o[2].replace(/^\s+/,"").split(/\s+/)),i.yVec=new Float32Array(o[3].replace(/^\s+/,"").split(/\s+/)),i.zVec=new Float32Array(o[4].replace(/^\s+/,"").split(/\s+/));var n=o[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),a=new Int16Array(o[6].replace(/^\s+/,"").split(/\s+/)),s=o[7].replace(/\s+/,"");if(s.match(/C/))s="cartesian";else{if(!s.match(/D/))return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),r;s="direct"}if(n.length!=a.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(n),console.log(a),r;o.splice(0,8);for(var l=0,c=0,u=n.length;c<u;c++){for(var h=n[c],f=0,d=a[c];f<d;f++){var p=new Float32Array(o[l+f].replace(/^\s+/,"").split(/\s+/));atom={},atom.elem=h,"cartesian"==s?(atom.x=i.length*p[0],atom.y=i.length*p[1],atom.z=i.length*p[2]):(atom.x=i.length*(p[0]*i.xVec[0]+p[1]*i.yVec[0]+p[2]*i.zVec[0]),atom.y=i.length*(p[0]*i.xVec[1]+p[1]*i.yVec[1]+p[2]*i.zVec[1]),atom.z=i.length*(p[0]*i.xVec[2]+p[1]*i.yVec[2]+p[2]*i.zVec[2])),atom.bonds=[],r[0].push(atom)}l+=a[c]}return r},e.cube=e.CUBE=function(e,r){var i=[[]],o=e.replace(/^\s+/,"").split(/\n\r|\r+/);if(o.length<6)return i;var n=o[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),a=Math.abs(parseFloat(n[0]));n=o[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var s=parseFloat(n[0])>0?.529177:1;o=o.splice(6,a);for(var l=i[i.length-1].length,c=l+o.length,u=l;u<c;++u){var h={};h.serial=u;var f=o[u-l],d=f.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");6==d[0]?h.elem="C":1==d[0]?h.elem="H":8==d[0]?h.elem="O":17==d[0]&&(h.elem="Cl"),h.x=parseFloat(d[2])*s,h.y=parseFloat(d[3])*s,h.z=parseFloat(d[4])*s,h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},i[i.length-1].push(h)}for(var u=0;u<i.length;u++)t(i[u]);return i},e.xyz=e.XYZ=function(e,r){for(var i=[[]],o=e.split(/\r?\n|\r/);o.length>0&&!(o.length<3);){var n=parseInt(o[0]);if(isNaN(n)||n<=0)break;if(o.length<n+2)break;for(var a=2,s=i[i.length-1].length,l=s+n,c=s;c<l;c++){var u=o[a++],h=u.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),f={};f.serial=c;var d=h[0];f.atom=f.elem=d[0].toUpperCase()+d.substr(1).toLowerCase(),f.x=parseFloat(h[1]),f.y=parseFloat(h[2]),f.z=parseFloat(h[3]),f.hetflag=!0,f.bonds=[],f.bondOrder=[],f.properties={},i[i.length-1][c]=f,h.length>=7&&(f.dx=parseFloat(h[4]),f.dy=parseFloat(h[5]),f.dz=parseFloat(h[6]))}if(!r.multimodel)break;i.push([]),o.splice(0,a)}for(var c=0;c<i.length;c++)t(i[c]);if(r.onemol){var p=i;i=[],i.push(p[0]);for(var c=1;c<p.length;c++)for(var a=i[0].length,v=0;v<p[c].length;v++){for(var m=p[c][v],g=0;g<m.bonds.length;g++)m.bonds[g]=m.bonds[g]+a;m.index=i[0].length,m.serial=i[0].length,i[0].push(m)}}return i},e.sdf=e.SDF=function(e,t){var r=[[]],i=!1;"undefined"!=typeof t.keepH&&(i=!t.keepH);for(var o=e.split(/\r?\n|\r/);o.length>0&&!(o.length<4);){var n=parseInt(o[3].substr(0,3));if(isNaN(n)||n<=0)break;var a=parseInt(o[3].substr(3,3)),s=4;if(o.length<4+n+a)break;var l,c,u=[],h=r[r.length-1].length,f=h+n;for(l=h;l<f;l++,s++){c=o[s];var d={},p=c.substr(31,3).replace(/ /g,"");d.atom=d.elem=p[0].toUpperCase()+p.substr(1).toLowerCase(),"H"==d.elem&&i||(d.serial=l,u[l]=r[r.length-1].length,d.x=parseFloat(c.substr(0,10)),d.y=parseFloat(c.substr(10,10)),d.z=parseFloat(c.substr(20,10)),d.hetflag=!0,d.bonds=[],d.bondOrder=[],d.properties={},d.index=r[r.length-1].length,r[r.length-1].push(d))}for(l=0;l<a;l++,s++){c=o[s];var v=u[parseInt(c.substr(0,3))-1+h],m=u[parseInt(c.substr(3,3))-1+h],g=parseInt(c.substr(6,3));"undefined"!=typeof v&&"undefined"!=typeof m&&(r[r.length-1][v].bonds.push(m),r[r.length-1][v].bondOrder.push(g),r[r.length-1][m].bonds.push(v),r[r.length-1][m].bondOrder.push(g))}if(!t.multimodel)break;for(t.onemol||r.push([]);"$$$$"!=o[s];)s++;o.splice(0,++s)}return r},e.cdjson=e.json=function(e,t){var r=[[]];"string"==typeof e&&(e=JSON.parse(e));for(var i=e.m,o=i[0].a,n=i[0].b,a=i[0].s,s=void 0!==t&&void 0!==t.parseStyle?t.parseStyle:void 0!==a,l=r[r.length-1].length,c=0;c<o.length;c++){var u=o[c],h={};h.id=u.i,h.x=u.x,h.y=u.y,h.z=u.z||0,h.bonds=[],h.bondOrder=[];var f=u.l||"C";h.elem=f[0].toUpperCase()+f.substr(1).toLowerCase(),h.serial=r[r.length-1].length,s&&(h.style=a[u.s||0]),r[r.length-1].push(h)}for(var c=0;c<n.length;c++){var d=n[c],p=d.b+l,v=d.e+l,m=d.o||1,g=r[r.length-1][p],y=r[r.length-1][v];g.bonds.push(v),g.bondOrder.push(m),y.bonds.push(p),y.bondOrder.push(m)}return r},e.mcif=e.cif=function(e,r){function i(e,t){for(var r=[],i=0,o=0;o<e.length;){for(;e.substr(o,t.length)!==t&&o<e.length;){if("'"===e[o])for(o++;o<e.length&&"'"!==e[o];)o++;else if('"'===e[o])for(o++;o<e.length&&'"'!==e[o];)o++;o++}r.push(e.substr(i,o-i)),i=o+=t.length}return r}for(var o=[],a=!r.doAssembly,s=!r.duplicateAssemblyAtoms,l=o.modelData=[],u=e.split(/\r?\n|\r/),f=[],d=!1,p=0;p<u.length;p++){var v=u[p].split("#")[0];if(d?";"===v[0]&&(d=!1):";"===v[0]&&(d=!0),d||""!==v){if(!d&&(v=v.trim(),"_"===v[0])){var m=v.split(/\s/)[0].indexOf(".");m>-1&&(v[m]="_",v=v.substr(0,m)+"_"+v.substr(m+1))}f.push(v)}}for(var p=0,g=function(){function e(e){return e*e}function t(e,t,r){var i=L[0][0]*e+L[0][1]*t+L[0][2]*r,o=L[1][0]*e+L[1][1]*t+L[1][2]*r,n=L[2][0]*e+L[2][1]*t+L[2][2]*r;return{x:i,y:o,z:n}}function r(e){var t=e.match("-");e=e.replace(/[-xyz]/g,"");var r,i,o=e.split("/");return i=void 0===o[1]?1:parseInt(o[1]),r=""===o[0]?1:parseInt(o[0]),r/i*(t?-1:1)}for(;!f[p].startsWith("data_")||"data_global"===f[p];)p++;for(p++,y={};p<f.length&&!f[p].startsWith("data_");)if(void 0===f[p][0])p++;else if("_"===f[p][0]){if(b=f[p].split(/\s/)[0].toLowerCase(),x=y[b]=y[b]||[],w=f[p].substr(f[p].indexOf(b)+b.length),""===w)if(p++,";"===f[p][0]){for(C=f[p].substr(1),p++;";"!==f[p];)C=C+"\n"+f[p],p++;x.push(C)}else x.push(f[p]);else x.push(w.trim());p++}else if("loop_"===f[p].substr(0,5)){for(p++,_=[];""===f[p]||"_"===f[p][0];)""!==f[p]&&(b=f[p].split(/\s/)[0].toLowerCase(),x=y[b]=y[b]||[],_.push(x)),p++;for(A=0;p<f.length&&"_"!==f[p][0]&&!f[p].startsWith("loop_")&&!f[p].startsWith("data_");){for(v=i(f[p]," "),M=0;M<v.length;M++)""!==v[M]&&(_[A].push(v[M]),A=(A+1)%_.length);p++}}else p++;for(l.push({symmetries:[]}),o.push([]),S=0,z=void 0!==y._atom_site_id?y._atom_site_id.length:y._atom_site_label.length,void 0!==y._cell_length_a&&(T=parseFloat(y._cell_length_a),F=parseFloat(y._cell_length_b),I=parseFloat(y._cell_length_c),E=parseFloat(y._cell_angle_alpha)||90,O=parseFloat(y._cell_angle_beta)||90,k=parseFloat(y._cell_angle_gamma)||90,P=E*Math.PI/180,V=O*Math.PI/180,R=k*Math.PI/180,D=Math.cos(P),N=Math.cos(V),U=Math.cos(R),B=Math.sin(R),L=[[T,F*U,I*N],[0,F*B,I*(D-N*U)/B],[0,0,I*Math.sqrt(1-e(D)-e(N)-e(U)+2*D*N*U)/B]],l[l.length-1].cryst={a:T,b:F,c:I,alpha:E,beta:O,gamma:k}),j=0;j<z;j++)void 0!==y._atom_site_group_pdb&&"TER"===y._atom_site_group_pdb[j]||(G={},void 0!==y._atom_site_cartn_x?(G.x=parseFloat(y._atom_site_cartn_x[j]),G.y=parseFloat(y._atom_site_cartn_y[j]),G.z=parseFloat(y._atom_site_cartn_z[j])):(H=t(parseFloat(y._atom_site_fract_x[j]),parseFloat(y._atom_site_fract_y[j]),parseFloat(y._atom_site_fract_z[j])),G.x=H.x,G.y=H.y,G.z=H.z),G.chain=y._atom_site_auth_asym_id?y._atom_site_auth_asym_id[j]:void 0,G.resi=y._atom_site_auth_seq_id?parseInt(y._atom_site_auth_seq_id[j]):void 0,G.resn=y._atom_site_auth_comp_id?y._atom_site_auth_comp_id[j].trim():void 0,G.atom=y._atom_site_auth_atom_id?y._atom_site_auth_atom_id[j].replace(/"/gm,""):void 0,G.hetflag=!y._atom_site_group_pdb||"HETA"===y._atom_site_group_pdb[j]||"HETATM"===y._atom_site_group_pdb[j],W=y._atom_site_type_symbol[j],G.elem=W[0].toUpperCase()+W.substr(1).toLowerCase(),G.bonds=[],G.ss="c",G.serial=j,G.bondOrder=[],G.properties={},o[o.length-1].push(G));if(void 0!==y._pdbx_struct_oper_list_id&&!a){for(j=0;j<y._pdbx_struct_oper_list_id.length;j++)q=parseFloat(y["_pdbx_struct_oper_list_matrix[1][1]"][j]),Y=parseFloat(y["_pdbx_struct_oper_list_matrix[1][2]"][j]),Z=parseFloat(y["_pdbx_struct_oper_list_matrix[1][3]"][j]),$=parseFloat(y["_pdbx_struct_oper_list_vector[1]"][j]),X=parseFloat(y["_pdbx_struct_oper_list_matrix[2][1]"][j]),Q=parseFloat(y["_pdbx_struct_oper_list_matrix[2][2]"][j]),K=parseFloat(y["_pdbx_struct_oper_list_matrix[2][3]"][j]),J=parseFloat(y["_pdbx_struct_oper_list_vector[2]"][j]),ee=parseFloat(y["_pdbx_struct_oper_list_matrix[3][1]"][j]),te=parseFloat(y["_pdbx_struct_oper_list_matrix[3][2]"][j]),re=parseFloat(y["_pdbx_struct_oper_list_matrix[3][3]"][j]),ie=parseFloat(y["_pdbx_struct_oper_list_vector[3]"][j]),oe=new h.Matrix4(q,Y,Z,$,X,Q,K,J,ee,te,re,ie),l[l.length-1].symmetries.push(oe);for(j=0;j<o.length;j++)c(l[l.length-1].symmetries,s,o[j])}if(void 0!==y._symmetry_equiv_pos_as_xyz)for(ne=0;ne<y._symmetry_equiv_pos_as_xyz.length;ne++){for(ae=y._symmetry_equiv_pos_as_xyz[ne].replace(/["' ]/g,""),se=ae.split(",").map(function(e){return e.replace(/-/g,"+-")}),oe=new h.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),le=0;le<3;le++)for(ce=se[le].split("+"),ue=0,he=0,fe=0,de=0,pe=0;pe<ce.length;pe++)ve=ce[pe],""!==ve&&(me=r(ve),ve.match("x")?oe.elements[le+0]=me:ve.match("y")?oe.elements[le+4]=me:ve.match("z")?oe.elements[le+8]=me:oe.elements[le+12]=me);ge=new h.Matrix4(L[0][0],L[0][1],L[0][2],0,L[1][0],L[1][1],L[1][2],0,L[2][0],L[2][1],L[2][2],0),ye=(new h.Matrix4).getInverse(ge,!0),oe=(new h.Matrix4).multiplyMatrices(oe,ye),oe=(new h.Matrix4).multiplyMatrices(ge,oe),l[l.length-1].symmetries.push(oe)}};p<f.length;){var y,b,x,w,C,_,b,x,A,v,M,S,z,L,T,F,I,E,O,k,P,V,R,D,N,U,B,j,G,H,W,j,q,Y,Z,$,X,Q,K,J,ee,te,re,ie,oe,j,ne,ae,se,oe,le,ce,ue,he,fe,de,pe,ve,me,ge,ye;g()}for(var j=0;j<o.length;j++)t(o[j]),n(o[j]),c(l[j].symmetries,s,o[j]);return o},e.mol2=e.MOL2=function(e,t){var r=[[]],i=!1;"undefined"!=typeof t.keepH&&(i=!t.keepH);for(var o=e.substr(n,e.length).split(/\r?\n|\r/);o.length>0;){var n=e.search(/@<TRIPOS>MOLECULE/),a=e.search(/@<TRIPOS>ATOM/);if(n==-1||a==-1)break;var s=[],l=o[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),c=parseInt(l[0]),u=0;l.length>1&&(u=parseInt(l[1]));var h,f=4;for(h=3;h<o.length;h++)if("@<TRIPOS>ATOM"==o[h]){f=h+1;break}var d,p=r[r.length-1].length,v=p+c;
for(h=p;h<v;h++){d=o[f++],l=d.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var m={},g=l[5].split(".")[0];if(m.atom=m.elem=g[0].toUpperCase()+g.substr(1).toLowerCase(),"H"==m.elem&&i);else{var y=r[r.length-1].length,b=parseInt(l[0]);m.serial=b,m.x=parseFloat(l[2]),m.y=parseFloat(l[3]),m.z=parseFloat(l[4]),m.atom=l[5];var x=parseFloat(l[8]);m.index=y,m.bonds=[],m.bondOrder=[],m.properties={charge:x,partialCharge:x},s[b]=y,r[r.length-1].push(m)}}for(var w=!1;f<o.length;)if("@<TRIPOS>BOND"==o[f++]){w=!0;break}if(w&&u)for(h=0;h<u;h++){d=o[f++],l=d.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var C=parseInt(l[1]);fromAtom=r[r.length-1][s[C]];var _=parseInt(l[2]);toAtom=r[r.length-1][s[_]];var A=parseInt(l[3]);isNaN(A)&&(A=1),void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(s[_]),fromAtom.bondOrder.push(A),toAtom.bonds.push(s[C]),toAtom.bondOrder.push(A))}if(!t.multimodel)break;t.onemol||r.push([]),o.splice(0,f),e=o.join("\n")}return r};var a={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45},s=function(e){return a[e]||1.6},l=function(e,t){var r=s(e.elem)+s(t.elem);r+=.25,r*=r;var i=e.x-t.x;if(i*=i,i>r)return!1;var o=e.y-t.y;if(o*=o,o>r)return!1;var n=e.z-t.z;if(n*=n,n>r)return!1;var a=i+o+n;return!isNaN(a)&&(!(a<.5)&&!(a>r))},c=function(e,t,r){var i,o,n,a=r.length,s=a;if(t){if(e.length>1)for(i=0;i<r.length;i++){var l=[];for(o=0;o<e.length;o++)if(!e[o].isIdentity()){var c=new h.Vector3;c.set(r[i].x,r[i].y,r[i].z),c.applyMatrix4(e[o]),l.push(c)}r[i].symmetries=l}}else for(i=0;i<e.length;i++)if(!e[i].isIdentity()){var u=new h.Vector3;for(n=0;n<a;n++){var f=[];for(o=0;o<r[n].bonds.length;o++)f.push(r[n].bonds[o]+s);u.set(r[n].x,r[n].y,r[n].z),u.applyMatrix4(e[i]);var d={};for(var p in r[n])d[p]=r[n][p];d.x=u.x,d.y=u.y,d.z=u.z,d.bonds=f,r.push(d)}s=r.length}},u=function(e){var t;for(t in e)return!1;return!0},f=function(e,t,i){var o,s,l,f,d=[],p=!t.keepH,v=!!t.noSecondaryStructure,m=!t.noComputeSecondaryStructure,g=!t.doAssembly,y=!t.duplicateAssemblyAtoms,b={symmetries:[]},x=[],w=!1,C=[],_={};for(s=0;s<e.length;s++){f=e[s].replace(/^\s*/,"");var A,M,S,z,L=f.substr(0,6);if(0==L.indexOf("END")){if(x=e.slice(s+1),"END"==L)for(var T in i)i.hasOwnProperty(T)&&delete i[T];break}if("ATOM  "==L||"HETATM"==L){var F,I,E,O,k,P,V,R,D,N,U,B;if(U=f.substr(16,1)," "!=U&&"A"!=U)continue;if(N=parseInt(f.substr(6,5)),o=f.substr(12,4).replace(/ /g,""),F=f.substr(17,3).replace(/ /g,""),I=f.substr(21,1),E=parseInt(f.substr(22,4)),O=f.substr(26,1),k=parseFloat(f.substr(30,8)),P=parseFloat(f.substr(38,8)),V=parseFloat(f.substr(46,8)),B=parseFloat(f.substr(60,8)),D=f.substr(76,2).replace(/ /g,""),""===D||"undefined"==typeof a[D]?(D=f.substr(12,2).replace(/ /g,""),D.length>0&&"H"==D[0]&&"Hg"!=D&&(D="H"),D.length>1&&(D=D[0].toUpperCase()+D.substr(1).toLowerCase(),"undefined"==typeof a[D]?D=D[0]:"A"==f[0]&&"Ca"==D&&(D="C"))):D=D[0].toUpperCase()+D.substr(1).toLowerCase(),"H"==D&&p)continue;R="H"==L[0],C[N]=d.length,d.push({resn:F,x:k,y:P,z:V,elem:D,hetflag:R,chain:I,resi:E,icode:O,rescode:E+(" "!=O?"^"+O:""),serial:N,atom:o,bonds:[],ss:"c",bondOrder:[],properties:{},b:B,pdbline:f})}else if("SHEET "==L){w=!0,A=f.substr(21,1),M=parseInt(f.substr(22,4)),S=f.substr(32,1),z=parseInt(f.substr(33,4)),A in i||(i[A]={}),i[A][M]="s1";for(var j=M+1;j<z;j++)i[A][j]="s";i[A][z]="s2"}else if("CONECT"==L){var G=parseInt(f.substr(6,5)),H=C[G],W=d[H];for(l=0;l<4;l++){var q=parseInt(f.substr([11,16,21,26][l],5)),Y=C[q],Z=d[Y];if(void 0!==W&&void 0!==Z)if(_[[H,Y]]){_[[H,Y]]+=1;for(var $=0;$<W.bonds.length;$++)if(W.bonds[$]==Y){var X=_[[H,Y]];X>=4?W.bondOrder[$]=1:W.bondOrder[$]=X}}else _[[H,Y]]=1,0!=W.bonds.length&&W.bonds[W.bonds.length-1]==Y||(W.bonds.push(Y),W.bondOrder.push(1))}}else if("HELIX "==L){w=!0,A=f.substr(19,1),M=parseInt(f.substr(21,4)),S=f.substr(31,1),z=parseInt(f.substr(33,4)),A in i||(i[A]={}),i[A][M]="h1";for(var j=M+1;j<z;j++)i[A][j]="h";i[A][z]="h2"}else if(g||"REMARK"!=L||"BIOMT"!=f.substr(13,5)){if("CRYST1"==L){var Q,B,K,J,ee,te;Q=parseFloat(f.substr(7,8)),B=parseFloat(f.substr(16,8)),K=parseFloat(f.substr(25,8)),J=parseFloat(f.substr(34,6)),ee=parseFloat(f.substr(41,6)),te=parseFloat(f.substr(48,6)),b.cryst={a:Q,b:B,c:K,alpha:J,beta:ee,gamma:te}}}else{var re,ie=new h.Matrix4;for(re=1;re<=3;re++)if(f=e[s].replace(/^\s*/,""),parseInt(f.substr(18,1))==re)ie.elements[re-1]=parseFloat(f.substr(23,10)),ie.elements[re-1+4]=parseFloat(f.substr(33,10)),ie.elements[re-1+8]=parseFloat(f.substr(43,10)),ie.elements[re-1+12]=parseFloat(f.substr(53)),s++;else for(;"BIOMT"==f.substr(13,5);)s++,f=e[s].replace(/^\s*/,"");ie.elements[3]=0,ie.elements[7]=0,ie.elements[11]=0,ie.elements[15]=1,b.symmetries.push(ie),s--}}var oe=(new Date).getTime();if(r(d),g||c(b.symmetries,y,d),m&&!v&&(oe=(new Date).getTime(),n(d)),oe=(new Date).getTime(),!u(i))for(s=0;s<d.length;s++)if(o=d[s],void 0!==o&&o.chain in i&&o.resi in i[o.chain]){var ne=i[o.chain][o.resi];o.ss=ne[0],ne.length>1&&("1"==ne[1]?o.ssbegin=!0:"2"==ne[1]&&(o.ssend=!0))}return[d,b,x]};e.pdb=e.PDB=e.pdbqt=e.PDBQT=function(e,t){var r=[],i={};r.modelData=[];for(var o=e.split(/\r?\n|\r/);o.length>0;){var n=f(o,t,i),a=n[0],s=n[1];if(o=n[2],0!=a.length){if(t.multimodel&&t.onemol&&r.length>0)for(var l=r[0].length,c=0;c<a.length;c++){var u=a[c];u.index=c;for(var h=0;h<u.bonds.length;h++)u.bonds[h]+=l;r[0].push(u)}else r.modelData.push(s),r.push(a);if(!t.multimodel)break}}return r},e.pqr=e.PQR=function(e,t){var i,o,a,s,l=[[]],c=(l[l.length-1].length,!t.noSecondaryStructure),u=(!t.doAssembly,!t.duplicateAssemblyAtoms,l.modelData=[{symmetries:[]}],[]),h=e.split(/\r?\n|\r/);for(o=0;o<h.length;o++){s=h[o].replace(/^\s*/,"");var f=s.substr(0,6);if(0==f.indexOf("END")){if(t.multimodel){t.onemol||l.push([]);continue}break}if("ATOM  "==f||"HETATM"==f){var d=parseInt(s.substr(6,5)),i=s.substr(12,4).replace(/ /g,""),p=s.substr(17,3),v=s.substr(21,1),m=parseInt(s.substr(22,4)),g=s.substr(30).trim().split(/\s+/),y=parseFloat(g[0]),b=parseFloat(g[1]),x=parseFloat(g[2]),w=parseFloat(g[3]),C=parseFloat(g[4]),_=i[0];i.length>1&&i[1].toUpperCase()!=i[1]&&(_=i.substr(0,2)),"H"==s[0]?hetflag=!0:hetflag=!1,u[d]=l[l.length-1].length,l[l.length-1].push({resn:p,x:y,y:b,z:x,elem:_,hetflag:hetflag,chain:v,resi:m,serial:d,atom:i,bonds:[],ss:"c",bondOrder:[],properties:{charge:w,partialCharge:w,radius:C},pdbline:s})}else if("CONECT"==f){var A=parseInt(s.substr(6,5)),M=l[l.length-1][u[A]];for(a=0;a<4;a++){var S=parseInt(s.substr([11,16,21,26][a],5)),z=l[l.length-1][u[S]];void 0!==M&&void 0!==z&&(M.bonds.push(u[S]),M.bondOrder.push(1))}}}for(var o=0;o<l.length;o++)r(l[o]),c&&n(l[o]);return l};var d=function(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")},p=function(e){return 2==e?"h":3==e?"s":"c"};return e.mmtf=e.MMTF=function(e,t){var r=!t.keepH,i=MMTF.decode(e),o=[[]],n=o.modelData=[],a=0,s=0,l=0,u=0,f=(i.chainNameList,i.secStructList),v=i.insCodeList,m=i.sequenceIndexList,g=i.bFactorList,y=i.altLocList,b=i.occupancyList,x=i.bondAtomList,w=i.bondOrderList,C=i.numModels;if(0==C)return o;t.multimodel||(C=1);var _,A,M,S,z,L,T=!t.doAssembly,F=!t.duplicateAssemblyAtoms,I=t.assemblyIndex?t.assemblyIndex:0,E=[];if(i.bioAssemblyList&&i.bioAssemblyList.length>0){var O=i.bioAssemblyList[I].transformList;for(_=0,L=O.length;_<L;_++){var k=new h.Matrix4(O[_].matrix);k.transpose(),E.push(k)}}var P=0;for(z=0;z<C;z++){var V=i.chainsPerModel[z],R=o[o.length-1],D=[];for(n.push({symmetries:E}),_=0;_<V;++_){var N=i.groupsPerChain[s],U=d(i.chainIdList.subarray(4*s,4*s+4)),B=l;for(A=0;A<N;++A){var j=i.groupList[i.groupTypeList[l]],G=j.atomNameList.length,H=0;f&&(H=f[l]);var W=null;i.insCodeList&&(W=String.fromCharCode(v[l]));var q=null;m&&(q=m[l]);var Y=i.groupIdList[l],Z=j.groupName,$=u;for(M=0;M<G;++M){var X=j.elementList[M];if(r&&"H"==X)u+=1;else{var Q="";g&&(Q=g[u]);var K=" ";y&&(K=String.fromCharCode(y[u]));var J="";b&&(J=b[u]);var ee=i.atomIdList[u],te=j.atomNameList[M],re=0;j.atomChargeList&&(re=j.atomChargeList[M]);var ie=i.xCoordList[u],oe=i.yCoordList[u],ne=i.zCoordList[u];D[u]=R.length,R.push({resn:Z,x:ie,y:oe,z:ne,elem:X,hetflag:H<0,chain:U,resi:Y,icode:K,rescode:Y+(" "!=K?"^"+K:""),serial:ee,atom:te,bonds:[],ss:p(H),bondOrder:[],properties:{charge:re,occupancy:J},b:Q}),u+=1}}var ae=j.bondAtomList;for(M=0,S=j.bondOrderList.length;M<S;++M){var se=$+ae[2*M],le=$+ae[2*M+1],ce=j.bondOrderList[M],ue=D[se],he=D[le],fe=R[ue],de=R[he];fe&&de&&(fe.bonds.push(he),fe.bondOrder.push(ce),de.bonds.push(ue),de.bondOrder.push(ce))}l+=1}for(l=B,A=0;A<N;++A)l+=1;s+=1}if(x)for(M=P,S=x.length;M<S;M+=2){var se=x[M],le=x[M+1],ce=w?w[M/2]:1;if(se>=u){P=M;break}var ue=D[se],he=D[le],fe=R[ue],de=R[he];fe&&de&&(fe.bonds.push(he),fe.bondOrder.push(ce),de.bonds.push(ue),de.bondOrder.push(ce))}t.multimodel&&(t.onemol||o.push([])),a+=1}for(var L=0;L<o.length;L++)T||c(n[L].symmetries,F,o[L]);return o},e.prmtop=e.PRMTOP=function(e,t){function r(e){var t=s.indexOf(l.filter(function(t){return t.includes(e)})[0]);if(Number.isInteger(t)&&t>0){for(;!s[t].includes("FORMAT");)t++;return t}return-1}function o(e){var t=s[e].match(/\((\d*)\S*/),r=s[e].match(/[a-zA-Z](\d*)\)\s*/);return null==r&&(r=s[e].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[t[1],r[1]]}var n=[],a=0,s=e.split(/\r?\n|\r/);if(!(s.length>0&&s[0].includes("VERSION")))return[];var l=s.filter(function(e){return e.includes("POINTERS")||e.includes("ATOM_NAME")||e.includes("CHARGE")||e.includes("RADII")||e.includes("BONDS_INC_HYDROGEN")||e.includes("BONDS_WITHOUT_HYDROGEN")}),c=r("POINTERS");if(c==-1)return[];var u=o(c),h=parseInt(s[c+1].slice(0,u[1]));if(isNaN(h)||h<=0)return[];if(c=r("ATOM_NAME"),c==-1)return[];u=o(c);var f=u[0];for(i=0;i<h/u[0];i++){for(i==parseInt(h/u[0])&&(f=h%u[0]),j=0;j<f;j++){var d={},p={charge:"",radii:""};d.serial=a,d.x=0,d.y=0,d.z=0,d.atom=s[c+1].slice(u[1]*j,u[1]*(j+1)),d.elem=s[c+1].slice(u[1]*j,u[1]*j+1),d.properties=p,d.bonds=[],d.bondOrder=[],n.push(d),a++}c++}if(c=r("CHARGE"),c!=-1)for(u=o(c),a=0,f=u[0],i=0;i<h/u[0];i++){for(i==parseInt(h/u[0])&&(f=h%u[0]),j=0;j<f;j++)n[a].properties.charge=s[c+1].slice(u[1]*j,u[1]*(j+1)),a++;c++}if(c=r("RADII"),c!=-1)for(u=o(c),a=0,f=u[0],i=0;i<h/u[0];i++){for(i==parseInt(h/u[0])&&(f=h%u[0]),j=0;j<f;j++)n[a].properties.radii=s[c+1].slice(u[1]*j,u[1]*(j+1)),a++;c++}if(c=r("BONDS_WITHOUT_HYDROGEN"),c!=-1){u=o(c),a=0,f=u[0];var v;for(i=0;i<h/u[0];i++){for(i==parseInt(h/u[0])&&(f=h%u[0]),j=0;j<f;j++)a%3==0&&(v=parseInt(s[c+1].slice(u[1]*j,u[1]*(j+1))/3+1)),a%3==1&&n[v].bonds.push(parseInt(s[c+1].slice(u[1]*j,u[1]*(j+1))/3+1)),a++;c++}}if(c=r("BONDS_INC_HYDROGEN"),c!=-1){u=o(c),a=0,f=u[0];var v;for(i=0;i<h/u[0];i++){for(i==parseInt(h/u[0])&&(f=h%u[0]),j=0;j<f;j++)a%3==0&&(v=parseInt(s[c+1].slice(u[1]*j,u[1]*(j+1))/3+1)),a%3==1&&n[v].bonds.push(parseInt(s[c+1].slice(u[1]*j,u[1]*(j+1))/3+1)),a++;c++}}return[n]},e}();var h=h||{};h.partialCharges={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55},h.applyPartialCharges=function(e,t){if((!t||"undefined"==typeof e.partialCharge)&&e.resn&&e.atom){var r=e.resn+":"+e.atom;e.properties.partialCharge=h.partialCharges[r]}},h.VolumeData=function(e,t,r){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,t=t.toLowerCase(),/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=pako.inflate(e)}catch(i){console.log(i)}}if(this[t]&&this[t](e),r){if(r.negate)for(var o=0,n=this.data.length;o<n;o++)this.data[o]=-this.data[o];if(r.normalize){for(var a=0,o=0,n=this.data.length;o<n;o++)a+=this.data[o];var s=a/this.data.length;console.log("computed mean: "+s),a=0;for(var o=0,n=this.data.length;o<n;o++){var l=this.data[o]-s;a+=l*l}var c=a/this.data.length;console.log("Computed variance: "+c);for(var o=0,n=this.data.length;o<n;o++)this.data[o]=(this.data[o]-s)/c}}},h.VolumeData.prototype.getVal=function(e,t,r){return e-=this.origin.x,t-=this.origin.y,r-=this.origin.z,e/=this.unit.x,t/=this.unit.y,r/=this.unit.z,e=Math.round(e),t=Math.round(t),r=Math.round(r),e<0||e>=this.size.x?0:t<0||t>=this.size.y?0:r<0||r>=this.size.z?0:this.data[e*this.size.y*this.size.z+t*this.size.z+r]},h.VolumeData.prototype.getCoordinates=function(e){var t=e/(this.size.y*this.size.z),r=e%(this.size.y*this.size.z),i=e%this.size.z;return t*=this.unit.x,r*=this.unit.y,i*=this.unit.z,t+=this.origin.x,r+=this.origin.y,i+=this.origin.z,{x:t,y:r,z:i}},h.VolumeData.prototype.vasp=function(e){var t=e.replace(/^\s+/,"").split(/[\n\r]/),r=h.Parsers.vasp(e)[0],i=r.length;if(0==i)return console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),void(this.data=[]);var o,n=1.889725992,a=.036749309,s=parseFloat(t[1]);o=t[2].replace(/^\s+/,"").split(/\s+/);var l=new h.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(s*n);o=t[3].replace(/^\s+/,"").split(/\s+/);var c=new h.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(s*n);o=t[4].replace(/^\s+/,"").split(/\s+/);var u=new h.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(s*n),f=l.x*(c.y*u.z-u.y*c.z)-c.x*(l.y*u.z-u.y*l.z)+u.x*(l.y*c.z-c.y*l.z);f=Math.abs(f)/Math.pow(n,3);var d=1/f;t.splice(0,8+i+1);var p=t[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),v=Math.abs(p[0]),m=Math.abs(p[1]),g=Math.abs(p[2]),y=this.origin=new h.Vector3(0,0,0);this.size={x:v,y:m,z:g},this.unit=new h.Vector3(l.x,c.y,u.z),l=l.multiplyScalar(1/(n*v)),c=c.multiplyScalar(1/(n*m)),u=u.multiplyScalar(1/(n*g)),0==l.y&&0==l.z&&0==c.x&&0==c.z&&0==u.x&&0==u.y||(this.matrix=new h.Matrix4(l.x,c.x,u.x,0,l.y,c.y,u.y,0,l.z,c.z,u.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new h.Matrix4).makeTranslation(y.x,y.y,y.z)),this.origin=new h.Vector3(0,0,0),this.unit=new h.Vector3(1,1,1)),t.splice(0,1);var b=t.join(" ");b=b.replace(/^\s+/,""),b=b.split(/[\s\r]+/),b.splice(v*m*g+1);for(var x=new Float32Array(b),w=0;w<x.length;w++)x[w]=x[w]*d*a;this.data=x},h.VolumeData.prototype.cube=function(e){var t=e.replace(/^\s+/,"").split(/[\n\r]+/);if(!(t.length<6)){var r=t[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),i=parseFloat(r[0]),o=Math.abs(i),n=this.origin=new h.Vector3(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));r=t[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var a=r[0]>0?.529177:1;n.multiplyScalar(a);var s=Math.abs(r[0]),l=new h.Vector3(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])).multiplyScalar(a);r=t[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var c=Math.abs(r[0]),u=new h.Vector3(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])).multiplyScalar(a);r=t[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var f=Math.abs(r[0]),d=new h.Vector3(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])).multiplyScalar(a);this.size={x:s,y:c,z:f},this.unit=new h.Vector3(l.x,u.y,d.z),0==l.y&&0==l.z&&0==u.x&&0==u.z&&0==d.x&&0==d.y||(this.matrix=new h.Matrix4(l.x,u.x,d.x,0,l.y,u.y,d.y,0,l.z,u.z,d.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new h.Matrix4).makeTranslation(n.x,n.y,n.z)),this.origin=new h.Vector3(0,0,0),this.unit=new h.Vector3(1,1,1));var p=6;i<0&&p++;var v=t.splice(o+p).join(" ");v=v.replace(/^\s+/,""),v=v.split(/[\s\r]+/),this.data=new Float32Array(v)}},h.VolumeData.prototype.ccp4=function(e){var t={};e=new Int8Array(e);var r=new Int32Array(e.buffer,0,56),i=new Float32Array(e.buffer,0,56),o=new DataView(e.buffer);if(t.MAP=String.fromCharCode(o.getUint8(208),o.getUint8(209),o.getUint8(210),o.getUint8(211)),t.MACHST=[o.getUint8(212),o.getUint8(213)],17===t.MACHST[0]&&17===t.MACHST[1])for(var n=e.byteLength,a=0;a<n;a+=4)o.setFloat32(a,o.getFloat32(a),!0);t.NX=r[0],t.NY=r[1],t.NZ=r[2],t.MODE=r[3],t.NXSTART=r[4],t.NYSTART=r[5],t.NZSTART=r[6],t.MX=r[7],t.MY=r[8],t.MZ=r[9],t.xlen=i[10],t.ylen=i[11],t.zlen=i[12],t.alpha=i[13],t.beta=i[14],t.gamma=i[15],t.MAPC=r[16],t.MAPR=r[17],t.MAPS=r[18],t.DMIN=i[19],t.DMAX=i[20],t.DMEAN=i[21],t.ISPG=r[22],t.NSYMBT=r[23],t.LSKFLG=r[24],t.originX=i[49],t.originY=i[50],t.originZ=i[51],t.ARMS=i[54],console.log("Map has min,mean,average,rmsddv: "+t.DMIN+","+t.DMAX+","+t.DMEAN+","+t.ARMS);var s=t,l=[s.xlen,0,0],c=[s.ylen*Math.cos(Math.PI/180*s.gamma),s.ylen*Math.sin(Math.PI/180*s.gamma),0],u=[s.zlen*Math.cos(Math.PI/180*s.beta),s.zlen*(Math.cos(Math.PI/180*s.alpha)-Math.cos(Math.PI/180*s.gamma)*Math.cos(Math.PI/180*s.beta))/Math.sin(Math.PI/180*s.gamma),0];u[2]=Math.sqrt(s.zlen*s.zlen*Math.sin(Math.PI/180*s.beta)*Math.sin(Math.PI/180*s.beta)-u[1]*u[1]);var f=[0,l,c,u],d=[0,s.MX,s.MY,s.MZ],p=[0,s.MAPC,s.MAPR,s.MAPS];this.matrix=new h.Matrix4,this.matrix.set(f[p[1]][0]/d[p[1]],f[p[2]][0]/d[p[2]],f[p[3]][0]/d[p[3]],0,f[p[1]][1]/d[p[1]],f[p[2]][1]/d[p[2]],f[p[3]][1]/d[p[3]],0,f[p[1]][2]/d[p[1]],f[p[2]][2]/d[p[2]],f[p[3]][2]/d[p[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new h.Matrix4).makeTranslation(s.NXSTART+s.originX,s.NYSTART+s.originY,s.NZSTART+s.originZ)),this.origin=new h.Vector3(0,0,0),this.unit=new h.Vector3(1,1,1),this.size={x:t.NX,y:t.NY,z:t.NZ};var v=new Float32Array(e.buffer,1024+t.NSYMBT),m=t.NX,g=t.NY,y=t.NZ;this.data=new Float32Array(m*g*y);for(var a=0;a<m;a++)for(var b=0;b<g;b++)for(var x=0;x<y;x++)this.data[(a*g+b)*y+x]=v[(x*g+b)*m+a]},h.workerString=function(){self.onmessage=function(e){var t=e.data,r=t.type;if(r<0)self.atomData=t.atoms,self.volume=t.volume,self.ps=new ProteinSurface;else{var i=self.ps;i.initparm(t.expandedExtent,1!=r,self.volume),i.fillvoxels(self.atomData,t.extendedAtoms),i.buildboundary(),4!==r&&2!==r||(i.fastdistancemap(),i.boundingatom(!1),i.fillvoxelswaals(self.atomData,t.extendedAtoms)),i.marchingcube(r);var o=i.getFacesAndVertices(t.atomsToShow);self.postMessage(o)}}}.toString().replace(/(^.*?\{|\}$)/g,""),h.workerString+="; var ProteinSurface="+h.ProteinSurface.toString().replace(/\$3Dmol.MarchingCube./g,"MarchingCube."),h.workerString+=",MarchingCube=("+h.MarchingCubeInitializer.toString()+")();",h.SurfaceWorker=window.URL.createObjectURL(new Blob([h.workerString],{type:"text/javascript"})),h.workerString=h.workerString,h.SurfaceWorker=h.SurfaceWorker,e.exports=h},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(15),c=i(l),u=r(2),h=i(u),f=r(3),d=i(f),p=function(e){function t(){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"componentDidMount",value:function(){this.renderNbmolviz()}},{key:"componentDidUpdate",value:function(){this.renderNbmolviz()}},{key:"renderNbmolviz",value:function(){var e=new h["default"]({model_data:this.props.modelData}),t=new d["default"]({model:e,el:this.container});t.render()}},{key:"render",value:function(){var e=this;return c["default"].createElement("div",{ref:function(t){e.container=t}})}}]),t}(c["default"].Component);p.propTypes={modelData:c["default"].PropTypes.string.isRequired},t["default"]=p},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function n(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){v&&d&&(v=!1,d.length?p=d.concat(p):m=-1,p.length&&s())}function s(){if(!v){var e=o(a);v=!0;for(var t=p.length;t;){for(d=p,p=[];++m<t;)d&&d[m].run();m=-1,t=p.length}d=null,v=!1,n(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var u,h,f=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var d,p=[],v=!1,m=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new l(e,t)),1!==p.length||v||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t){e.exports=require("keymirror")},function(e,t){e.exports=require("react")}]);
//# sourceMappingURL=bundle.js.map